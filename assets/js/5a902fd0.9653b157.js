"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[45994],{77400:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>c,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var i=t(74848),o=t(28453);const s={title:"5. Definition of 3D displays"},a=void 0,l={id:"LuneraysFlu_step5",title:"5. Definition of 3D displays",description:"This fifth step illustrates how to define 3D displays.",source:"@site/versioned_docs/version-1.8.1/LuneraysFlu_step5.md",sourceDirName:".",slug:"/LuneraysFlu_step5",permalink:"/wiki/1.8.1/LuneraysFlu_step5",draft:!1,unlisted:!1,editUrl:"https://github.com/gama-platform/gama/wiki/LuneraysFlu_step5/_edit",tags:[],version:"1.8.1",frontMatter:{title:"5. Definition of 3D displays"},sidebar:"tuto",previous:{title:"4. Use of a graph to constraint the movements of people",permalink:"/wiki/1.8.1/LuneraysFlu_step4"},next:{title:"6. Exploration of the model",permalink:"/wiki/1.8.1/LuneraysFlu_step6"}},r={},d=[{value:"Formulation",id:"formulation",level:2},{value:"Model Definition",id:"model-definition",level:2},{value:"species",id:"species",level:3},{value:"output",id:"output",level:3},{value:"Complete Model",id:"complete-model",level:2}];function p(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This fifth step illustrates how to define 3D displays."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Result of the Luneray Flu model 5.",src:t(63743).A+"",width:"3584",height:"2118"})}),"\n",(0,i.jsx)(n.h2,{id:"formulation",children:"Formulation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Define a new 3D aspect for roads."}),"\n",(0,i.jsx)(n.li,{children:"Define a new 3D aspect for buildings"}),"\n",(0,i.jsx)(n.li,{children:"Define a new 3D aspect for people"}),"\n",(0,i.jsx)(n.li,{children:"Define a new 3D display"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"model-definition",children:"Model Definition"}),"\n",(0,i.jsx)(n.h3,{id:"species",children:"species"}),"\n",(0,i.jsxs)(n.p,{children:["We define a new aspect for the road species called ",(0,i.jsx)(n.code,{children:"geom3D"})," that draw the road agent that as a black tube of 2m radius built from its geometry. Note that it is possible to get the list of points composing a geometry by using the ",(0,i.jsx)(n.code,{children:"points"})," variable of the geometry."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Road image for Luneray&#39;s Flu model.",src:t(5888).A+"",width:"75",height:"162"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"species road {\n    //....\n    aspect geom3D {\n\tdraw line(shape.points, 2.0) color: #black;\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Concerning the building species, we define an aspect called ",(0,i.jsx)(n.code,{children:"geom3D"}),' that draws the shape of the building with a depth of 20 meters and with using a texture "texture.jpg" for the face and a texture for the roof "roof_top.png".']}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Building image for Luneray&#39;s Flu model.",src:t(34722).A+"",width:"82",height:"134"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'species building {\n    //....\n    aspect geom3D {\n\tdraw shape depth: 20 #m border: #black texture: ["../includes/roof_top.png","../includes/texture.jpg"];\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["At last, we define a new aspect called ",(0,i.jsx)(n.code,{children:"geom3D"})," for the people species that displays the agent only if it is on a road (target != nil). In this aspect, we use an obj file that contains a 3D object. The use of the ",(0,i.jsx)(n.code,{children:"obj_file"})," operator allows to apply an initial rotation to an obj file. In our case, we add a rotation of -90\xb0 along the x-axis. We specify with the ",(0,i.jsx)(n.code,{children:"size"})," facet that we want to draw the 3D object inside a bounding box of 5m. As the location of the 3D object is its centroid and as we want to draw the 3D object on the top of the ground, we use the ",(0,i.jsx)(n.code,{children:"at"})," facet to put an offset along the z-axis. We use also the rotate facet to change the orientation of the 3D object according to the heading of the agent. At last, we choose to draw the 3D object in green if the agent is not infected; in red otherwise."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"3D object used to display people agents in Luneray&#39;s Flu model.",src:t(50470).A+"",width:"158",height:"228"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'species people skills:[moving]{\t\t\n    //....\n    aspect geom3D {\n\tif target != nil {\n\t    draw obj_file("../includes/people.obj", 90::{-1,0,0}) size: 5\n\t\tat: location + {0,0,7} rotate: heading - 90 color: is_infected ? #red : #green;\n\t}\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"output",children:"output"}),"\n",(0,i.jsxs)(n.p,{children:["We define a new display called ",(0,i.jsx)(n.code,{children:"view3D"})," of type ",(0,i.jsx)(n.code,{children:"opengl"})," with an ",(0,i.jsx)(n.code,{children:"ambient_light"})," of 80. Inside this display, we first draw a background image representing the satellite image of the Luneray. Note that GAMA is able to manage world files to georeferenced images. In our case, as a PGW file exists in the includes folder, the satellite image will be well localized in the display. After drawing the background image, we display first the building species with their geom3D aspect, then the road species with their geom3D aspect and finally the people species with their geom3D aspect. Only the people agents will be redrawn at each simulation step."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'experiment main_experiment type: gui {\n    output {\n    // monitor and other displays\t\n\tdisplay view3D type: opengl ambient_light: 80 {\n\t    image "../includes/luneray.png" refresh: false; \n\t    species building aspect: geom3D refresh: false;\n\t    species road aspect: geom3D refresh: false;\n\t    species people aspect: geom3D; \n\t}\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"complete-model",children:"Complete Model"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'model model5\n\nglobal {\n    int nb_people <- 2147;\n    int nb_infected_init <- 5;\n    float step <- 5 #mn;\n    file roads_shapefile <- file("../includes/roads.shp");\n    file buildings_shapefile <- file("../includes/buildings.shp");\n    geometry shape <- envelope(roads_shapefile);    \n    graph road_network;\n    \n    int nb_people_infected <- nb_infected_init update: people count (each.is_infected);\n    int nb_people_not_infected <- nb_people - nb_infected_init update: nb_people - nb_people_infected;\n    float infected_rate update: nb_people_infected/nb_people;\n      \n    init{\n        create road from: roads_shapefile;\n        road_network <- as_edge_graph(road);        \n        create building from: buildings_shapefile;\n        create people number:nb_people {\n            location <- any_location_in(one_of(building));                \n        }\n        ask nb_infected_init among people {\n            is_infected <- true;\n        }\n    }\n}\n\nspecies people skills:[moving]{        \n    float speed <- (2 + rnd(3)) #km/#h;\n    bool is_infected <- false;\n    point target;\n    \n    reflex stay when: target = nil {\n        if flip(0.05) {\n            target <- any_location_in (one_of(building));\n        }\n    }\n        \n    reflex move when: target != nil{\n        do goto target:target on: road_network;\n        if (location = target) {\n            target <- nil;\n        } \n    }\n\n    reflex infect when: is_infected{\n        ask people at_distance 10 #m {\n            if flip(0.05) {\n                is_infected <- true;\n            }\n        }\n    }\n    \n    aspect circle {\n        draw circle(10) color:is_infected ? #red : #green;\n    }\n    \n    aspect geom3D {\n        if target != nil {\n            draw obj_file("../includes/people.obj", 90::{-1,0,0}) size: 5\n            at: location + {0,0,7} rotate: heading - 90 color: is_infected ? #red : #green;\n        }\n    }\n    \n}\n\nspecies road {\n    aspect geom {\n        draw shape color: #black;\n    }\n    aspect geom3D {\n        draw line(shape.points, 2.0) color: #black;\n    }\n}\n\nspecies building {\n    aspect geom {\n        draw shape color: #gray;\n    }\n    aspect geom3D {\n        draw shape depth: 20 #m border: #black texture:["../includes/roof_top.png","../includes/texture.jpg"];\n    }\n}\n\nexperiment main type: gui {\n    parameter "Nb people infected at init" var: nb_infected_init min: 1 max: 2147;\n\n    output {\n        monitor "Infected people rate" value: infected_rate;\n        \n        display map {\n            species road aspect:geom;\n            species building aspect:geom;\n            species people aspect:circle;            \n        }\n        \n        display chart_display refresh: every(10 #cycles) {\n            chart "Disease spreading" type: series {\n                data "susceptible" value: nb_people_not_infected color: #green;\n                data "infected" value: nb_people_infected color: #red;\n            }\n        }\n\n        display view3D type: opengl ambient_light: 80 {\n            image "../includes/luneray.png" refresh: false; \n            species building aspect: geom3D refresh: false;\n            species road aspect: geom3D refresh: false;\n            species people aspect: geom3D; \n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"LuneraysFlu_step6",children:"Next step: Exploration of the model"})})]})}function c(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},34722:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/buildings_display-c4d9f59d3fba746e4604472d358e5544.png"},63743:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/luneray5-f7893ccf61f47200a58c911e599bd5e7.png"},50470:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/people_display-d08af31936b4e6ffbbf85f1384a82f34.png"},5888:(e,n,t)=>{t.d(n,{A:()=>i});const i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAACiCAAAAAAsbm98AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfkAg4EFQIFrPiDAAAA7UlEQVRo3u2aMQ7CMAwAncCKxGsQquBbfUQ3vlRVkRgQP2FhpmUoA1PkwSghvi5drFMcn2wPCYuYfVFgOWKpzNmuv1OXibmOcjxnKWn6YnV9JvIyyqHPsgZ1jlGZo5I1w9KzQqV3H2zvC78acAK/cAK/cAJWvX7hBP0eJ3CC+cgcKjyHPPj1crADNJ+jFqZlzVasjSHLQ47R9r4sz7W0fq5YaR0jfhXrEzhR1C+cgPUXOwBzqA0nPMxHnGD/8ugXOwB+4QR+4YQPltjWESfqZn3enKYhF3QXuWUD0toCNMV+PuJur2gnvNuG9UPWG+a8oLp/DQ7qAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTAyLTE0VDA0OjA4OjQwKzAwOjAwfJvDXwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMC0wMi0xNFQwNDowODo0MCswMDowMA3Ge+MAAAAASUVORK5CYII="},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var i=t(96540);const o={},s=i.createContext(o);function a(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);