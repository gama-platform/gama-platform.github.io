<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>6. Exploration of the model · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This final step illustrates how to explore the model through the introduction of batch experiments."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="6. Exploration of the model · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gama-platform.github.io/"/><meta property="og:description" content="This final step illustrates how to explore the model through the introduction of batch experiments."/><meta property="og:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/searchEngine.js"></script><script type="text/javascript" src="/js/dark.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/gama-logo_white.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/wiki/Home" target="_self">Documentation</a></li><li class="siteNavGroupActive"><a href="/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Luneray&#x27;s flu</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Tutorials<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/Tutorials">Tutorials</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Predator Prey<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey">Predator Prey</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step1">1. Basic Model</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step2">2. Vegetation Dynamic</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step3">3. Prey Agent Behavior</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step4">4. Inspectors and Monitors</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step5">5. Predator Agent</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step6">6. Breeding</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step7">7. Agent Aspect</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step8">8. Complex Behavior</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step9">9. Stopping condition</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step10">10. Charts</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step11">11. Writing Files</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step12">12. Image loading</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step13">13. Model exploration</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Road Traffic<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel">Road Traffic</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step1">1. Loading of GIS Data</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step2">2. People Agents</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step3">3. Movement of People</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step4">4. Weight for Road Network</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step5">5. Dynamic weights</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step6">6. Charts</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step7">7. Automatic Road Repair</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">3D Tutorial<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/ThreeD">3D Tutorial</a></li><li class="navListItem"><a class="navItem" href="/wiki/ThreeD_step1">1. Basic Model</a></li><li class="navListItem"><a class="navItem" href="/wiki/ThreeD_step2">2. Moving Cells</a></li><li class="navListItem"><a class="navItem" href="/wiki/ThreeD_step3">3. Connections</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Incremental Model<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel">Incremental Model</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step1">1. Simple SI Model</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step2">2. Charts</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step3">3. Integration of GIS Data</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step4">4. Movement on Graph</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step5">5. Visualizing in 3D</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step6">6. Multi-Level</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step7">7. Differential Equations</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Luneray&#x27;s flu<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu">Luneray&#x27;s flu</a></li><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu_step1">1. Creation of a first basic disease spreading model</a></li><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu_step2">2. Definition of monitors and chart outputs</a></li><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu_step3">3. Importation of GIS data</a></li><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu_step4">4. Use of a graph to constraint the movements of people</a></li><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu_step5">5. Definition of 3D displays</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/wiki/LuneraysFlu_step6">6. Exploration of the model</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">BDI Agents<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents">BDI Agents</a></li><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents_step1">1. Skeleton model</a></li><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents_step2">2. BDI Agents</a></li><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents_step3">3. Social relation</a></li><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents_step4">4. Emotions and Personality</a></li><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents_step5">5. Norms, obligation, and enforcement</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">6. Exploration of the model</h1></header><article><div><span><p>This final step illustrates how to explore the model through the introduction of batch experiments.</p>
<h2><a class="anchor" aria-hidden="true" id="formulation"></a><a href="#formulation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Formulation</h2>
<ul>
<li>Add an experiment to launch 10 simulations to analyze the sensitivity toward stochasticity.</li>
<li>Add an experiment to explore the impact of the <code>proba_leave</code> parameter.</li>
<li>Add an experiment to calibrate the model.</li>
</ul>
<p>These 3 additions will add each a new experiment of type batch, more details about <a href="BatchExperiments">batch experiment on this page</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="model-definition"></a><a href="#model-definition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Model Definition</h2>
<h3><a class="anchor" aria-hidden="true" id="sensitivity-analysis-toward-stochasticity"></a><a href="#sensitivity-analysis-toward-stochasticity" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sensitivity analysis toward stochasticity</h3>
<p>The aim is to run many simulations with the default values for parameters to analyze the impact of stochasticity over the simulation results. We choose as indicator to compare the simulations the <code>infected_rate</code> value after 2hours of simulations. We will launch 10 simulations and display the mean and standard deviation values of this variable over the 10 simulations.</p>
<p>To this purpose we need to define a new experiment with the following facet values:</p>
<ul>
<li><code>type</code>: the type of the experiment, here we choose the <code>batch</code> mode to be able to launch many simulations in one launch.</li>
<li><code>until</code>: the stop condition in the batch experiment, here <code>time &gt; 2#h</code>.</li>
<li><code>repeat</code>: the number of simulations to run with the same parameter values (number of replications), here 10.</li>
</ul>
<pre><code class="hljs"><span class="hljs-builtin">experiment</span> test_robustness <span class="hljs-symbol">type:</span> batch <span class="hljs-symbol">until:</span> time &gt; 2#h <span class="hljs-symbol">repeat:</span> 10 {
    <span class="hljs-builtin">reflex</span> information {
    <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">float</span>&gt; vals &lt;- simulations collect each.infected_rate;
    <span class="hljs-keyword">write</span> <span class="hljs-string">"mean: "</span> + mean(vals) + <span class="hljs-string">" standard deviation: "</span> + standard_deviation(vals);   
    }
}
</code></pre>
<p>Experiments are also a kind of species. They can thus have variables and behaviors. Here we use the <code>simulations</code> variable that is the list of the 10 simulations (for the 10 replications). In addition, in batch mode, a reflex is executed at the end of all the replication simulations. We can thus create the list of all the <code>infected_rate</code> values (with the <code>collect</code> operator) and compute the <code>mean</code> and <code>standard_deviation</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="exploration"></a><a href="#exploration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exploration</h3>
<p>The aim here is to explore the impact of one parameter over the simulations' result. We keep the same indicator. We add the <code>parameter</code> to explore the <code>experiment</code> and specify the possible it can take with either the <code>among</code> facet or the combination of <code>min</code>, <code>max</code> and <code>step</code> facets.</p>
<pre><code class="hljs"><span class="hljs-builtin">experiment</span> explore_model <span class="hljs-symbol">type:</span> batch <span class="hljs-symbol">until:</span> time &gt; 2#h <span class="hljs-symbol">repeat:</span> 2 {
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"proba_leave"</span> <span class="hljs-symbol">var:</span> proba_leave <span class="hljs-symbol">among:</span> [0, 0.01, 0.05, 0.1, 1.0];
    
    <span class="hljs-builtin">reflex</span> save_results {
    <span class="hljs-keyword">ask</span> simulations {
        <span class="hljs-keyword">write</span> <span class="hljs-string">"proba_leave: "</span> + proba_leave + <span class="hljs-string">" infected_rate: "</span> + self.infected_rate;
        <span class="hljs-keyword">save</span> [proba_leave, self.infected_rate] <span class="hljs-symbol">type:</span> csv <span class="hljs-symbol">to:</span><span class="hljs-string">"results.csv"</span>;
    }
    }
}
</code></pre>
<p>In order to do a deeper investigation, in particular with an external tool, it could be useful to save the values in a file. To this purpose, we use the <a href="Statements#save"><code>save</code> statement</a>. In our example, we save a list of values in the csv file (<code>type: csv</code>) specified in the <code>to</code> facet.</p>
<h3><a class="anchor" aria-hidden="true" id="calibration"></a><a href="#calibration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Calibration</h3>
<p>The calibration process corresponds to the search of parameter values that maximize/minimize indicators. To this purpose, we need to define:</p>
<ul>
<li>the parameters to explore, with their possible values,</li>
<li>the indicator to minimize/maximize,</li>
<li>the exploration method.</li>
</ul>
<p>Here we choose to minimize the value <code>abs(infected_rate - 0.5)</code> (i.e. we want to find parameters' value that makes the simulation having an <code>infected_rate</code> as close as possible to 0.5) after 2hours of simulation. The chosen optimization method is a genetic algorithm (<a href="ExplorationMethods">more details on this page</a>).</p>
<pre><code class="hljs"><span class="hljs-builtin">experiment</span> calibration_model <span class="hljs-symbol">type:</span> batch <span class="hljs-symbol">until:</span> time &gt; 2#h <span class="hljs-symbol">repeat:</span> 3 {
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"infection distance"</span> <span class="hljs-symbol">var:</span> infection_distance <span class="hljs-symbol">min:</span> 1.0 <span class="hljs-symbol">max:</span> 20.0 <span class="hljs-symbol">step:</span> 1;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"proba infection"</span> <span class="hljs-symbol">var:</span> proba_infection <span class="hljs-symbol">min:</span> 0.01 <span class="hljs-symbol">max:</span> 1.0 <span class="hljs-symbol">step:</span> 0.01;
    
    method <span class="hljs-keyword">genetic</span> <span class="hljs-symbol">pop_dim:</span> 3 <span class="hljs-symbol">max_gen:</span> 5 <span class="hljs-symbol">minimize:</span> abs(infected_rate - 0.5);
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="complete-model"></a><a href="#complete-model" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Complete Model</h2>
<pre><code class="hljs"><span class="hljs-builtin">model</span> model6

global {
    <span class="hljs-literal">int</span> nb_people &lt;- 2147;
    <span class="hljs-literal">int</span> nb_infected_init &lt;- 5;
    <span class="hljs-literal">float</span> step &lt;- 5 #mn;
    
    <span class="hljs-literal">float</span> proba_leave &lt;- 0.05;
    
    <span class="hljs-literal">float</span> infection_distance &lt;- 5 #m;
    <span class="hljs-literal">float</span> proba_infection &lt;- 0.05;
    
    <span class="hljs-literal">file</span> roads_shapefile &lt;- <span class="hljs-literal">file</span>(<span class="hljs-string">"../includes/roads.shp"</span>);
    <span class="hljs-literal">file</span> buildings_shapefile &lt;- <span class="hljs-literal">file</span>(<span class="hljs-string">"../includes/buildings.shp"</span>);
    <span class="hljs-literal">geometry</span> shape &lt;- envelope(roads_shapefile);    
    <span class="hljs-literal">graph</span> road_network;
    
    
    <span class="hljs-literal">int</span> nb_people_infected &lt;- nb_infected_init <span class="hljs-symbol">update:</span> people count (each.is_infected);
    <span class="hljs-literal">int</span> nb_people_not_infected &lt;- nb_people - nb_infected_init <span class="hljs-symbol">update:</span> nb_people - nb_people_infected;
    <span class="hljs-literal">float</span> infected_rate <span class="hljs-symbol">update:</span> nb_people_infected/nb_people;
    
    
    init{
        <span class="hljs-keyword">create</span> road <span class="hljs-symbol">from:</span> roads_shapefile;
        road_network &lt;- as_edge_graph(road);        
        <span class="hljs-keyword">create</span> building <span class="hljs-symbol">from:</span> buildings_shapefile;
        <span class="hljs-keyword">create</span> people <span class="hljs-symbol">number:</span>nb_people {
            location &lt;- any_location_in(one_of(building));                
        }
        <span class="hljs-keyword">ask</span> nb_infected_init among people {
            is_infected &lt;- true;
        }
    }
}

<span class="hljs-literal">species</span> people <span class="hljs-symbol">skills:</span>[<span class="hljs-builtin">moving</span>]{        
    <span class="hljs-literal">float</span> speed &lt;- (2 + rnd(3)) #km/#h;
    <span class="hljs-literal">bool</span> is_infected &lt;- false;
    <span class="hljs-literal">point</span> target;
    
    <span class="hljs-builtin">reflex</span> stay <span class="hljs-symbol">when:</span> target = nil {
        <span class="hljs-keyword">if</span> flip(proba_leave) {
            target &lt;- any_location_in (one_of(building));
        }
    }
        
    <span class="hljs-builtin">reflex</span> move <span class="hljs-symbol">when:</span> target != nil{
        <span class="hljs-keyword">do</span> goto <span class="hljs-symbol">target:</span>target <span class="hljs-symbol">on:</span> road_network;
        <span class="hljs-keyword">if</span> (location = target) {
            target &lt;- nil;
        } 
    }

    <span class="hljs-builtin">reflex</span> infect <span class="hljs-symbol">when:</span> is_infected{
        <span class="hljs-keyword">ask</span> people at_distance infection_distance {
            <span class="hljs-keyword">if</span> flip(proba_infection) {
                is_infected &lt;- true;
            }
        }
    }
    
    <span class="hljs-keyword">aspect</span> circle {
        <span class="hljs-keyword">draw</span> circle(10) <span class="hljs-symbol">color:</span>is_infected ? #red : #green;
    }
    
    <span class="hljs-keyword">aspect</span> geom3D {
        <span class="hljs-keyword">if</span> target != nil {
            <span class="hljs-keyword">draw</span> obj_file(<span class="hljs-string">"../includes/people.obj"</span>, 90::{-1,0,0}) <span class="hljs-symbol">size:</span> 5
            <span class="hljs-symbol">at:</span> location + {0,0,7} <span class="hljs-symbol">rotate:</span> heading - 90 <span class="hljs-symbol">color:</span> is_infected ? #red : #green;
        }
    }
    
}

<span class="hljs-literal">species</span> road {
    <span class="hljs-keyword">aspect</span> geom {
        <span class="hljs-keyword">draw</span> shape <span class="hljs-symbol">color:</span> #black;
    }
    <span class="hljs-keyword">aspect</span> geom3D {
        <span class="hljs-keyword">draw</span> line(shape.points, 2.0) <span class="hljs-symbol">color:</span> #black;
    }
}

<span class="hljs-literal">species</span> building {
    <span class="hljs-keyword">aspect</span> geom {
        <span class="hljs-keyword">draw</span> shape <span class="hljs-symbol">color:</span> #gray;
    }
    <span class="hljs-keyword">aspect</span> geom3D {
        <span class="hljs-keyword">draw</span> shape <span class="hljs-symbol">depth:</span> 20 #m <span class="hljs-symbol">border:</span> #black <span class="hljs-symbol">texture:</span>[<span class="hljs-string">"../includes/roof_top.png"</span>,<span class="hljs-string">"../includes/texture.jpg"</span>];
    }
}

<span class="hljs-builtin">experiment</span> main <span class="hljs-symbol">type:</span> gui {
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Nb people infected at init"</span> <span class="hljs-symbol">var:</span> nb_infected_init <span class="hljs-symbol">min:</span> 1 <span class="hljs-symbol">max:</span> 2147;

    <span class="hljs-keyword">output</span> {
        <span class="hljs-keyword">monitor</span> <span class="hljs-string">"Infected people rate"</span> <span class="hljs-symbol">value:</span> infected_rate;
        
        <span class="hljs-keyword">display</span> <span class="hljs-literal">map</span> {
            <span class="hljs-literal">species</span> road <span class="hljs-symbol">aspect:</span>geom;
            <span class="hljs-literal">species</span> building <span class="hljs-symbol">aspect:</span>geom;
            <span class="hljs-literal">species</span> people <span class="hljs-symbol">aspect:</span>circle;            
        }
    
        <span class="hljs-keyword">display</span> chart_display <span class="hljs-symbol">refresh:</span> every(10 #cycles) {
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"Disease spreading"</span> <span class="hljs-symbol">type:</span> series {
                <span class="hljs-keyword">data</span> <span class="hljs-string">"susceptible"</span> <span class="hljs-symbol">value:</span> nb_people_not_infected <span class="hljs-symbol">color:</span> #green;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"infected"</span> <span class="hljs-symbol">value:</span> nb_people_infected <span class="hljs-symbol">color:</span> #red;
            }
        }
        <span class="hljs-keyword">display</span> view3D <span class="hljs-symbol">type:</span> opengl <span class="hljs-symbol">ambient_light:</span> 80 {
            <span class="hljs-keyword">image</span> <span class="hljs-string">"../includes/luneray.png"</span> <span class="hljs-symbol">refresh:</span>false; 
            <span class="hljs-literal">species</span> building <span class="hljs-symbol">aspect:</span>geom3D <span class="hljs-symbol">refresh:</span> false;
            <span class="hljs-literal">species</span> road <span class="hljs-symbol">aspect:</span> geom3D <span class="hljs-symbol">refresh:</span> false;
            <span class="hljs-literal">species</span> people <span class="hljs-symbol">aspect:</span> geom3D ; 
        }
    }
}

<span class="hljs-builtin">experiment</span> test_robustness <span class="hljs-symbol">type:</span> batch <span class="hljs-symbol">until:</span> time &gt; 2#h <span class="hljs-symbol">repeat:</span> 10 {
    <span class="hljs-builtin">reflex</span> information {
        <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">float</span>&gt; vals &lt;- simulations collect each.infected_rate;
        <span class="hljs-keyword">write</span> <span class="hljs-string">"mean: "</span> + mean(vals) + <span class="hljs-string">" standard deviation: "</span> + standard_deviation(vals);    
    }
}

<span class="hljs-builtin">experiment</span> explore_model <span class="hljs-symbol">type:</span> batch <span class="hljs-symbol">until:</span> time &gt; 2#h <span class="hljs-symbol">repeat:</span> 2 {
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"proba_leave"</span> <span class="hljs-symbol">var:</span> proba_leave <span class="hljs-symbol">among:</span> [0, 0.01, 0.05, 0.1, 1.0];
    
    <span class="hljs-builtin">reflex</span> save_results {
        <span class="hljs-keyword">ask</span> simulations {
            <span class="hljs-keyword">write</span> <span class="hljs-string">"proba_leave: "</span> + proba_leave + <span class="hljs-string">" infected_rate: "</span> + self.infected_rate;
            <span class="hljs-keyword">save</span> [proba_leave, self.infected_rate] <span class="hljs-symbol">type:</span> csv <span class="hljs-symbol">to:</span><span class="hljs-string">"results.csv"</span>;
        }
    }
}

<span class="hljs-builtin">experiment</span> calibration_model <span class="hljs-symbol">type:</span> batch <span class="hljs-symbol">until:</span> time &gt; 2#h <span class="hljs-symbol">repeat:</span> 3 {
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"infection distance"</span> <span class="hljs-symbol">var:</span> infection_distance <span class="hljs-symbol">min:</span> 1.0 <span class="hljs-symbol">max:</span> 20.0 <span class="hljs-symbol">step:</span> 1;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"proba infection"</span> <span class="hljs-symbol">var:</span> proba_infection <span class="hljs-symbol">min:</span> 0.01 <span class="hljs-symbol">max:</span> 1.0 <span class="hljs-symbol">step:</span> 0.01;
    
    method <span class="hljs-keyword">genetic</span> <span class="hljs-symbol">pop_dim:</span> 3 <span class="hljs-symbol">max_gen:</span> 5 <span class="hljs-symbol">minimize:</span> abs(infected_rate - 0.5);
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/wiki/LuneraysFlu_step5"><span class="arrow-prev">← </span><span>5. Definition of 3D displays</span></a><a class="docs-next button" href="/wiki/BDIAgents"><span>BDI Agents</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#formulation">Formulation</a></li><li><a href="#model-definition">Model Definition</a><ul class="toc-headings"><li><a href="#sensitivity-analysis-toward-stochasticity">Sensitivity analysis toward stochasticity</a></li><li><a href="#exploration">Exploration</a></li><li><a href="#calibration">Calibration</a></li></ul></li><li><a href="#complete-model">Complete Model</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a></div><div><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div><h5>Ecosystem</h5><a href="https://github.com/gama-platform/gama"><i class="fab fa-github"></i> GitHub Gama</a><a href="https://github.com/gama-platform/gama.experimental"><i class="fas fa-puzzle-piece"></i> Gama Experimental Plugins</a><a href="https://github.com/gama-platform/gama.models.experimental"><i class="fas fa-scroll"></i> Gama Experimental Models</a></div></section><section class="copyright">Copyright © 2019 GAMA-Platform</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'undefined',
                indexName: 'undefined',
                inputSelector: '#search_input_react'
              });
            </script></body></html>