"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[80328],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),u=o,h=d["".concat(s,".").concat(u)]||d[u]||m[u]||r;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},70316:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>l,metadata:()=>p,toc:()=>m});var a=n(87462),o=n(63366),r=(n(67294),n(3905)),i=["components"],l={title:"Using network"},s=void 0,p={unversionedId:"UsingNetwork",id:"UsingNetwork",title:"Using network",description:"Introduction",source:"@site/../docs/UsingNetwork.md",sourceDirName:".",slug:"/UsingNetwork",permalink:"/wiki/next/UsingNetwork",draft:!1,editUrl:"https://github.com/gama-platform/gama/wiki/UsingNetwork/_edit",tags:[],version:"current",frontMatter:{title:"Using network"},sidebar:"side",previous:{title:"Save and Restore simulations",permalink:"/wiki/next/Save-and-restore-simulations"},next:{title:"Headless mode for dummies",permalink:"/wiki/next/Headless-mode-for-dummies"}},c={},m=[{value:"Introduction",id:"introduction",level:2},{value:"Which protocol to use ?",id:"which-protocol-to-use-",level:2},{value:"Disclaimer",id:"disclaimer",level:2},{value:"Declaring a network species",id:"declaring-a-network-species",level:2},{value:"Creation of a network agent",id:"creation-of-a-network-agent",level:2},{value:"Sending messages",id:"sending-messages",level:2},{value:"Receiving messages",id:"receiving-messages",level:2},{value:"Asynchronous reading",id:"asynchronous-reading",level:3},{value:"Synchronous reading",id:"synchronous-reading",level:3},{value:"Broadcasting a message to all the agents&#39; members of a given group",id:"broadcasting-a-message-to-all-the-agents-members-of-a-given-group",level:2}],d={toc:m};function u(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"GAMA provides features to allow agents to communicate with other agents (and other applications) through network and to exchange messages of various types (from simple number to agents). To this purpose, the ",(0,r.kt)("inlineCode",{parentName:"p"},"network")," skill should be used on agents intending to use these capabilities."),(0,r.kt)("p",null,"Notice that in this communication, roles are asymetric: the simulations should contain a server and some clients to communicate. Message exchanges are made between agents through this server. 6 protocols are supported (TCP, UDP, MQTT, HTTP, Websocket, Arduino):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"when TCP, UDP or Websocket protocols are used:")," Agents can be either clients or server depending on the needs of the simulation."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"when the MQTT protocol is used:")," all the agents are clients and the server is an external software. A free solution (ActiveMQ) can be freely downloaded from: ",(0,r.kt)("a",{parentName:"li",href:"http://activemq.apache.org"},"http://activemq.apache.org"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"when HTTP is used:")," the agents can interact with webpages/webservices through raw GET, POST, PUT, and DELETE requests"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"when arduino is used:")," one agent of the simulation can connect to an Arduino as a client.")),(0,r.kt)("h2",{id:"which-protocol-to-use-"},"Which protocol to use ?"),(0,r.kt)("p",null,"In the GAMA network, 6 kinds of protocol can be used. Each of them has a particular purpose."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"MQTT"),": this is the default protocol that should be used to make agents of various GAMA instances to communicate through a MQTT server (that should be run as an external application, e.g. ActiveMQ that can be downloaded from: ",(0,r.kt)("a",{parentName:"li",href:"http://activemq.apache.org/"},"http://activemq.apache.org/"),"),"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"UDP"),": this protocol should be limited to fast (and unsecured) exchanges of small pieces of data from GAMA to an external application (for example, mouse location from a Processing application to GAMA, c.f. model library),"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"TCP and Websocket"),": these protocols can be used both to communicate between GAMA agents in a simulation or between GAMA and an external application."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"HTTP requests"),": this protocol should be used to communicate with an external webservice."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Arduino"),": this protocol should be used to communicate with an arduino device")),(0,r.kt)("h2",{id:"disclaimer"},"Disclaimer"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"In all the models using any network communication, the server should be launched before the clients."),"\nAs a consequence, when TCP, Websocket or UDP protocols are used, a model creating a server agent should always be run first. Using MQTT protocol, the external software server should be launched before running any model using it."),(0,r.kt)("h2",{id:"declaring-a-network-species"},"Declaring a network species"),(0,r.kt)("p",null,"To create agents able to communicate through a network, their species should have the skill ",(0,r.kt)("inlineCode",{parentName:"p"},"network"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"species Networking_Client skills: [network] {\n    ...\n}\n")),(0,r.kt)("p",null,"A list exhaustive of the additional attributes and available actions provided by this skill are described here:\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gama-platform/gama/wiki/BuiltInSkills#network"},"network skill preference page"),"."),(0,r.kt)("h2",{id:"creation-of-a-network-agent"},"Creation of a network agent"),(0,r.kt)("p",null,"The network agents are created as any other agents, but (in general) at the creation of the agents, the connection is also created, using the ",(0,r.kt)("inlineCode",{parentName:"p"},"connect")," built-in action:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'create Networking_Client {\n    do connect to: "localhost" protocol: "tcp_client" port: 3001 with_name: "Client";\n}\n')),(0,r.kt)("p",null,"Each protocol has its specificities regarding the connection:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"TCP"),": ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"protocol")),": the 2 possibles keywords are ",(0,r.kt)("inlineCode",{parentName:"li"},"tcp_server")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"tcp_client"),", depending on the wanted role of the agent in the communication."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"port")),": traditionally the port ",(0,r.kt)("inlineCode",{parentName:"li"},"3001")," is used."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"raw")),": false by default, it is better to turn it to ",(0,r.kt)("inlineCode",{parentName:"li"},"true")," when communicating with external applications as it will remove all the wrapper informations used for communication inside gama."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Websocket"),": ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"protocol")),": the 2 possibles keywords are ",(0,r.kt)("inlineCode",{parentName:"li"},"websocket_server")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"websocket_client"),", depending on the wanted role of the agent in the communication."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"port")),": traditionally the port ",(0,r.kt)("inlineCode",{parentName:"li"},"3001")," is used."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"raw")),": false by default, it is better to turn it to ",(0,r.kt)("inlineCode",{parentName:"li"},"true")," when communicating with external applications as it will remove all the wrapper informations used for communication inside gama."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"UDP"),": ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"protocol")),": the 2 possibles keywords are ",(0,r.kt)("inlineCode",{parentName:"li"},"udp_server")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"udp_emitter"),", depending on the wanted role of the agent in the communication."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"port")),": traditionally the port ",(0,r.kt)("inlineCode",{parentName:"li"},"9876")," is used."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"MQTT"),": ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"protocol")),": MQTT is the default protocol value (if no value is given, MQTT will be used)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"port")),": traditionally the port ",(0,r.kt)("inlineCode",{parentName:"li"},"1883")," is used (when ActiveMQ is used as the server application)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"admin"))," and ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"password")),': traditionally the default login and password are "admin" (when ActiveMQ is used as the server application)'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"HTTP requests"),": ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"protocol")),": the only keyword to use is ",(0,r.kt)("inlineCode",{parentName:"li"},"http"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"port")),": traditionally the port ",(0,r.kt)("inlineCode",{parentName:"li"},"80")," is used for http connections and ",(0,r.kt)("inlineCode",{parentName:"li"},"443")," for https.")))),(0,r.kt)("p",null,"Note: if no connection information is provided with the MQTT protocol (no ",(0,r.kt)("inlineCode",{parentName:"p"},"port"),"), then GAMA connects to an MQTT server provided by the GAMA community (for test purpose only!)."),(0,r.kt)("h2",{id:"sending-messages"},"Sending messages"),(0,r.kt)("p",null,"To send any message, the agent has to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"send")," action:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'do send to: "server" contents: name + " " + cycle + " sent to server";\n')),(0,r.kt)("p",null,"The network skill in GAMA allows the modeler to send simple string messages between agents but also to send more complex objects (and in particular agents). In this case, the use of the MQTT protocol is highly recommended."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'do send to: "receiver" contents: (9 among NetworkingAgent); \n')),(0,r.kt)("h2",{id:"receiving-messages"},"Receiving messages"),(0,r.kt)("h3",{id:"asynchronous-reading"},"Asynchronous reading"),(0,r.kt)("p",null,"The messages sent by other agents are received in the ",(0,r.kt)("inlineCode",{parentName:"p"},"mailbox")," attribute of each agent. So to get its new message, the agent has simply to check whether it has a new message (with action ",(0,r.kt)("inlineCode",{parentName:"p"},"has_more_message()")," ) and fetch it (that gets it and remove it from the mailing box) with the action ",(0,r.kt)("inlineCode",{parentName:"p"},"fetch_message()"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'reflex fetch when: has_more_message() { \n    message mess <- fetch_message();\n    write name + " fecth this message: " + mess.contents;   \n}\n')),(0,r.kt)("p",null,"Note that when an agent is received, the fetch of the message will recreate the agent in the current simulation."),(0,r.kt)("p",null,"Alternatively, the ",(0,r.kt)("inlineCode",{parentName:"p"},"mailbox")," attribute can be directly accessed (notice that the ",(0,r.kt)("inlineCode",{parentName:"p"},"mailbox")," is a list of messages):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"reflex receive {  \n    if (length(mailbox) > 0) {\n        write mailbox;\n    }\n}\n")),(0,r.kt)("h3",{id:"synchronous-reading"},"Synchronous reading"),(0,r.kt)("p",null,"In certain cases you need to wait for a message from another application to continue the execution of your simulation.\nTo do so, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"fetch_message_from_network")," action to force the mailbox to refresh (which normally is only done once per cycle) until you receive a message:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'reflex fetch {\n    write "waiting for server to send data"; \n    loop while: !has_more_message()  { \n        do fetch_message_from_network;\n    }\n    \n    //This second loop will only be reached once a message has been found into the agent\'s mailbox\n    loop while: has_more_message() {\n        message s <- fetch_message();\n        write "" + cycle + "received from server: " + s.contents;\n    }\n}\n')),(0,r.kt)("h2",{id:"broadcasting-a-message-to-all-the-agents-members-of-a-given-group"},"Broadcasting a message to all the agents' members of a given group"),(0,r.kt)("p",null,"Each time an agent creates a connection to another agent as a client, a way to communicate with it is stored in the ",(0,r.kt)("inlineCode",{parentName:"p"},"network_groups")," attribute.\nSo an agent can use this attribute to broadcast messages to all the agents with whose it can communicate: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'reflex broad {\n    loop id over: network_groups {\n        do send to: id contents: "I am Server " + name + " I give order to " + id;\n    }\n}\n')),(0,r.kt)("p",null,"To go further:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"BuiltInSkills#network"},"network skill reference page"),"."),(0,r.kt)("li",{parentName:"ul"},"example models can be found in the GAMA model library, in: ",(0,r.kt)("inlineCode",{parentName:"li"},"Plugin models > Network"),".")))}u.isMDXComponent=!0}}]);