<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Comodel SIR Switch · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="[//]: # (keyword|operator_diff)"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Comodel SIR Switch · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gama-platform.github.io/"/><meta property="og:description" content="[//]: # (keyword|operator_diff)"/><meta property="og:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://gama-platform.github.io/blog/atom.xml" title="GAMA-Platform Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://gama-platform.github.io/blog/feed.xml" title="GAMA-Platform Blog RSS Feed"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/searchEngine.js"></script><script type="text/javascript" src="/js/dark.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/gama-logo_white.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/wiki/Home" target="_self">Documentation</a></li><li class=""><a href="/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Comodel SIR Switch</h1></header><article><div><span><p><em>Author : HUYNH Quang Nghi</em></p>
<p>This is a comodel that implement the dynamic of SIR_switch: it will use the EBM when the density of population is big and ABM when the density of population is low. It demonstrate the capability of using dynamically the legacy models.
SIR_ABM_coupling is the coupling that manipulates the elements inside SIR_ABM model and proposes the function would be used from outside. SIR_ABM is a simple example of SIR that use the agents to represent the spreading of disease..
SIR_EBM_coupling is the coupling that manipulates the elements inside SIR_EBM model and proposes the function would be used from outside. SIR_EBM is a simple example of ODE use into agents with the example of the SIR equation system.</p>
<p>Imported models :</p>
<pre><code class="hljs"><span class="hljs-builtin">model</span> SIR_ABM 

global{
    <span class="hljs-literal">geometry</span> shape&lt;-envelope(square(100));
    <span class="hljs-literal">float</span> beta &lt;- 0.5 ;      
    <span class="hljs-literal">float</span> nu &lt;- 0.001 ;
    <span class="hljs-literal">float</span> delta &lt;- 0.01;
    init{
        <span class="hljs-keyword">create</span> Host <span class="hljs-symbol">number:</span>495 ;
        <span class="hljs-keyword">create</span> Host <span class="hljs-symbol">number:</span>5{<span class="hljs-keyword">state</span>&lt;-1;}
        
    }
}

<span class="hljs-literal">species</span> Host <span class="hljs-symbol">skills:</span>[<span class="hljs-builtin">moving</span>]{
    <span class="hljs-literal">int</span> <span class="hljs-keyword">state</span>&lt;-0;
    <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">rgb</span>&gt; color&lt;-[#green, #red, #yellow];
    <span class="hljs-builtin">reflex</span> <span class="hljs-builtin">moving</span>{
        <span class="hljs-keyword">do</span> wander;
    }


    
    <span class="hljs-builtin">reflex</span> become_infected <span class="hljs-symbol">when:</span> <span class="hljs-keyword">state</span>=1 {
        <span class="hljs-literal">list</span> n&lt;- self neighbors_at(1);
        <span class="hljs-keyword">ask</span> n{          
            <span class="hljs-keyword">if</span> (flip(beta)) {
                <span class="hljs-keyword">state</span>&lt;-1;    
            }
        }
    }
    
    <span class="hljs-builtin">reflex</span> become_immune <span class="hljs-symbol">when:</span> (<span class="hljs-keyword">state</span>=1 and flip(delta)) {
        <span class="hljs-keyword">state</span>&lt;-2;
    }
    
            
    <span class="hljs-keyword">aspect</span> base{
        <span class="hljs-keyword">draw</span> circle(1) <span class="hljs-symbol">color:</span> color[<span class="hljs-keyword">state</span>];
    }
}
<span class="hljs-builtin">experiment</span> SIR_ABM_exp <span class="hljs-symbol">type:</span>gui{
    <span class="hljs-keyword">output</span> {
        <span class="hljs-keyword">display</span> gridDisp{
            <span class="hljs-literal">species</span> Host <span class="hljs-symbol">aspect:</span>base;
        }
    }
}
</code></pre>
<pre><code class="hljs"><span class="hljs-builtin">model</span> SIR_ABM_coupling

import <span class="hljs-string">"SIR_ABM.gaml"</span>
<span class="hljs-builtin">experiment</span> SIR_ABM_coupling_exp <span class="hljs-symbol">type:</span> gui <span class="hljs-symbol">parent:</span> SIR_ABM_exp
{
    <span class="hljs-literal">int</span> get_num_S
    {
        <span class="hljs-keyword">return</span> length(Host where (each.<span class="hljs-keyword">state</span> = 0));
    }

    <span class="hljs-literal">int</span> get_num_I
    {
        <span class="hljs-keyword">return</span> length(Host where (each.<span class="hljs-keyword">state</span> = 1));
    }

    <span class="hljs-literal">int</span> get_num_R
    {
        <span class="hljs-keyword">return</span> length(Host where (each.<span class="hljs-keyword">state</span> = 2));
    }

    <span class="hljs-keyword">action</span> set_num_S_I_R (<span class="hljs-literal">int</span> numS, <span class="hljs-literal">int</span> numI, <span class="hljs-literal">int</span> numR)
    {
        unknown call;
        call &lt;- set_num_S(numS);
        call &lt;- set_num_I(numI);
        call &lt;- set_num_R(numR);
    }

    <span class="hljs-keyword">action</span> set_num_S (<span class="hljs-literal">int</span> num)
    {
        <span class="hljs-keyword">ask</span> (Host where (each.<span class="hljs-keyword">state</span> = 0))
        {
            <span class="hljs-keyword">do</span> die;
        }

        <span class="hljs-keyword">create</span> Host <span class="hljs-symbol">number:</span> num
        {
            <span class="hljs-keyword">state</span> &lt;- 0;
        }

    }

    <span class="hljs-keyword">action</span> set_num_I (<span class="hljs-literal">int</span> num)
    {
        <span class="hljs-keyword">ask</span> (Host where (each.<span class="hljs-keyword">state</span> = 1))
        {
            <span class="hljs-keyword">do</span> die;
        }

        <span class="hljs-keyword">create</span> Host <span class="hljs-symbol">number:</span> num
        {
            <span class="hljs-keyword">state</span> &lt;- 1;
        }

    }

    <span class="hljs-keyword">action</span> set_num_R (<span class="hljs-literal">int</span> num)
    {
        <span class="hljs-keyword">ask</span> (Host where (each.<span class="hljs-keyword">state</span> = 2))
        {
            <span class="hljs-keyword">do</span> die;
        }

        <span class="hljs-keyword">create</span> Host <span class="hljs-symbol">number:</span> num
        {
            <span class="hljs-keyword">state</span> &lt;- 2;
        }

    }

    <span class="hljs-keyword">output</span>
    {
    }

}
</code></pre>
<pre><code class="hljs"><span class="hljs-builtin">model</span> SIR_EBM

global {
    init{
        <span class="hljs-keyword">create</span> agent_with_SIR_dynamic;
    } 
}


<span class="hljs-literal">species</span> agent_with_SIR_dynamic {
    <span class="hljs-literal">int</span> N &lt;- 495 ;
    <span class="hljs-literal">int</span> iInit &lt;- 5;     

    <span class="hljs-literal">float</span> t;  
    <span class="hljs-literal">float</span> S &lt;- N - <span class="hljs-literal">float</span>(iInit);          
    <span class="hljs-literal">float</span> I &lt;- <span class="hljs-literal">float</span>(iInit); 
    <span class="hljs-literal">float</span> R &lt;- 0.0; 
    
    <span class="hljs-literal">float</span> alpha &lt;- 0.2;
    <span class="hljs-literal">float</span> beta &lt;- 0.8; 

    <span class="hljs-literal">float</span> h &lt;- 0.01;
   
    <span class="hljs-keyword">equation</span> SIR{ 
        diff(S,t) = (- beta *   S * I / N);
        diff(I,t) = (  beta*  S * I / N) - (alpha * I)  ;
        diff(R,t) = (  alpha  *  I) ;
    }
                
    <span class="hljs-builtin">reflex</span> solving {
<span class="hljs-comment">//      write S;</span>
        <span class="hljs-keyword">solve</span> SIR <span class="hljs-symbol">method:</span> <span class="hljs-string">"rk4"</span> <span class="hljs-symbol">step:</span> h;<span class="hljs-comment">// cycle_length: 1/h ;</span>
    }    
}


<span class="hljs-builtin">experiment</span> SIR_EBM_exp <span class="hljs-symbol">type:</span> gui {
    <span class="hljs-keyword">output</span> { 
        <span class="hljs-keyword">display</span> display_charts {
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"SIR_agent"</span> <span class="hljs-symbol">type:</span> series <span class="hljs-symbol">background:</span> #white {
                <span class="hljs-keyword">data</span> <span class="hljs-string">'S'</span> <span class="hljs-symbol">value:</span> first(<span class="hljs-literal">list</span>(agent_with_SIR_dynamic)).S <span class="hljs-symbol">color:</span> #green ;               
                <span class="hljs-keyword">data</span> <span class="hljs-string">'I'</span> <span class="hljs-symbol">value:</span> first(<span class="hljs-literal">list</span>(agent_with_SIR_dynamic)).I <span class="hljs-symbol">color:</span> #red ;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'R'</span> <span class="hljs-symbol">value:</span> first(<span class="hljs-literal">list</span>(agent_with_SIR_dynamic)).R <span class="hljs-symbol">color:</span> #blue ;
            }
        }
    }
}
</code></pre>
<pre><code class="hljs"><span class="hljs-builtin">model</span> SIR_EBM_coupling

import <span class="hljs-string">"SIR_EBM.gaml"</span>
<span class="hljs-builtin">experiment</span> SIR_EBM_coupling_exp <span class="hljs-symbol">type:</span> gui <span class="hljs-symbol">parent:</span> SIR_EBM_exp
{
    <span class="hljs-literal">int</span> get_num_S
    {
        <span class="hljs-keyword">return</span> first(agent_with_SIR_dynamic).S;
    }

    <span class="hljs-literal">int</span> get_num_I
    {
        <span class="hljs-keyword">return</span> first(agent_with_SIR_dynamic).I;
    }

    <span class="hljs-literal">int</span> get_num_R
    {
        <span class="hljs-keyword">return</span> first(agent_with_SIR_dynamic).R;
    }

    <span class="hljs-keyword">action</span> set_num_S_I_R (<span class="hljs-literal">int</span> numS, <span class="hljs-literal">int</span> numI, <span class="hljs-literal">int</span> numR)
    {
        unknown call;
        call &lt;- set_num_S(numS);
        call &lt;- set_num_I(numI);
        call &lt;- set_num_R(numR);
    }

    <span class="hljs-keyword">action</span> set_num_S (<span class="hljs-literal">int</span> num)
    {
        first(agent_with_SIR_dynamic).S &lt;- <span class="hljs-literal">float</span>(num);
    }

    <span class="hljs-keyword">action</span> set_num_I (<span class="hljs-literal">int</span> num)
    {
        first(agent_with_SIR_dynamic).I &lt;- <span class="hljs-literal">float</span>(num);
    }

    <span class="hljs-keyword">action</span> set_num_R (<span class="hljs-literal">int</span> num)
    {
        first(agent_with_SIR_dynamic).R &lt;- <span class="hljs-literal">float</span>(num);
    }

    <span class="hljs-keyword">output</span>
    {
    }

}
</code></pre>
<p>Code of the model :</p>
<pre><code class="hljs"><span class="hljs-builtin">model</span> Comodel_SIR_Switch

import <span class="hljs-string">"Legacy_models/SIR_EBM_coupling.gaml"</span> as SIR_1
import <span class="hljs-string">"Legacy_models/SIR_ABM_coupling.gaml"</span> as SIR_2


global
{
    <span class="hljs-literal">geometry</span> shape &lt;- envelope(square(100));
    <span class="hljs-literal">int</span> switch_threshold &lt;- 120; <span class="hljs-comment">// threshold for switching models</span>
    <span class="hljs-literal">int</span> threshold_to_IBM &lt;- 220; <span class="hljs-comment">// threshold under which the model swith to IBM</span>
    <span class="hljs-literal">int</span> threshold_to_Maths &lt;- 20;
    init
    {
        <span class="hljs-keyword">create</span> SIR_1.SIR_EBM_coupling_exp;
        <span class="hljs-keyword">create</span> SIR_2.SIR_ABM_coupling_exp;
        <span class="hljs-keyword">create</span> Switch;
    }

}

<span class="hljs-literal">species</span> Switch
{
    <span class="hljs-literal">int</span> S &lt;- 495;
    <span class="hljs-literal">int</span> I &lt;- 5;
    <span class="hljs-literal">int</span> R &lt;- 0;
    <span class="hljs-builtin">reflex</span> request_from_micro_model
    {
        <span class="hljs-comment">//if the size of S population and I population are bigger than a threshold, use the EBM</span>
        <span class="hljs-keyword">if</span> (S &gt; threshold_to_Maths and I &gt; threshold_to_Maths)
        {
            <span class="hljs-keyword">ask</span> world
            {
                unknown call;
                call &lt;- first(SIR_1.SIR_EBM_coupling_exp).set_num_S_I_R(myself.S, myself.I, myself.R);
                <span class="hljs-keyword">ask</span> first(SIR_1.SIR_EBM_coupling_exp).simulation
                {
                    <span class="hljs-keyword">loop</span> <span class="hljs-symbol">times:</span> 5
                    {
                        <span class="hljs-keyword">do</span> _step_;
                    }

                }

                myself.S &lt;- first(SIR_1.SIR_EBM_coupling_exp).get_num_S();
                myself.I &lt;- first(SIR_1.SIR_EBM_coupling_exp).get_num_I();
                myself.R &lt;- first(SIR_1.SIR_EBM_coupling_exp).get_num_R();
            }

        }
        
        <span class="hljs-comment">//if the size of S population or  I population are smaller  than a threshold, use the ABM</span>
        <span class="hljs-keyword">if</span> (I &lt; threshold_to_IBM or S &lt; threshold_to_IBM)
        {
            <span class="hljs-keyword">ask</span> world
            {
                unknown call;
                call &lt;- first(SIR_2.SIR_ABM_coupling_exp).set_num_S_I_R(myself.S, myself.I, myself.R);
                <span class="hljs-keyword">ask</span> first(SIR_2.SIR_ABM_coupling_exp).simulation
                {
                    <span class="hljs-keyword">loop</span> <span class="hljs-symbol">times:</span> 1
                    {
                        <span class="hljs-keyword">do</span> _step_;
                    }

                }

                myself.S &lt;- first(SIR_2.SIR_ABM_coupling_exp).get_num_S();
                myself.I &lt;- first(SIR_2.SIR_ABM_coupling_exp).get_num_I();
                myself.R &lt;- first(SIR_2.SIR_ABM_coupling_exp).get_num_R();
            }

        }

    }

    <span class="hljs-keyword">aspect</span> base
    {
        <span class="hljs-keyword">draw</span> square(100);
    }

}

<span class="hljs-builtin">experiment</span> Simple_exp <span class="hljs-symbol">type:</span> gui
{
    <span class="hljs-keyword">output</span>
    {
        <span class="hljs-keyword">display</span> co_SIR_chart
        {
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"SIR_agent"</span> <span class="hljs-symbol">type:</span> series <span class="hljs-symbol">background:</span> # white
            {
                <span class="hljs-keyword">data</span> <span class="hljs-string">'S'</span> <span class="hljs-symbol">value:</span> first(Switch).S <span class="hljs-symbol">color:</span> # green;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'I'</span> <span class="hljs-symbol">value:</span> first(Switch).I <span class="hljs-symbol">color:</span> # red;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'R'</span> <span class="hljs-symbol">value:</span> first(Switch).R <span class="hljs-symbol">color:</span> # yellow;
            }

        }

    }

}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap" style="margin-bottom:0"><a href="/" class="nav-home"><img src="/img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://github.com/gama-platform"><i class="fab fa-github"></i> GitHub</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://gama-platform.github.io/blog/feed" target="_blank"><i class="fa fa-rss"></i> Blog RSS</a></div><div style="flex-grow:2"><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div style="color:hsla(0,0%,100%,.4);flex-grow:3"><h5>License</h5><p>Copyright (C) - 2019 GAMA-Platform.</p><p>Permission is granted to copy, distribute and/or modify this document under the terms of the GNU Free Documentation License, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.</p><p>A copy of the license is included <a href="https://github.com/gama-platform/gama/wiki/LICENSE.md" style="display:initial">here</a>, in the repository of the wiki content.</p></div></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.fbAsyncInit = function() {FB.init({appId:'524881055001796',xfbml:true,version:'v2.7'});};(function(d, s, id){var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) {return;}js = d.createElement(s); js.id = id;js.src = '//connect.facebook.net/en_US/sdk.js';fjs.parentNode.insertBefore(js, fjs);}(document, 'script','facebook-jssdk'));
                </script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'undefined',
                indexName: 'undefined',
                inputSelector: '#search_input_react'
              });
            </script></body></html>