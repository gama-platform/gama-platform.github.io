# .travis.yml
language: node_js
dist: trusty
node_js:
  - '8'
branches:
  only:
    - sources
cache:
  yarn: true
addons:
  sonarcloud:
    organization: "gama-platform"
    token:
      secure: "EN2fcWfAsX8NEGPy3fxAtjK0D+scOyGPHCvfDdUi053o9isFF843L+rxESIueOOPT451VyQL+wMxUob5oOWeMYqTKMnoXFOORLCuG4V399OlGdK43DJ4lyfCfgDoCK5fAlT0/J6nm6lZSAGZoN5Pr5yySBJJVh0GuZu72EC78F64I0mGeZvt1z3QWdaILZzxdw7lvUxwj4sjBaiCKpFWNUIP6dxnbq5GrcoZzXP5XQQ5VC6ZJpl434zVfQMs7awgosxhhejrZydrgvddbbUr4yZkRe+FgtC6ibeBcKtg8bB9s2D06wMPDMmiCJndmfgicNArwUj8V9pBSnQa1bphX4vCxaJO5GSFac+CJCIUSVTgr+1JC3pzuXWFHSnXV1qIsURnTOsnWXSespYufBZ+toIy/khAyIZ+7R/PXjIQXRZfj1dffqAXuCJxb8yAKDzA4aSs4JXheEGs82ALgtmZkcymS3EN+Jwrnis0HjwVXpyH2BNkK9CPFzCGmy5EALhVAmREd0QoEVL765PJbKYkzoblgV52VUZ2oR9eUv50fF/+VoEgEr3oiQBWPoDQ7JyuREMqpE7z5LACdLztR2dYAAZRMNEzCnW1bA0ZMlLDhPTHGB6glQfCFTocC2HI6mAb0oD9HDYKFKe1LPHPpzzTpOCYs6QSNjf6DTli+/z+f3g=" # encrypted value of your token
      
before_script:
  # the following command line builds the project, runs the tests with coverage and then execute the SonarCloud analysis
  - sonar-scanner -X -Dsonar.projectKey=gama-platform_gama-platform.github.io -Dsonar.projectName=gama-platform.github.io -Dsonar.projectVersion=1.0.0 -Dsonar.sources=. -Dsonar.language=js -Dsonar.host.url=https://sonarcloud.io

  #  Setup
  - git config --global user.name "${GH_NAME}"
  - git config --global user.email "${GH_EMAIL}"
  - echo "machine github.com login ${GH_NAME} password ${BOT_TOKEN}" > ~/.netrc

script:  
  #  Get new wiki
  - git clone https://github.com/gama-platform/gama.wiki.git
  
  #  Reorganise folders to be more Docusaurus-friendly
  - sh ./script/unstructurize.sh
  - sh ./script/link_fixer.sh
  - sed -i '/^$/d' './docs/_Sidebar.md' # Remove blank line
  - php script/sidebarCopy.php
  - php script/sidebarSearch.php
  - sh script/autoHeader.sh

  #  Compile website
  - cd website && yarn install && GIT_USER="${GH_NAME}" yarn run publish-gh-pages

