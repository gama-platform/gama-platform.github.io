"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[35676],{64753:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"UsingDatabase","title":"Using Database Access","description":"Database features of GAMA provide a set of actions on Database Management Systems (DBMS). Database features are implemented in the irit.gaml.extensions.database plug-in with these features:","source":"@site/versioned_docs/version-1.9.3/UsingDatabase.md","sourceDirName":".","slug":"/UsingDatabase","permalink":"/wiki/UsingDatabase","draft":false,"unlisted":false,"editUrl":"https://github.com/gama-platform/gama/wiki/UsingDatabase/_edit","tags":[],"version":"1.9.3","frontMatter":{"title":"Using Database Access"},"sidebar":"main","previous":{"title":"Implementing diffusion","permalink":"/wiki/Diffusion"},"next":{"title":"Using FIPA ACL","permalink":"/wiki/UsingFIPAACL"}}');var i=t(74848),a=t(28453);const r={title:"Using Database Access"},c=void 0,o={},d=[{value:"Description",id:"description",level:2},{value:"Supported DBMS",id:"supported-dbms",level:2},{value:"SQLSKILL skill",id:"sqlskill-skill",level:2},{value:"Define a species that uses the <code>SQLSKILL</code> skill",id:"define-a-species-that-uses-the-sqlskill-skill",level:3},{value:"Map of connection parameters for SQL",id:"map-of-connection-parameters-for-sql",level:3},{value:"Action <code>testConnection</code>: test a connection to a database",id:"action-testconnection-test-a-connection-to-a-database",level:3},{value:"Action <code>select</code>: select data from a database",id:"action-select-select-data-from-a-database",level:3},{value:"Action <code>insert</code>: Insert data into a database",id:"action-insert-insert-data-into-a-database",level:3},{value:"Action <code>executeUpdate</code>: Execution update commands",id:"action-executeupdate-execution-update-commands",level:3},{value:"AgentDB",id:"agentdb",level:2},{value:"Define a species that is an inheritance of <code>AgentDB</code>",id:"define-a-species-that-is-an-inheritance-of-agentdb",level:3},{value:"Action <code>connect</code>: Connect to a database",id:"action-connect-connect-to-a-database",level:3},{value:"Action <code>isConnected</code>: Check whether an agent is connected to a database",id:"action-isconnected-check-whether-an-agent-is-connected-to-a-database",level:3},{value:"Action <code>close</code>: Close the current connection",id:"action-close-close-the-current-connection",level:3},{value:"Action <code>getParameter</code>: Get connection parameters",id:"action-getparameter-get-connection-parameters",level:3},{value:"Set connection parameters",id:"set-connection-parameters",level:3},{value:"Retrieve data from a database by using <code>AgentDB</code>",id:"retrieve-data-from-a-database-by-using-agentdb",level:3},{value:"Using database features to define the environment and create agents",id:"using-database-features-to-define-the-environment-and-create-agents",level:2},{value:"Define the boundary of the environment from the database",id:"define-the-boundary-of-the-environment-from-the-database",level:3},{value:"Create agents from the result of a <code>select</code> action",id:"create-agents-from-the-result-of-a-select-action",level:3},{value:"Save Geometry data to database",id:"save-geometry-data-to-database",level:3}];function l(e){const n={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Database features of GAMA provide a set of actions on Database Management Systems (DBMS). Database features are implemented in the irit.gaml.extensions.database plug-in with these features:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Agents can execute SQL queries (create, Insert, select, update, drop, delete) to various kinds of DBMS."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["These features are implemented in two kinds of components: skill (",(0,i.jsx)(n.code,{children:"SQLSKILL"}),") and agent (",(0,i.jsx)(n.code,{children:"AgentDB"}),")."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"SQLSKILL"})," and ",(0,i.jsx)(n.code,{children:"AgentDB"})," provide almost the same features (the same set of actions on DBMS) but with certain slight differences:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["An agent of species ",(0,i.jsx)(n.code,{children:"AgentDB"})," will maintain a unique connection to the database during the whole simulation. The connection is thus initialized when the agent is created and destroyed when it is killed."]}),"\n",(0,i.jsxs)(n.li,{children:["In contrast, an agent of a species with the ",(0,i.jsx)(n.code,{children:"SQLSKILL"})," skill will open a connection each time it wants to execute a query. This means that each action will be composed of three running steps:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Make a database connection."}),"\n",(0,i.jsx)(n.li,{children:"Execute an SQL statement."}),"\n",(0,i.jsx)(n.li,{children:"Close database connection."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["An agent with the ",(0,i.jsx)(n.code,{children:"SQLSKILL"})," spends a lot of time to create/close the connection each time it needs to send a query; it saves the database connection (a DBMS often limits the number of simultaneous connections). In contrast, an ",(0,i.jsx)(n.code,{children:"AgentDB"})," agent only needs to establish one database connection that can be used for any action. Because it does not need to create and close the database connection for each action, therefore actions of ",(0,i.jsx)(n.code,{children:"AgentDB"})," agents are executed faster than the actions of ",(0,i.jsx)(n.code,{children:"SQLSKILL"})," ones but we must pay a connection for each agent."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["With an inheritance agent of species ",(0,i.jsx)(n.code,{children:"AgentDB"})," or an agent of a species using ",(0,i.jsx)(n.code,{children:"SQLSKILL"}),", we can query data from relational database to create agents, define the environment, or analyze or store simulation results in RDBMS. The database features help us to have more flexibility in the management of simulation models and analysis of simulation results."]}),"\n",(0,i.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Plug-in"}),": ",(0,i.jsx)(n.em,{children:"irit.gaml.extensions.database"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Author"}),": TRUONG Minh Thai, Frederic AMBLARD, Benoit GAUDOU, Christophe SIBERTIN-BLANC"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"supported-dbms",children:"Supported DBMS"}),"\n",(0,i.jsx)(n.p,{children:"The following DBMS are currently supported:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SQLite"}),"\n",(0,i.jsx)(n.li,{children:"MySQL"}),"\n",(0,i.jsxs)(n.li,{children:["PostgreSQL: ",(0,i.jsx)(n.strong,{children:"The GIS extension needs to be installed and activated in the database."})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Note that, MySQL and Postgres DBMSs require a dedicated server to work while SQLite only needs a file to be accessed."}),"\n",(0,i.jsx)(n.p,{children:"All the actions are independent from the chosen DBMS. Only the connection parameters are DBMS-dependent."}),"\n",(0,i.jsx)(n.p,{children:"We chose to implement 3 main query actions:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"select"}),": that will execute the SELECT SQL queries. It will return a result dataset."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"insert"}),": that will execute the INSERT SQL queries. It will return the number of records that are affected by the SQL query."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"executeUpdate"}),": that can execute any CREATE/INSERT/DROP/DELETE SQL queries (basically all the queries that do not return a dataset. It generalizes the ",(0,i.jsx)(n.code,{children:"insert"})," action."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"sqlskill-skill",children:"SQLSKILL skill"}),"\n",(0,i.jsxs)(n.h3,{id:"define-a-species-that-uses-the-sqlskill-skill",children:["Define a species that uses the ",(0,i.jsx)(n.code,{children:"SQLSKILL"})," skill"]}),"\n",(0,i.jsx)(n.p,{children:"Example of declaration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"species toto skills: [SQLSKILL] {\n\t//insert your descriptions here\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Agents with such a skill can use new actions defined in the skill. All these actions need information for the database connection."}),"\n",(0,i.jsx)(n.h3,{id:"map-of-connection-parameters-for-sql",children:"Map of connection parameters for SQL"}),"\n",(0,i.jsxs)(n.p,{children:["In the actions defined in the ",(0,i.jsx)(n.code,{children:"SQLSKILL"}),", a parameter containing the connection parameters is required. It is a map with ",(0,i.jsx)(n.em,{children:"key::value"})," pairs with the following ",(0,i.jsx)(n.strong,{children:"keys"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"dbtype"}),' (mandatory): DBMS type value. Its value is a string. We must use "mysql" when we want to connect to a MySQL. That is the same for "postgres", "sqlite" (ignore case sensitive)']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"host"})," (optional): Host name or IP address of data server. It is absent when we work with SQlite."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"})," (optional): Port of connection. It is not required when we work with SQLite."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"database"}),"  (mandatory): Name of database. It is the file name including the path when we work with SQLite."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"user"})," (optional): Username. It is not required when we work with SQLite."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"passwd"}),"  (optional): Password. It is not required when we work with SQLite."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"srid"})," (optional): srid (Spatial Reference Identifier) corresponds to a spatial reference system. This value is specified when GAMA connects to spatial database. If it is absent then GAMA uses spatial reference system defined in ",(0,i.jsx)(n.em,{children:"Preferences->External"})," configuration."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),": Definitions of connection parameters"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"// POSTGRES connection parameter\nmap <string, string>  POSTGRES <- [\n     'host'::'localhost',\n     'dbtype'::'postgres',\n     'database'::'BPH',\n     'port'::'5432',\n     'user'::'postgres',\n     'passwd'::'abc'];\n\n//SQLite\nmap <string, string>  SQLITE <- [\n    'dbtype'::'sqlite',\n    'database'::'../includes/meteo.db'];\n\n// MySQL connection parameter\nmap <string, string>  MySQL <- [\n    'host'::'localhost',\n    'dbtype'::'MySQL',\n    'database'::'', // it may be a empty string\n    'port'::'3306',\n    'user'::'root',\n    'passwd'::'abc'];\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"action-testconnection-test-a-connection-to-a-database",children:["Action ",(0,i.jsx)(n.code,{children:"testConnection"}),": test a connection to a database"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.em,{children:[(0,i.jsx)(n.strong,{children:"testConnection"})," (params: map <string, string>)"]}),"\nThe action tests the connection to a given database."]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Return"}),": boolean. It is:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"true"}),": the agent can connect to the DBMS (to the given Database with the given name and password)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"false"}),": the agent cannot connect (either the server is not started, the database does not exist or the user/password are not correct)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Arguments"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"params"})," (type = ",(0,i.jsx)(n.code,{children:"map <string, string>"}),"): map of connection parameters"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Exceptions"}),": ",(0,i.jsx)(n.em,{children:"GamaRuntimeException"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),": Check a connection to a MySQL database."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'// Needs to be executed in the context of an agent with the SQLSKILL skill.\n// MySQL is the connection parameters map defined above.\nif (testConnection(MySQL)){\n\twrite "Connection is OK" ;\n}else{\n\twrite "Connection is false" ;\n}\t\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"action-select-select-data-from-a-database",children:["Action ",(0,i.jsx)(n.code,{children:"select"}),": select data from a database"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.em,{children:[(0,i.jsx)(n.strong,{children:"select"})," (params: map <string, string>, select: string, values: list)"]}),"\nThe action creates a connection to a DBMS and executes the select statement. If the connection or selection fails then it throws a GamaRuntimeException."]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Return"}),": ",(0,i.jsx)(n.code,{children:"list<list>"}),". If the selection succeeds, it returns a list with three elements:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The first element is a list of column names."}),"\n",(0,i.jsx)(n.li,{children:"The second element is a list of column types."}),"\n",(0,i.jsx)(n.li,{children:"The third element is a data set."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Arguments"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"params"})," (type = map<string,string>): map containing the connection parameters"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"select"})," (type = string): A SQL query returning values, i.e. a SELECT query. The selection query can be a parametric query (i.e. it can contain question marks)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"values"})," (type = list): List of values that are used to replace question marks. This is an optional parameter."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Exceptions"}),": ",(0,i.jsx)(n.em,{children:"GamaRuntimeException"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),": select data from table points."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"map <string, string>   PARAMS <- ['dbtype'::'sqlite', 'database'::'../includes/meteo.db'];\nlist<list> t <- select(PARAMS, \"SELECT * FROM points ;\");\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),": select data from table point with question marks from table points."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"map <string, string> PARAMS <- ['dbtype'::'sqlite', 'database'::'../includes/meteo.db'];\nlist<list> t <- select(params: PARAMS, \n                       select: \"SELECT temp_min FROM points where (day>? and day<?);\",\n                       values: [10,20] );\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"action-insert-insert-data-into-a-database",children:["Action ",(0,i.jsx)(n.code,{children:"insert"}),": Insert data into a database"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.em,{children:[(0,i.jsx)(n.strong,{children:"insert"})," (param: map<string,string>,  into:  string, columns: list<string>, values: list)"]}),"\nThe action creates a connection to a DBMS and executes the insert statement. If the connection or insertion fails then it throws a_GamaRuntimeException_."]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Return"}),": int"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"If the insertion succeeds, it returns a number of records inserted by the insert."}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Arguments"}),":\n*",(0,i.jsx)(n.code,{children:"params"})," (type = map<string,string>): map containing the connection parameters.\n*",(0,i.jsx)(n.code,{children:"into"})," (type = string): the table name.\n*",(0,i.jsx)(n.code,{children:"columns"})," (type=list<string>): list of column names of the table. It is an optional argument. If it is not specified then all columns of table are selected.\n*",(0,i.jsx)(n.code,{children:"values"})," (type=list): list of values that are used to insert into the table chosen columns. Hence the columns and values must have same size."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Exceptions"}),":_GamaRuntimeException"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),": Insert data into table registration."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"map<string, string> PARAMS <- ['dbtype'::'sqlite', 'database'::'../../includes/Student.db'];\n\ndo insert (params: PARAMS, \n           into: \"registration\", \n           values: [102, 'Mahnaz', 'Fatma', 25]);\n\ndo insert (params: PARAMS, \n                into: \"registration\", \n                columns: [\"id\", \"first\", \"last\"], \n                values: [103, 'Zaid tim', 'Kha']);\n\nint n <- insert (params: PARAMS, \n                 into: \"registration\", \n                 columns: [\"id\", \"first\", \"last\"], \n                 values: [104, 'Bill', 'Clark']);\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"action-executeupdate-execution-update-commands",children:["Action ",(0,i.jsx)(n.code,{children:"executeUpdate"}),": Execution update commands"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.em,{children:[(0,i.jsx)(n.strong,{children:"executeUpdate"})," (param: map<string,string>, updateComm:  string, columns: list<string>, values: list)"]}),"\nThe action executeUpdate executes an update command (create/insert/delete/drop) by using the current database connection of the agent. If the database connection or the update command fails then it throws a GamaRuntimeException. Otherwise, it returns an integer value."]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Return"}),": int. It returns a number of records affected by the SQL query."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Arguments"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"params"})," (type = map<string,string>): map containing the connection parameters,"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"updateComm"})," (type = string): SQL query string. It may be one of the SQL commands: ",(0,i.jsx)(n.em,{children:"create"}),", ",(0,i.jsx)(n.em,{children:"update"}),", ",(0,i.jsx)(n.em,{children:"delete"})," and ",(0,i.jsx)(n.em,{children:"drop"})," with or without question marks."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"columns"})," (type=list<string>):  list of column names of the table."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"values"})," (type=list): list of values that are used to replace question marks if appropriate. This is an optional parameter."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Exceptions"}),": ",(0,i.jsx)(n.em,{children:"GamaRuntimeException"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Examples"}),": Using action ",(0,i.jsx)(n.code,{children:"executeUpdate"})," to execute some SQL commands (create, insert, update, delete and drop)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'map<string, string> PARAMS <- [\'dbtype\'::\'sqlite\',  \'database\'::\'../../includes/Student.db\'];\n// Create table\ndo executeUpdate (params: PARAMS, \n                  updateComm: "CREATE TABLE registration" \n                              + "(id INTEGER PRIMARY KEY, " \n                              + " first TEXT NOT NULL, " + " last TEXT NOT NULL, " \n                              + " age INTEGER);");\n\n// Insert into \ndo executeUpdate (params: PARAMS,  \n                  updateComm: "INSERT INTO registration " + "VALUES(100, \'Zara\', \'Ali\', 18);");\ndo insert (params: PARAMS, into: "registration", \n           columns: ["id", "first", "last"], \n           values: [103, \'Zaid tim\', \'Kha\']);\n\n// executeUpdate with question marks\ndo executeUpdate (params: PARAMS,\n                  updateComm: "INSERT INTO registration " + "VALUES(?, ?, ?, ?);",  \n                 values: [101, \'Mr\', \'Mme\', 45]);\n\n//update \nint n <-  executeUpdate (params: PARAMS, \n                          updateComm: "UPDATE registration SET age = 30 WHERE id IN (100, 101)" );\n\n// delete\nint n <- executeUpdate (params: PARAMS, \n                        updateComm: "DELETE FROM registration where id=? ",  \n                        values: [101] );\n\n// Drop table\ndo executeUpdate (params: PARAMS, updateComm: "DROP TABLE registration");\n'})}),"\n",(0,i.jsx)(n.h2,{id:"agentdb",children:"AgentDB"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"AgentBD"})," is a built-in species, which supports behaviors that look like actions in ",(0,i.jsx)(n.code,{children:"SQLSKILL"})," but differs in that it uses only one connection for several actions. It means that ",(0,i.jsx)(n.code,{children:"AgentDB"})," creates a connection to the database and keeps that connection open for its later operations."]}),"\n",(0,i.jsxs)(n.h3,{id:"define-a-species-that-is-an-inheritance-of-agentdb",children:["Define a species that is an inheritance of ",(0,i.jsx)(n.code,{children:"AgentDB"})]}),"\n",(0,i.jsx)(n.p,{children:"Example of declaration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"species agtDB parent: AgentDB {  \n\t//insert your descriptions here\n} \n"})}),"\n",(0,i.jsxs)(n.h3,{id:"action-connect-connect-to-a-database",children:["Action ",(0,i.jsx)(n.code,{children:"connect"}),": Connect to a database"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.em,{children:[(0,i.jsx)(n.strong,{children:"connect"})," (params: map<string,string>)"]}),"\nThis action makes a connection to the database. If a connection is established then it will assign the connection object into a built-in attribute of the species (conn) otherwise it throws a GamaRuntimeException."]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Return"}),": connection"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Arguments"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"params"})," (type = map<string,string>): map containing the connection parameters"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Exceptions"}),": GamaRuntimeException"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),": Connect to PostgreSQL"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"// POSTGRES connection parameter\nmap <string, string>  POSTGRES <- [\n                                        'host'::'localhost',\n                                        'dbtype'::'postgres',\n                                        'database'::'BPH',\n                                        'port'::'5433',\n                                        'user'::'postgres',\n                                        'passwd'::'abc'];\nask agtDB {\n      do connect (params: POSTGRES);\n}\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"action-isconnected-check-whether-an-agent-is-connected-to-a-database",children:["Action ",(0,i.jsx)(n.code,{children:"isConnected"}),": Check whether an agent is connected to a database"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.em,{children:[(0,i.jsx)(n.strong,{children:"isConnected"})," (params: map<string,string>)"]}),"\nThis action checks if an agent is connected to a database."]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Return"}),": Boolean.  If the agent is connected to a database then isConnected returns true; otherwise it returns false."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Arguments"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"params"})," (type = map<string,string>): map containing the connection parameters"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),": Check whether the agents agtDB are connected."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'ask agtDB {\n\tif (self isConnected){\n              write "It already has a connection";\n\t}else{\n              do connect (params: POSTGRES);\n        } \n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"action-close-close-the-current-connection",children:["Action ",(0,i.jsx)(n.code,{children:"close"}),": Close the current connection"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"close"})}),"\nThis action closes the current database connection of the current agent. If the agent does not have any database connection then it throws a GamaRuntimeException."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),": close the connection of all the agtDB agents."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ask agtDB {\n\tif (self.isConnected()){\n\t      do close;\n\t}\n}\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"action-getparameter-get-connection-parameters",children:["Action ",(0,i.jsx)(n.code,{children:"getParameter"}),": Get connection parameters"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"getParameter"})}),"\nThis action returns the connection parameters of the current agent."]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Return"}),": ",(0,i.jsx)(n.code,{children:"map<string,string>"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'ask agtDB {\n\tif (self.isConnected()){\n\t\twrite "the connection parameter: " +self.getParameter();\n        }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"set-connection-parameters",children:"Set connection parameters"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.em,{children:[(0,i.jsx)(n.strong,{children:"setParameter"})," (params: map<string,string>)"]}),"\nThis action sets new values for connection parameters and closes the current connection of the agent. If it can not close the current connection then it will throw GamaRuntimeException. If the species wants to make the connection to database with the new values then action ",(0,i.jsx)(n.code,{children:"connect"})," must be called."]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Return"}),": null"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Arguments"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"params"})," (type = map<string,string>): map containing the connection parameters"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Exceptions"}),": ",(0,i.jsx)(n.em,{children:"GamaRuntimeException"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ask agtDB {\n\tif (self.isConnected()){\n             do setParameter params: MySQL;\n             do connect params: self.getParameter();\n        }\n}\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"retrieve-data-from-a-database-by-using-agentdb",children:["Retrieve data from a database by using ",(0,i.jsx)(n.code,{children:"AgentDB"})]}),"\n",(0,i.jsxs)(n.p,{children:["Because ",(0,i.jsx)(n.code,{children:"AgentDB"}),"'s connection to the database is kept alive, it can execute several SQL queries using only the ",(0,i.jsx)(n.code,{children:"connect"})," action once. Hence ",(0,i.jsx)(n.code,{children:"AgentDB"})," can do actions such as ",(0,i.jsx)(n.code,{children:"select"}),", ",(0,i.jsx)(n.code,{children:"insert"}),", ",(0,i.jsx)(n.code,{children:"executeUpdate"})," with the same parameters as those of ",(0,i.jsx)(n.code,{children:"SQLSKILL"})," ",(0,i.jsxs)(n.em,{children:["except for the ",(0,i.jsx)(n.strong,{children:"params"})," parameter which is always absent"]}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Examples"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'map<string, string> PARAMS <- [\'dbtype\'::\'sqlite\', \'database\'::\'../../includes/Student.db\'];\nask agtDB {\n   do connect params: PARAMS;\n\n   // Create table\n   do executeUpdate updateComm: "CREATE TABLE registration" \n\t+ "(id INTEGER PRIMARY KEY, " \n        + " first TEXT NOT NULL, " + " last TEXT NOT NULL, " \n        + " age INTEGER);";\n\n   // Insert into \n   do executeUpdate updateComm: "INSERT INTO registration " \n        + "VALUES(100, \'Zara\', \'Ali\', 18);";\n   do insert into: "registration" columns: ["id", "first", "last"]\n\t     values: [103, \'Zaid tim\', \'Kha\'];\n \n   // executeUpdate with question marks\n   do executeUpdate updateComm: "INSERT INTO registration VALUES(?, ?, ?, ?);" \n\t            values: [101, \'Mr\', \'Mme\', 45];\n   \n   //select\n   list<list> t <- self.select("SELECT * FROM registration;");\n    \n   //update \n   int n <- self.executeUpdate(updateComm: "UPDATE registration SET age = 30 WHERE id IN (100, 101)");\n     \n   // delete\n   int n <- executeUpdate ( updateComm: "DELETE FROM registration where id=? ",  values: [101] );\n     \n   // Drop table\n   do executeUpdate updateComm: "DROP TABLE registration";\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"using-database-features-to-define-the-environment-and-create-agents",children:"Using database features to define the environment and create agents"}),"\n",(0,i.jsxs)(n.p,{children:["In GAMA, it is possible to initialize the simulations from data stored in a database: we can use the results of the ",(0,i.jsx)(n.code,{children:"select"})," action of ",(0,i.jsx)(n.code,{children:"SQLSKILL"})," or ",(0,i.jsx)(n.code,{children:"AgentDB"})," to create agents or to define the boundary of the environment in the same way we do with shape files. Further more, we can also save simulation data that are generated by the simulation including geometry data."]}),"\n",(0,i.jsx)(n.p,{children:"Note that GAMA only supports PostGIS and MySQL as spatial DBMS."}),"\n",(0,i.jsx)(n.h3,{id:"define-the-boundary-of-the-environment-from-the-database",children:"Define the boundary of the environment from the database"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 1"}),": specify the SELECT query by declaring a map object with keys as below:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"dbtype"}),' (mandatory): DBMS type value. Its value is a string. We must use "mysql" when we want to connect to a MySQL. That is the same for "postgres", "sqlite" (ignore case sensitive)']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"host"})," (optional): Host name or IP address of data server."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"})," (optional): Port of connection."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"database"}),"  (mandatory): Name of database."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"user"})," (optional): Username."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"passwd"}),"  (optional): Password."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"srid"})," (optional): srid (Spatial Reference Identifier) corresponds to a spatial reference system. This value is specified when GAMA connects to spatial database. If it is absent then GAMA uses spatial reference system defined in ",(0,i.jsx)(n.em,{children:"Preferences->External"})," configuration."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"select"})," (mandatory): selection query."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"map<string,string> BOUNDS <- [\t\n\t//'srid'::'32648',\n\t'host'::'localhost',\t\t\t\t\t\t\t\t\n        'dbtype'::'postgres',\n\t'database'::'spatial_DB',\n\t'port'::'5433',\t\t\t\t\t\t\t\t\n        'user'::'postgres',\n\t'passwd'::'tmt',\n\t'select'::'SELECT ST_AsBinary(geom) as geom FROM bounds;' ];\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 2"}),": define the boundary of the environment by using the map object defined in the first step (in the ",(0,i.jsx)(n.code,{children:"global"})," block of the model)."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"geometry shape <- envelope(BOUNDS);\n"})}),"\n",(0,i.jsx)(n.p,{children:"Note: We can do the same way if we work with MySQL and we must convert Geometry format in GIS database to binary format."}),"\n",(0,i.jsxs)(n.h3,{id:"create-agents-from-the-result-of-a-select-action",children:["Create agents from the result of a ",(0,i.jsx)(n.code,{children:"select"})," action"]}),"\n",(0,i.jsx)(n.p,{children:"If we are familiar with how to create agents from a shapefile then it becomes very simple to create agents from datbase data. We can do as below:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 1"}),": Define a species with ",(0,i.jsx)(n.code,{children:"SQLSKILL"})," or ",(0,i.jsx)(n.code,{children:"AgentDB"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"species DB_accessor skills: SQLSKILL {\n\t//insert your descriptions here\t\n}\t\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 2"}),": Define a connection and selection parameters"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"global {\n\tmap<string,string> PARAMS <- [\t//'srid'::'32648', // optional\n\t\t\t\t\t'host'::'localhost',\n\t\t\t\t\t'dbtype'::'postgis',\n\t\t\t\t\t'database'::'spatial_db',\n\t\t\t\t\t'port'::'5432',\n\t\t\t\t\t'user'::'postgres',\n\t\t\t\t\t'passwd'::''];\t\n\tstring QUERY <- \"SELECT type, ST_AsEWKB(geom) as geom FROM buildings;\";\n}      \n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 3"}),": Create species by using selected results"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'init {\n\tcreate DB_accessor {\n\t\tcreate buildings from: select(PARAMS, QUERY)\n\t\t\t\t with:[ nature::"type", shape::"geom"];\n\t }\n   ...\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"save-geometry-data-to-database",children:"Save Geometry data to database"}),"\n",(0,i.jsx)(n.p,{children:"Saving agents in a database will be simply a set of insertion into the database. We can do as below:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 1"}),": Define a species with SQLSKILL or AgentDB"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"species DB_accessor skills: SQLSKILL {  \n\t//insert your descriptions here\n} \n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 2"}),": Define a connection and create GIS database and tables"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"global {\n\tmap<string,string> PARAMS <-  [//'srid'::'4326', // optional\n\t\t\t\t\t'host'::'localhost','dbtype'::'postgres','database'::'spatial_db',\n\t\t\t\t\t'port'::'5432','user'::'postgres','passwd'::''];\n\n\tinit {\n\t   create DB_accessor ;\n\t   ask DB_accessor {\n\t\tif (self.testConnection(PARAMS)){\n\t           // create GIS database\t\n \t\t   do executeUpdate(params:PARAMS, \n\t\t      updateComm: \"CREATE DATABASE spatial_db with TEMPLATE = template_postgis;\"); \n \t\t   remove key: \"database\" from: PARAMS;\n\t\t   put \"spatial_db\" key:\"database\" in: PARAMS;\n\t\t\n                   //create table\n                   do executeUpdate params: PARAMS \n\t\t\t\t  updateComm : \"CREATE TABLE buildings \"+\n\t\t\t\t  \"( \"  +\n                   \t               \" name character varying(255), \" + \n                                       \" type character varying(255), \" + \n                                       \" geom GEOMETRY \" + \n                                   \")\";\n\t\t    }else {\n \t\t\twrite \"Connection to MySQL can not be established \";\n \t\t    }\t\n\t\t}\n\t}\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Step 3"}),": Insert geometry data to the GIS database"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'ask building {\n   ask DB_Accessor {\n\tdo insert(params: PARAMS, \n                  into: "buildings",\n\t\t  columns: ["name", "type","geom"],\n\t\t  values: [myself.name, myself.type, myself.shape];\n   }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var s=t(96540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);