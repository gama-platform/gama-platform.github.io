<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Corridor Multi-Level Architecture with Mathematics Model and Agent Based Model · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="GAMA"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Corridor Multi-Level Architecture with Mathematics Model and Agent Based Model · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gama-platform.github.io/"/><meta property="og:description" content="GAMA"/><meta property="og:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/searchEngine.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/gama-logo_white.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/wiki/Home" target="_self">Documentation</a></li><li class=""><a href="/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Corridor Multi-Level Architecture with Mathematics Model and Agent Based Model</h1></header><article><div><span><p>_Author : _</p>
<p>This model shows how to use multi-level architecture. Two corridors are presented : one which can capture the pedestrians going through it and computing for them the time before releasing them at the end of the corridor, and an other doing nothing, letting the pedestrians moving by themselves in the corridor.</p>
<p>Code of the model :</p>
<pre><code class="hljs">
<span class="hljs-builtin">model</span> pedestrian_corridor_Hybrid_vs_ABM

<span class="hljs-class">global </span>
{
    
    <span class="hljs-comment">//Parameters of the environment</span>
    <span class="hljs-literal">int</span> environment_width &lt;- 200 const: true;
    <span class="hljs-literal">int</span> environment_height &lt;- 200 const: true;
    <span class="hljs-literal">geometry</span> shape &lt;- rectangle(environment_width, environment_height); 
    
    
    <span class="hljs-comment">//Parameters of the pedestrian agents</span>
    <span class="hljs-literal">rgb</span> pedestrian_green &lt;- #green;
    
    <span class="hljs-literal">float</span> pedestrian_size &lt;- 1.0;
    <span class="hljs-literal">geometry</span> pedestrian_shape &lt;- circle (pedestrian_size) ;
    <span class="hljs-literal">float</span> pedestrian_speed &lt;- 2.0;
 
    <span class="hljs-comment">//Parameters of the corridors</span>
    <span class="hljs-literal">rgb</span> corridor_color &lt;- <span class="hljs-literal">rgb</span> ('blue');
    <span class="hljs-literal">int</span> corridor_width &lt;- 160 depends_on: [environment_width];
    <span class="hljs-literal">int</span> corridor_height &lt;- (<span class="hljs-literal">int</span>(environment_height * 0.05));

    <span class="hljs-literal">point</span> corridor_location_0 &lt;- {environment_width / 2, environment_height / 4};
    <span class="hljs-literal">geometry</span> corridor_shape_0 &lt;- ( (rectangle ({corridor_width, corridor_height})) at_location corridor_location_0) ;

    <span class="hljs-literal">point</span> corridor_location_1 &lt;- {environment_width / 2, environment_height * 0.75};
    <span class="hljs-literal">geometry</span> corridor_shape_1 &lt;- ( (rectangle ({corridor_width, corridor_height})) at_location corridor_location_1) ;

    <span class="hljs-comment">//Parameters of pedestrian generation</span>
    <span class="hljs-literal">int</span> new_pedestian_generate_frequency &lt;- 8;
    <span class="hljs-literal">point</span> pedestrian_source_0 &lt;- {0, corridor_location_0.y} ;
    <span class="hljs-literal">point</span> pedestrian_source_1 &lt;- {0, corridor_location_1.y} ;
     
     
     
    init 
    {
        create corridor number: 2 returns: new_corridors;
        
        ask (new_corridors at 0) 
        {
            do init_corridor corridor_shape: corridor_shape_0 is_hybrid: false;
        }

        ask (new_corridors at 1) 
        {
            do init_corridor corridor_shape: corridor_shape_1 is_hybrid: true; 
        }
    }

    <span class="hljs-comment">//Generation of pedestrians according to the frequency of generation : one for each corridor</span>
    <span class="hljs-class">reflex <span class="hljs-title">generate_pedestrians</span> <span class="hljs-title">when</span>: ( (<span class="hljs-title">cycle</span> <span class="hljs-title">mod</span> <span class="hljs-title">new_pedestian_generate_frequency</span>) = 0 ) </span>
    { 
        create pedestrian number: 2 returns: new_pedestrians;
        
        ask (new_pedestrians at 0) 
        {
            do init_location loc: pedestrian_source_0;
        }
        
        ask (new_pedestrians at 1) 
        {
            do init_location loc: pedestrian_source_1;
        }
    }   
}


<span class="hljs-comment">//Species for the pedestrians which can move</span>
<span class="hljs-class">species <span class="hljs-title">pedestrian</span> <span class="hljs-title">skills</span>: [<span class="hljs-title">moving</span>] </span>{
    <span class="hljs-literal">geometry</span> shape &lt;- circle(pedestrian_size);
    <span class="hljs-literal">rgb</span> color;
    corridor last_corridor;
    <span class="hljs-literal">point</span> target_location;
    <span class="hljs-literal">float</span> speed &lt;- pedestrian_speed;
    
    <span class="hljs-comment">//Initialisation of the target location according to its generation location</span>
    action init_location (<span class="hljs-literal">point</span> loc) {
        location &lt;- loc;
        target_location &lt;- {environment_width, location.y};
        heading &lt;- self towards (target_location);
    }

    <span class="hljs-comment">//Reflex to move the agent to its target location and make it die once it reached its target</span>
    <span class="hljs-class">reflex <span class="hljs-title">move_left</span> </span>
    {
        do move heading: (self) towards (target_location); 
        
        <span class="hljs-keyword">if</span> ( (target_location.x - location.x) &lt;= speed ) 
        {
            do die;
        }
    }
     
    aspect default 
    {
        draw shape color: color;
    }
}

<span class="hljs-comment">//Species for the corridor which can capture pedestrians</span>
<span class="hljs-class">species <span class="hljs-title">corridor</span>  </span>{
    <span class="hljs-literal">bool</span> capture_pedestrians;
    
    
    action init_corridor (<span class="hljs-literal">geometry</span> corridor_shape, <span class="hljs-literal">bool</span> is_hybrid) 
    {
        shape &lt;- corridor_shape;
        capture_pedestrians &lt;- is_hybrid;
    }

    <span class="hljs-literal">float</span> max_speed &lt;- pedestrian_speed;
    <span class="hljs-literal">float</span> macro_length min: 0.0 &lt;- <span class="hljs-literal">float</span>(corridor_width); <span class="hljs-comment">// the length of macro_patch</span>
    
    <span class="hljs-comment">//Species to model the pedestrian captured by the corridor</span>
    <span class="hljs-class">species <span class="hljs-title">captured_pedestrian</span> <span class="hljs-title">parent</span>: <span class="hljs-title">pedestrian</span> <span class="hljs-title">schedules</span>: [] </span>
    {
        <span class="hljs-literal">float</span> released_time;  
        
        aspect default { }
    }
    
    init 
    { 
        create corridor_info_drawer number: 1 with: [target :: self];
    }
    <span class="hljs-comment">//Reflex to capture the pedestrians overlapping the corridor ie entering the corridor </span>
    <span class="hljs-class">reflex <span class="hljs-title">aggregate</span> <span class="hljs-title">when</span>: <span class="hljs-title">capture_pedestrians</span> </span>
    {
        <span class="hljs-literal">list</span>&lt;pedestrian&gt; tobe_captured_pedestrians &lt;- (pedestrian overlapping shape) where ( (each.last_corridor != self) and ((each.location).x &lt; (self.location).x) ) ; 
        
        <span class="hljs-keyword">if</span> !(empty (tobe_captured_pedestrians)) 
        {
            capture tobe_captured_pedestrians as: captured_pedestrian returns: cps { 
                last_corridor &lt;- myself;
            }
            <span class="hljs-keyword">if</span> !(empty (cps)) 
            {
                    <span class="hljs-comment">//Computation of the time when the pedestrians captured will be released according to the speed</span>
                    <span class="hljs-comment">// and the time they should make to pass the corridor if they move by themselves</span>
                    <span class="hljs-literal">float</span> group_outgoing_time &lt;- time + (corridor_width / (pedestrian_speed) ); 
                    loop cp over: cps 
                    {
                            cp.released_time &lt;- group_outgoing_time;
                    }
            }
        
        }
    }
    
    <span class="hljs-comment">//Reflex to release the pedestrians when we consider they were enough time inside the corridor </span>
    <span class="hljs-class">reflex <span class="hljs-title">disaggregate</span>  </span>
    {
        <span class="hljs-literal">list</span> tobe_released_pedestrians &lt;- members where (time &gt;= (captured_pedestrian (each)).released_time);
        
        <span class="hljs-keyword">if</span> !(empty (tobe_released_pedestrians)) 
        {
            
            release tobe_released_pedestrians as: pedestrian in: world returns: released_pedestrians;
            
            loop rp over: released_pedestrians 
            {
                rp.speed &lt;- pedestrian_speed;
                rp.location &lt;- {((environment_width / 2) + (corridor_width / 2)), ((corridor_shape_1).location).y};
            }
        }
    }
        
    aspect default 
    {
        draw shape color: corridor_color;
    }
}
 
<span class="hljs-class">species <span class="hljs-title">corridor_info_drawer</span> </span>
{
    corridor target;
    
    aspect base 
    {
        <span class="hljs-keyword">if</span> target.capture_pedestrians 
        {
            draw 'Hybrid <span class="hljs-builtin">model</span> (coupling: ABM and Mathematical Model)' color: #blue size: 7 at: {(target.location).x - 90, (target.location).y - 10};
            draw  'Aggregated agents: ' + <span class="hljs-literal">string</span>(length(target.members)) color: #black size: 7 at: {(target.location).x - 30, (target.location).y + 2};
        } 
        else 
        {
            draw 'Agent-Based Model (ABM)' color: #blue size: 7 at: {(target.location).x - 40, (target.location).y - 10};
        }
    }
}

<span class="hljs-class">experiment <span class="hljs-title">default_experiment</span> <span class="hljs-title">type</span>: <span class="hljs-title">gui</span> </span>
{
    output 
    {
        <span class="hljs-class">display <span class="hljs-title">default_display</span> </span>
        {
            <span class="hljs-class">species <span class="hljs-title">pedestrian</span>;</span>
            <span class="hljs-class">species <span class="hljs-title">corridor</span> <span class="hljs-title">transparency</span>: 0.8;</span>
            <span class="hljs-class">species <span class="hljs-title">corridor_info_drawer</span> <span class="hljs-title">aspect</span>: <span class="hljs-title">base</span>;</span>
        }
    }
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a></div><div><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div><h5>Ecosystem</h5><a href="https://github.com/gama-platform/gama"><i class="fab fa-github"></i> GitHub Gama</a><a href="https://github.com/gama-platform/gama.experimental"><i class="fas fa-puzzle-piece"></i> Gama Experimental Plugins</a><a href="https://github.com/gama-platform/gama.models.experimental"><i class="fas fa-scroll"></i> Gama Experimental Models</a></div></section><section class="copyright">Copyright © 2019 GAMA-Platform</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'undefined',
                indexName: 'undefined',
                inputSelector: '#search_input_react'
              });
            </script></body></html>