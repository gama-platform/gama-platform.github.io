<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>comodel with mixed behaviors · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="[//]: # (keyword|operator_dead)"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="comodel with mixed behaviors · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gama-platform.github.io/"/><meta property="og:description" content="[//]: # (keyword|operator_dead)"/><meta property="og:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://gama-platform.github.io/blog/atom.xml" title="GAMA-Platform Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://gama-platform.github.io/blog/feed.xml" title="GAMA-Platform Blog RSS Feed"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/searchEngine.js"></script><script type="text/javascript" src="/js/dark.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/gama-logo_white.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/wiki/Home" target="_self">Documentation</a></li><li class=""><a href="/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">comodel with mixed behaviors</h1></header><article><div><span><p><em>Author : HUYNH Quang Nghi</em></p>
<p>This is a simple comodel serve to demonstrate the mixing behaviors of preyPredator with the Ants. Ants are the prey, fleeing from Predators, when they are not chasing, they try to do job of the ants.</p>
<p>Imported models :</p>
<pre><code class="hljs"><span class="hljs-builtin">model</span> ants

global {
    <span class="hljs-comment">//Evaporation value per cycle</span>
    <span class="hljs-literal">float</span> evaporation_per_cycle &lt;- 5.0 <span class="hljs-symbol">min:</span> 0.0 <span class="hljs-symbol">max:</span> 240.0 <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Evaporation of the signal (unit/cycle):'</span> <span class="hljs-symbol">category:</span> <span class="hljs-string">'Signals'</span>;
    <span class="hljs-comment">//Diffusion rate of the pheromon among the grid</span>
    <span class="hljs-literal">float</span> diffusion_rate &lt;- 1.0 <span class="hljs-symbol">min:</span> 0.0 <span class="hljs-symbol">max:</span> 1.0 <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Rate of diffusion of the signal (%/cycle):'</span> <span class="hljs-symbol">category:</span> <span class="hljs-string">'Signals'</span>;
    <span class="hljs-comment">//Size of the grid</span>
    <span class="hljs-literal">int</span> gridsize &lt;- 100 <span class="hljs-symbol">min:</span> 30 <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Width and Height of the grid:'</span> <span class="hljs-symbol">category:</span> <span class="hljs-string">'Environment and Population'</span>;
    <span class="hljs-comment">//Number of ants</span>
    <span class="hljs-literal">int</span> ants_number &lt;- 200 <span class="hljs-symbol">min:</span> 1 <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Number of ants:'</span> <span class="hljs-symbol">category:</span> <span class="hljs-string">'Environment and Population'</span>;
    <span class="hljs-comment">//Frequency of update of the grid</span>
    <span class="hljs-literal">int</span> grid_frequency &lt;- 1 <span class="hljs-symbol">min:</span> 1 <span class="hljs-symbol">max:</span> 100 <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Grid updates itself every:'</span> <span class="hljs-symbol">category:</span> <span class="hljs-string">'Environment and Population'</span>;
    <span class="hljs-comment">//Number of food places among the grid</span>
    <span class="hljs-literal">int</span> number_of_food_places &lt;- 5 <span class="hljs-symbol">min:</span> 1 <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Number of food depots:'</span> <span class="hljs-symbol">category:</span> <span class="hljs-string">'Environment and Population'</span>;
    <span class="hljs-literal">float</span> grid_transparency &lt;- 1.0;
    <span class="hljs-literal">file</span> ant_shape_empty <span class="hljs-symbol">const:</span> true &lt;- <span class="hljs-literal">file</span>(<span class="hljs-string">'../icons/ant.png'</span>);
    image_file ant_shape_full <span class="hljs-symbol">const:</span> true &lt;- <span class="hljs-literal">file</span>(<span class="hljs-string">'../icons/full_ant.png'</span>);
    <span class="hljs-comment">//The center of the grid that will be considered as the nest location</span>
    <span class="hljs-literal">point</span> center <span class="hljs-symbol">const:</span> true &lt;- { round(gridsize / 2), round(gridsize / 2) };
    <span class="hljs-literal">int</span> food_gathered &lt;- 1;
    <span class="hljs-literal">int</span> food_placed &lt;- 1;
    <span class="hljs-literal">rgb</span> background <span class="hljs-symbol">const:</span> true &lt;- <span class="hljs-literal">rgb</span>(#99CC66);
    <span class="hljs-literal">rgb</span> food_color <span class="hljs-symbol">const:</span> true &lt;- <span class="hljs-literal">rgb</span>(#312200);
    <span class="hljs-literal">rgb</span> nest_color <span class="hljs-symbol">const:</span> true &lt;- <span class="hljs-literal">rgb</span>(#000000); 

    <span class="hljs-literal">geometry</span> shape &lt;- square(gridsize);
    init {
        <span class="hljs-comment">//Creation of the food places placed randomly with a certain distance between each</span>
        <span class="hljs-keyword">loop</span> <span class="hljs-symbol">times:</span> number_of_food_places {
            <span class="hljs-literal">point</span> loc &lt;- { rnd(gridsize - 10) + 5, rnd(gridsize - 10) + 5 };
            <span class="hljs-literal">list</span>&lt;ant_grid&gt; food_places &lt;- (ant_grid where ((each distance_to loc) &lt; 5));
            <span class="hljs-keyword">ask</span> food_places {
                <span class="hljs-keyword">if</span> food = 0 {
                    food &lt;- 5;
                    food_placed &lt;- food_placed + 5;
                    color &lt;- food_color;  
                }                                           
            }
        }
        <span class="hljs-comment">//Creation of the ants that will be placed in the nest</span>
        <span class="hljs-keyword">create</span> ant <span class="hljs-symbol">number:</span> ants_number <span class="hljs-symbol">with:</span> (<span class="hljs-symbol">location:</span> center);
    }
    <span class="hljs-comment">//Reflex to diffuse the pheromon among the grid</span>
    <span class="hljs-builtin">reflex</span> <span class="hljs-keyword">diffuse</span> {
      <span class="hljs-keyword">diffuse</span> <span class="hljs-symbol">var:</span>road <span class="hljs-symbol">on:</span>ant_grid <span class="hljs-symbol">proportion:</span> diffusion_rate <span class="hljs-symbol">radius:</span>3 <span class="hljs-symbol">propagation:</span> gradient <span class="hljs-symbol">method:</span>convolution;
   }
  
}

<span class="hljs-comment">//Grid used to discretize the space to place food</span>
grid ant_grid <span class="hljs-symbol">width:</span> gridsize <span class="hljs-symbol">height:</span> gridsize <span class="hljs-symbol">neighbors:</span> 8 <span class="hljs-symbol">frequency:</span> grid_frequency <span class="hljs-symbol">use_regular_agents:</span> false <span class="hljs-symbol">use_individual_shapes:</span> false{
    <span class="hljs-literal">bool</span> is_nest <span class="hljs-symbol">const:</span> true &lt;- (<span class="hljs-literal">topology</span>(ant_grid) distance_between [self, center]) &lt; 4;
    <span class="hljs-literal">float</span> road &lt;- 0.0 <span class="hljs-symbol">max:</span> 240.0 <span class="hljs-symbol">update:</span> (road &lt;= evaporation_per_cycle) ? 0.0 : road - evaporation_per_cycle;
    <span class="hljs-literal">rgb</span> color &lt;- is_nest ? nest_color : ((food &gt; 0) ? food_color : ((road &lt; 0.001) ? background : <span class="hljs-literal">rgb</span>(#009900) + <span class="hljs-literal">int</span>(road * 5))) <span class="hljs-symbol">update:</span> is_nest ? nest_color : ((food &gt; 0) ?
    food_color : ((road &lt; 0.001) ? background : <span class="hljs-literal">rgb</span>(#009900) + <span class="hljs-literal">int</span>(road * 5)));
    <span class="hljs-literal">int</span> food &lt;- 0;
}
<span class="hljs-comment">//Species ant that will move and follow a final state machine</span>
<span class="hljs-literal">species</span> ant <span class="hljs-symbol">skills:</span> [<span class="hljs-builtin">moving</span>] <span class="hljs-symbol">control:</span> <span class="hljs-builtin">fsm</span> {
    <span class="hljs-literal">float</span> speed &lt;- 1.0;
    <span class="hljs-literal">bool</span> has_food &lt;- false;
    
    <span class="hljs-comment">//Reflex to place a pheromon stock in the cell</span>
    <span class="hljs-builtin">reflex</span> diffuse_road <span class="hljs-symbol">when:</span>has_food=true{
      ant_grid(location).road &lt;- ant_grid(location).road + 100.0;
   }
    <span class="hljs-comment">//Action to pick food</span>
    <span class="hljs-keyword">action</span> pick (<span class="hljs-literal">int</span> amount) {
        has_food &lt;- true;
        ant_grid place &lt;- ant_grid(location);
        place.food &lt;- place.food - amount;
    }
    <span class="hljs-comment">//Action to drop food</span>
    <span class="hljs-keyword">action</span> drop {
        food_gathered &lt;- food_gathered + 1;
        has_food &lt;- false;
        heading &lt;- heading - 180;
    }
    <span class="hljs-comment">//Action to find the best place in the neighborhood cells</span>
    <span class="hljs-literal">point</span> choose_best_place {
        <span class="hljs-literal">container</span> list_places &lt;- ant_grid(location).neighbors;
        <span class="hljs-keyword">if</span> (list_places count (each.food &gt; 0)) &gt; 0 {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">point</span>(list_places first_with (each.food &gt; 0));
        } <span class="hljs-keyword">else</span> {
            list_places &lt;- (list_places where ((each.road &gt; 0) and ((each distance_to center) &gt; (self distance_to center)))) sort_by (each.road);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">point</span>(last(list_places));
        }

    }
    <span class="hljs-comment">//Reflex to drop food once the ant is in the nest</span>
    <span class="hljs-builtin">reflex</span> drop <span class="hljs-symbol">when:</span> has_food and (ant_grid(location)).is_nest {
        <span class="hljs-keyword">do</span> drop();
    }
    <span class="hljs-comment">//Reflex to pick food when there is one at the same location</span>
    <span class="hljs-builtin">reflex</span> pick <span class="hljs-symbol">when:</span> !has_food and (ant_grid(location)).food &gt; 0 {
        <span class="hljs-keyword">do</span> pick(1);
    }
    <span class="hljs-comment">//Initial state to make the ant wander </span>
    <span class="hljs-keyword">state</span> wandering <span class="hljs-symbol">initial:</span> true {
        <span class="hljs-keyword">do</span> wander(<span class="hljs-symbol">amplitude:</span> 90);
        <span class="hljs-literal">float</span> pr &lt;- (ant_grid(location)).road;
        <span class="hljs-keyword">transition</span> <span class="hljs-symbol">to:</span> carryingFood <span class="hljs-symbol">when:</span> has_food;
        <span class="hljs-keyword">transition</span> <span class="hljs-symbol">to:</span> followingRoad <span class="hljs-symbol">when:</span> (pr &gt; 0.05) and (pr &lt; 4);
    }
    <span class="hljs-comment">//State to carry food once it has been found</span>
    <span class="hljs-keyword">state</span> carryingFood {
        <span class="hljs-keyword">do</span> goto(<span class="hljs-symbol">target:</span> center);
        <span class="hljs-keyword">transition</span> <span class="hljs-symbol">to:</span> wandering <span class="hljs-symbol">when:</span> !has_food;
    }
    <span class="hljs-comment">//State to follow a pheromon road if once has been found</span>
    <span class="hljs-keyword">state</span> followingRoad {
        <span class="hljs-literal">point</span> next_place &lt;- choose_best_place();
        <span class="hljs-literal">float</span> pr &lt;- (ant_grid(location)).road;
        location &lt;- next_place;
        <span class="hljs-keyword">transition</span> <span class="hljs-symbol">to:</span> carryingFood <span class="hljs-symbol">when:</span> has_food;
        <span class="hljs-keyword">transition</span> <span class="hljs-symbol">to:</span> wandering <span class="hljs-symbol">when:</span> (pr &lt; 0.05) or (next_place = nil);
    }

    <span class="hljs-keyword">aspect</span> info {
        <span class="hljs-keyword">draw</span> circle(1) <span class="hljs-symbol">empty:</span> !has_food <span class="hljs-symbol">color:</span> #red;
        <span class="hljs-keyword">if</span> (destination != nil) {
            <span class="hljs-keyword">draw</span> line([location + {0,0,0.5}, destination + {0,0,0.5}]) + 0.1 <span class="hljs-symbol">color:</span> #white <span class="hljs-symbol">border:</span> false;
        }

        <span class="hljs-keyword">draw</span> circle(4) <span class="hljs-symbol">empty:</span> true <span class="hljs-symbol">color:</span> #white;
        <span class="hljs-keyword">draw</span> <span class="hljs-literal">string</span>(self as <span class="hljs-literal">int</span>) <span class="hljs-symbol">color:</span> #white <span class="hljs-symbol">font:</span> font(<span class="hljs-string">"Helvetica"</span>, 12 * #zoom, #bold) <span class="hljs-symbol">at:</span> my location - {1, 1, -0.5};
        <span class="hljs-keyword">draw</span> <span class="hljs-keyword">state</span> <span class="hljs-symbol">color:</span> #yellow  <span class="hljs-symbol">font:</span> font(<span class="hljs-string">"Helvetica"</span>, 10 * #zoom, #plain) <span class="hljs-symbol">at:</span> my location + { 1, 1, 0.5 } <span class="hljs-symbol">perspective:</span> false;
    }

    <span class="hljs-keyword">aspect</span> icon {
        <span class="hljs-keyword">draw</span> ant_shape_empty <span class="hljs-symbol">size:</span> {7,5} <span class="hljs-symbol">rotate:</span> my heading + 1;
    }

    <span class="hljs-keyword">aspect</span> <span class="hljs-keyword">default</span> {
        <span class="hljs-keyword">draw</span> square(1) <span class="hljs-symbol">empty:</span> !has_food <span class="hljs-symbol">color:</span> #blue <span class="hljs-symbol">rotate:</span> my heading;
    }
}   
<span class="hljs-comment">//Simple experiment to display the ants</span>
<span class="hljs-builtin">experiment</span> Displays <span class="hljs-symbol">type:</span> gui {
    <span class="hljs-literal">point</span> quadrant_size &lt;- { 0.5, 0.5 };
    <span class="hljs-literal">float</span> inc &lt;- 0.001;
    <span class="hljs-literal">float</span> pos &lt;- 0.0;
    <span class="hljs-builtin">reflex</span> moving_quadrant {
    <span class="hljs-comment">//pos &lt;- pos + inc;</span>
        <span class="hljs-keyword">if</span> (pos &gt; 0.5 or pos &lt;= 0) {
            inc &lt;- -inc;
        }
        
    }

    <span class="hljs-keyword">output</span> {
        <span class="hljs-keyword">display</span> Ants <span class="hljs-symbol">background:</span> #white <span class="hljs-symbol">type:</span> opengl {
            <span class="hljs-keyword">image</span> <span class="hljs-string">'../images/soil.jpg'</span> <span class="hljs-symbol">position:</span> { pos, pos } <span class="hljs-symbol">size:</span> quadrant_size;
            <span class="hljs-keyword">agents</span> <span class="hljs-string">"agents"</span> <span class="hljs-symbol">transparency:</span> 0.5 <span class="hljs-symbol">position:</span> { pos, pos } <span class="hljs-symbol">size:</span> quadrant_size <span class="hljs-symbol">value:</span> (ant_grid as <span class="hljs-literal">list</span>) where ((each.food &gt; 0) or (each.road &gt; 0) or (each.is_nest));
            <span class="hljs-literal">species</span> ant <span class="hljs-symbol">position:</span> { pos, pos } <span class="hljs-symbol">size:</span> quadrant_size <span class="hljs-symbol">aspect:</span> icon;
            grid ant_grid <span class="hljs-symbol">lines:</span> #darkgray <span class="hljs-symbol">position:</span> { 0.5, 0 } <span class="hljs-symbol">size:</span> quadrant_size;
            <span class="hljs-literal">species</span> ant <span class="hljs-symbol">position:</span> { 0.5, 0 } <span class="hljs-symbol">size:</span> quadrant_size <span class="hljs-symbol">aspect:</span> info;
        }
    }
}
<span class="hljs-comment">//Complete experiment that will inspect all ants in a table</span>
<span class="hljs-builtin">experiment</span> Complete <span class="hljs-symbol">type:</span> gui {
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Number:'</span> <span class="hljs-symbol">var:</span> ants_number <span class="hljs-symbol">init:</span> 100 <span class="hljs-symbol">unit:</span> <span class="hljs-string">'ants'</span> <span class="hljs-symbol">category:</span> <span class="hljs-string">'Environment and Population'</span>;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Grid dimension:'</span> <span class="hljs-symbol">var:</span> gridsize <span class="hljs-symbol">init:</span> 100 <span class="hljs-symbol">unit:</span> <span class="hljs-string">'(number of rows and columns)'</span> <span class="hljs-symbol">category:</span> <span class="hljs-string">'Environment and Population'</span>;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Number of food depots:'</span> <span class="hljs-symbol">var:</span> number_of_food_places <span class="hljs-symbol">init:</span> 5 <span class="hljs-symbol">min:</span> 1 <span class="hljs-symbol">category:</span> <span class="hljs-string">'Environment and Population'</span>;

    <span class="hljs-comment">// Experimentator</span>

    init {
        <span class="hljs-keyword">write</span> <span class="hljs-string">"Experimentator agent running "</span> + self;
       ants_number &lt;- 200;
    }


    <span class="hljs-keyword">output</span> {
        <span class="hljs-keyword">display</span> Ants2D <span class="hljs-symbol">type:</span> java2D {
            <span class="hljs-keyword">image</span> <span class="hljs-string">'../images/soil.jpg'</span> <span class="hljs-symbol">position:</span> { 0.05, 0.05 } <span class="hljs-symbol">size:</span> { 0.9, 0.9 };
            <span class="hljs-keyword">agents</span> <span class="hljs-string">"agents"</span> <span class="hljs-symbol">transparency:</span> 0.7 <span class="hljs-symbol">position:</span> { 0.05, 0.05 } <span class="hljs-symbol">size:</span> { 0.9, 0.9 } <span class="hljs-symbol">value:</span> (ant_grid as <span class="hljs-literal">list</span>) where ((each.food &gt; 0) or (each.road &gt; 0) or (each.is_nest)) ;
            <span class="hljs-literal">species</span> ant <span class="hljs-symbol">position:</span> { 0.05, 0.05 } <span class="hljs-symbol">size:</span> { 0.9, 0.9 } <span class="hljs-symbol">aspect:</span> icon;
            <span class="hljs-keyword">overlay</span> <span class="hljs-string">"Texts"</span> <span class="hljs-symbol">transparency:</span> 0.3 <span class="hljs-symbol">background:</span> <span class="hljs-literal">rgb</span> (99, 85, 66,255)  <span class="hljs-symbol">position:</span> {10°px, 10°px} <span class="hljs-symbol">size:</span> {250°px, 150°px} <span class="hljs-symbol">border:</span> <span class="hljs-literal">rgb</span> (99, 85, 66,255) <span class="hljs-symbol">rounded:</span> true{
                <span class="hljs-keyword">draw</span> ant_shape_full <span class="hljs-symbol">at:</span> {60°px, 70°px} <span class="hljs-symbol">size:</span> {140°px, 100°px} <span class="hljs-symbol">rotate:</span> -60;
                <span class="hljs-keyword">draw</span> (<span class="hljs-string">'Food foraged: '</span> + (((food_placed = 0 ? 0 : food_gathered / food_placed) * 100) with_precision 2) + <span class="hljs-string">'%'</span>) <span class="hljs-symbol">at:</span> {40°px,70°px} <span class="hljs-symbol">font:</span>font(<span class="hljs-string">"Arial"</span>, 18, #bold) <span class="hljs-symbol">color:</span> #white;
                <span class="hljs-keyword">draw</span> (<span class="hljs-string">'Carrying ants: '</span> + (((100 * ant count (each.has_food or each.<span class="hljs-keyword">state</span> = <span class="hljs-string">"followingRoad"</span>)) / length(ant)) with_precision 2) + <span class="hljs-string">'%'</span>) <span class="hljs-symbol">at:</span> {40°px, 100°px} <span class="hljs-symbol">font:</span>font(<span class="hljs-string">"Arial"</span>, 18 , #bold) <span class="hljs-symbol">color:</span> #white;
            }
                    
        }
        <span class="hljs-keyword">inspect</span> <span class="hljs-string">"All ants"</span> <span class="hljs-symbol">type:</span> table <span class="hljs-symbol">value:</span> ant <span class="hljs-symbol">attributes:</span> [<span class="hljs-string">'name'</span>, <span class="hljs-string">'location'</span>, <span class="hljs-string">'heading'</span>,<span class="hljs-string">'state'</span>];
    }
}
<span class="hljs-comment">//Batch experiment to find the best way to maximize the food gathered using exhaustive method</span>
<span class="hljs-builtin">experiment</span> Batch <span class="hljs-symbol">type:</span> batch <span class="hljs-symbol">repeat:</span> 4 <span class="hljs-symbol">keep_seed:</span> true <span class="hljs-symbol">until:</span> (food_gathered = food_placed) or (time &gt; 1000) {
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Size of the grid:'</span> <span class="hljs-symbol">var:</span> gridsize <span class="hljs-symbol">init:</span> 75 <span class="hljs-symbol">unit:</span> <span class="hljs-string">'width and height'</span>;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Number:'</span> <span class="hljs-symbol">var:</span> ants_number <span class="hljs-symbol">among:</span>[10,20,50] <span class="hljs-symbol">unit:</span> <span class="hljs-string">'ants'</span>;
    <span class="hljs-keyword">parameter</span>  <span class="hljs-string">'Evaporation:'</span> <span class="hljs-symbol">var:</span> evaporation_per_cycle <span class="hljs-symbol">among:</span> [0.1, 0.5, 2.0, 10.0] <span class="hljs-symbol">unit:</span> <span class="hljs-string">'units every cycle'</span>;
    <span class="hljs-keyword">parameter</span>  <span class="hljs-string">'Diffusion:'</span> <span class="hljs-symbol">var:</span> diffusion_rate <span class="hljs-symbol">min:</span> 0.1 <span class="hljs-symbol">max:</span> 1.0 <span class="hljs-symbol">unit:</span> <span class="hljs-string">'rate every cycle (1.0 means 100%)'</span> <span class="hljs-symbol">step:</span> 0.2;
    method <span class="hljs-keyword">exhaustive</span> <span class="hljs-symbol">maximize:</span> food_gathered;

    
    <span class="hljs-keyword">permanent</span> {
        <span class="hljs-keyword">display</span> Comparison <span class="hljs-symbol">background:</span> #white {
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"Food Gathered"</span> <span class="hljs-symbol">type:</span> series {
                    <span class="hljs-keyword">data</span> <span class="hljs-string">"Min"</span> <span class="hljs-symbol">value:</span>  min(ants_model collect each.food_gathered ) <span class="hljs-symbol">style:</span> spline <span class="hljs-symbol">color:</span> #darkgreen ;
                    <span class="hljs-keyword">data</span> <span class="hljs-string">"Max"</span> <span class="hljs-symbol">value:</span>  max(ants_model collect each.food_gathered ) <span class="hljs-symbol">style:</span> spline <span class="hljs-symbol">color:</span> #red ;
            }
        }
    }
}

<span class="hljs-comment">//Batch experiment to find the best way to maximize the food gathered using genetic method</span>
<span class="hljs-builtin">experiment</span> Genetic <span class="hljs-symbol">type:</span> batch <span class="hljs-symbol">repeat:</span> 2 <span class="hljs-symbol">keep_seed:</span> true <span class="hljs-symbol">until:</span> (food_gathered = food_placed) or (time &gt; 1000) {
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Size of the grid:'</span> <span class="hljs-symbol">var:</span> gridsize <span class="hljs-symbol">init:</span> 75 <span class="hljs-symbol">unit:</span> <span class="hljs-string">'(width and height)'</span>;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Number:'</span> <span class="hljs-symbol">var:</span> ants_number <span class="hljs-symbol">among:</span>[10,20,50] <span class="hljs-symbol">unit:</span> <span class="hljs-string">'ants'</span>;
    <span class="hljs-keyword">parameter</span>  <span class="hljs-string">'Evaporation:'</span> <span class="hljs-symbol">var:</span> evaporation_per_cycle <span class="hljs-symbol">among:</span> [0.1, 0.5, 2.0, 10.0] <span class="hljs-symbol">unit:</span> <span class="hljs-string">'units every cycle'</span>;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Diffusion:'</span> <span class="hljs-symbol">var:</span> diffusion_rate <span class="hljs-symbol">min:</span> 0.1 <span class="hljs-symbol">max:</span> 1.0 <span class="hljs-symbol">unit:</span> <span class="hljs-string">'rate every cycle (1.0 means 100%)'</span> <span class="hljs-symbol">step:</span> 0.2;
    method <span class="hljs-keyword">genetic</span> <span class="hljs-symbol">maximize:</span> food_gathered <span class="hljs-symbol">pop_dim:</span> 5 <span class="hljs-symbol">crossover_prob:</span> 0.7 <span class="hljs-symbol">mutation_prob:</span> 0.1 <span class="hljs-symbol">nb_prelim_gen:</span> 1 <span class="hljs-symbol">max_gen:</span> 20;
    
        <span class="hljs-keyword">permanent</span> {
        <span class="hljs-keyword">display</span> Comparison <span class="hljs-symbol">background:</span> #white {
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"Food Gathered"</span> <span class="hljs-symbol">type:</span> series {
                    <span class="hljs-keyword">data</span> <span class="hljs-string">"Min"</span> <span class="hljs-symbol">value:</span>  min(ants_model collect each.food_gathered ) <span class="hljs-symbol">style:</span> spline <span class="hljs-symbol">color:</span> #darkgreen ;
                    <span class="hljs-keyword">data</span> <span class="hljs-string">"Max"</span> <span class="hljs-symbol">value:</span>  max(ants_model collect each.food_gathered ) <span class="hljs-symbol">style:</span> spline <span class="hljs-symbol">color:</span> #red ;
            }
        }
    }
}

</code></pre>
<pre><code class="hljs"><span class="hljs-builtin">model</span> Ants_coupling

import <span class="hljs-string">"../../../Toy Models/Ants (Foraging and Sorting)/models/Ant Foraging (Complex).gaml"</span> 



<span class="hljs-builtin">experiment</span> Ants_coupling_exp <span class="hljs-symbol">type:</span>gui  <span class="hljs-symbol">parent:</span>Complete{
    
    <span class="hljs-literal">list</span>&lt;ant&gt; getAnts{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">list</span>(ant);
    }
    
    <span class="hljs-literal">list</span>&lt;ant_grid&gt; getAnt_grid{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">list</span>(ant_grid);
    }
    
    <span class="hljs-keyword">output</span>{ 
    }
}
</code></pre>
<pre><code class="hljs"><span class="hljs-builtin">model</span> PreyPredator
 global
{
    <span class="hljs-literal">geometry</span> shape &lt;- square(100);
    <span class="hljs-literal">float</span> perceipt_radius &lt;- 20.0;
    <span class="hljs-literal">int</span> preyinit &lt;- 500;
    <span class="hljs-literal">int</span> predatorinit &lt;- 3;
    <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">agent</span>&gt; lstPredator &lt;- <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">agent</span>&gt;(predator);
    <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">agent</span>&gt; lstPrey &lt;- <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">agent</span>&gt;(prey);
    init
    {
        <span class="hljs-keyword">create</span> prey <span class="hljs-symbol">number:</span> preyinit;
        <span class="hljs-keyword">create</span> predator <span class="hljs-symbol">number:</span> predatorinit;
        lstPredator &lt;- <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">agent</span>&gt;(predator);
        lstPrey &lt;- <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">agent</span>&gt;(prey);
    }

}

<span class="hljs-literal">species</span> generic_species <span class="hljs-symbol">skills:</span> [<span class="hljs-builtin">moving</span>]
{
    <span class="hljs-literal">float</span> speed &lt;- 1.0;
    <span class="hljs-literal">point</span> goal &lt;- nil;
    <span class="hljs-literal">bool</span> is_chased &lt;- false;
    <span class="hljs-builtin">reflex</span> live_with_my_goal
    {
        <span class="hljs-keyword">if</span> (goal != nil)
        {
            <span class="hljs-keyword">do</span> wander <span class="hljs-symbol">speed:</span> speed;
            <span class="hljs-keyword">do</span> goto <span class="hljs-symbol">target:</span> goal <span class="hljs-symbol">speed:</span> speed;
        } <span class="hljs-keyword">else</span>
        {
            <span class="hljs-keyword">do</span> wander <span class="hljs-symbol">speed:</span> speed;
        }

    }

}

<span class="hljs-literal">species</span> prey <span class="hljs-symbol">parent:</span> generic_species
{
    <span class="hljs-literal">geometry</span> shape &lt;- circle(0.5);
    <span class="hljs-literal">float</span> speed &lt;- 0.2;
    <span class="hljs-literal">rgb</span> color &lt;- # green;
    <span class="hljs-builtin">reflex</span> fleeing
    {
        <span class="hljs-keyword">if</span> (length((lstPredator where (each != nil and !dead(each) and each distance_to self &lt; perceipt_radius))) &gt; 0)
        {
            speed &lt;- 1.0;
            is_chased &lt;- true;
            color &lt;- # lime;
            <span class="hljs-keyword">if</span> (goal = nil)
            {
                <span class="hljs-literal">agent</span> a &lt;- any(((lstPrey where (each != nil and !dead(each) and !generic_species(each).is_chased))));
                <span class="hljs-keyword">if</span> (a != nil and !dead(a))
                {
                    <span class="hljs-keyword">if</span> (flip(0.5))
                    {
                        goal &lt;- a.location;
                    } <span class="hljs-keyword">else</span>
                    {
                        goal &lt;- any_location_in(world.shape);
                    }

                } <span class="hljs-keyword">else</span>
                {
                    goal &lt;- any_location_in(world.shape);
                }

            }

        }

        <span class="hljs-keyword">if</span> (goal != nil and self.location distance_to goal &lt; 0.5)
        {
            goal &lt;- nil;
        }

        <span class="hljs-keyword">if</span> (length((lstPredator where (each != nil and !dead(each))) where (each distance_to self &lt;= perceipt_radius)) = 0)
        {
            is_chased &lt;- false;
            color &lt;- # green;
            speed &lt;- 0.2;
        }

    }

    <span class="hljs-keyword">aspect</span> <span class="hljs-keyword">default</span>
    {
        <span class="hljs-keyword">draw</span> shape <span class="hljs-symbol">color:</span> color;
    }

}

<span class="hljs-literal">species</span> predator <span class="hljs-symbol">parent:</span> generic_species
{
    <span class="hljs-literal">geometry</span> shape &lt;- triangle(2);
    <span class="hljs-literal">rgb</span> color &lt;- # red;
    <span class="hljs-builtin">reflex</span> hunting
    {
        <span class="hljs-keyword">if</span> (goal = nil)
        {
            <span class="hljs-literal">list</span> tmp &lt;- (lstPrey where (!dead(each) and each.shape distance_to self.shape &lt; perceipt_radius));
            <span class="hljs-keyword">if</span> (length(tmp) &gt; 0)
            {
                <span class="hljs-literal">agent</span> a &lt;- first(tmp sort (each.shape distance_to self.shape));
                <span class="hljs-keyword">if</span> (a = nil)
                {
                    a &lt;- any((lstPrey where (!dead(each))));
                }

                <span class="hljs-keyword">if</span> (a != nil)
                {
                    speed &lt;- 2.0;
                    goal &lt;- a.location;
                }

            }

        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((self.location distance_to goal &lt; 0.5))
        {
            <span class="hljs-keyword">ask</span> lstPrey where (!dead(each) and each.location distance_to goal &lt; 0.5)
            {
                <span class="hljs-keyword">do</span> die;
            }

            goal &lt;- nil;
            speed &lt;- 1.0;
        }

    }

    <span class="hljs-keyword">aspect</span> <span class="hljs-keyword">default</span>
    {
        <span class="hljs-keyword">draw</span> circle(perceipt_radius) <span class="hljs-symbol">color:</span> # pink <span class="hljs-symbol">empty:</span> true;
        <span class="hljs-keyword">draw</span> shape <span class="hljs-symbol">color:</span> color <span class="hljs-symbol">rotate:</span> 90 + my heading;
    }

}

<span class="hljs-builtin">experiment</span> prey_predator_exp <span class="hljs-symbol">type:</span> gui
{
    <span class="hljs-keyword">output</span>
    {
        <span class="hljs-keyword">display</span> main_display

        {
            <span class="hljs-literal">species</span> prey;
            <span class="hljs-literal">species</span> predator;
        }

    }

}
</code></pre>
<pre><code class="hljs"><span class="hljs-builtin">model</span> PreyPredator_coupling
import <span class="hljs-string">"PreyPredator.gaml"</span>

global
{   
}

<span class="hljs-builtin">experiment</span> PreyPredator_coupling_exp <span class="hljs-symbol">parent:</span>prey_predator_exp <span class="hljs-symbol">type:</span> gui
{
<span class="hljs-literal">geometry</span> shape&lt;- square(100);
    <span class="hljs-literal">list</span>&lt;prey&gt; getPrey{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">list</span>(prey);
    }
        <span class="hljs-literal">list</span>&lt;predator&gt; getPredator{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">list</span>(predator);
    }
    
    <span class="hljs-comment">//if we redefine the output, i.e, a blank output, the displays in parent experiement dont show.</span>
    <span class="hljs-keyword">output</span>
    {
    }

}


</code></pre>
<p>Code of the model :</p>
<pre><code class="hljs"><span class="hljs-builtin">model</span> comodel_mix_behaviors

import <span class="hljs-string">"PreyPredator_coupling.gaml"</span> as myPreyPredator
import <span class="hljs-string">"Ants_coupling.gaml"</span> as myAnt


global
{
    <span class="hljs-comment">//set the shape of environment: square 100 </span>
    <span class="hljs-literal">geometry</span> shape &lt;- square(100);
    <span class="hljs-comment">// the variable that refer to the ants population in micro-model </span>
    <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">agent</span>&gt; theAnts;
    <span class="hljs-comment">// the variable that refer to the prey population in micro-model</span>
    <span class="hljs-literal">list</span>&lt;prey&gt; thePreys;
    
    init
    {
        <span class="hljs-comment">//create the Ants micro-model with the size of grid is 100 and the population have 500 ants.</span>
        <span class="hljs-keyword">create</span> myAnt.Ants_coupling_exp <span class="hljs-symbol">with:</span> [gridsize::100,ants_number::500];
        <span class="hljs-comment">//create the PreyPredator micro-model with the parameters and the number of the prey is equal with the size of ants population</span>
        <span class="hljs-keyword">create</span> myPreyPredator.PreyPredator_coupling_exp <span class="hljs-symbol">with:</span> [shape::square(100), preyinit::myAnt.Ants_coupling_exp[0].simulation.ants_number, predatorinit::3]  
        {
            <span class="hljs-comment">// set the size of micro-model PreyPredator equal with the size of the grid of myAnt</span>
            shape &lt;- square(100);
        }

        <span class="hljs-comment">// save the original population of the Ants and the Preys</span>
        theAnts &lt;- myAnt.Ants_coupling_exp accumulate each.getAnts();
        thePreys &lt;- <span class="hljs-literal">list</span>&lt;prey&gt;(myPreyPredator.PreyPredator_coupling_exp accumulate each.getPrey());


    }

    <span class="hljs-builtin">reflex</span> simulate_micro_models
    {
        <span class="hljs-comment">// ask myAnt do a step</span>
        <span class="hljs-keyword">ask</span> (myAnt.Ants_coupling_exp collect each.simulation)
        {
            <span class="hljs-keyword">do</span> _step_;
        }
        <span class="hljs-comment">// ask myPreyPredator do a step, too</span>
        <span class="hljs-keyword">ask</span> (myPreyPredator.PreyPredator_coupling_exp collect each.simulation)
        {
            <span class="hljs-keyword">do</span> _step_;
        }

        <span class="hljs-comment">//check if a Prey is chased, set the position of that agent to the location of prey </span>
        <span class="hljs-comment">//if not, set ant's location to agent location.</span>
        <span class="hljs-comment">// if the agent (prey) died, then tell the ant do die</span>
        <span class="hljs-keyword">loop</span> i <span class="hljs-symbol">from:</span> 0 <span class="hljs-symbol">to:</span> length(theAnts) - 1
        {
            <span class="hljs-keyword">if</span> (!dead(thePreys at i) and !dead(theAnts at i))
            {
                <span class="hljs-keyword">if</span> (!(thePreys at i).is_chased)
                {
                    (thePreys at i).location &lt;- (theAnts at i).location;
                } <span class="hljs-keyword">else</span>
                {
                    (theAnts at i).location &lt;- (thePreys at i).location;
                }

            } <span class="hljs-keyword">else</span>
            {
                <span class="hljs-keyword">ask</span> (theAnts at i)
                {
                    <span class="hljs-keyword">do</span> die;
                }

            }

        }

    }

}

<span class="hljs-builtin">experiment</span> comodel_mix_behaviors_exp <span class="hljs-symbol">type:</span> gui
{
    <span class="hljs-keyword">output</span>
    {
        <span class="hljs-keyword">display</span> <span class="hljs-string">"comodel"</span>
        {
            <span class="hljs-keyword">agents</span> <span class="hljs-string">"ant_grid"</span> <span class="hljs-symbol">value:</span> myAnt.Ants_coupling_exp accumulate each.getAnt_grid() <span class="hljs-symbol">transparency:</span> 0.7;
            <span class="hljs-keyword">agents</span> <span class="hljs-string">"agentprey"</span> <span class="hljs-symbol">value:</span> (myPreyPredator.PreyPredator_coupling_exp accumulate each.getPrey());
            <span class="hljs-keyword">agents</span> <span class="hljs-string">"agentpredator"</span> <span class="hljs-symbol">value:</span> (myPreyPredator.PreyPredator_coupling_exp accumulate each.getPredator());
        }

    }

}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap" style="margin-bottom:0"><a href="/" class="nav-home"><img src="/img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://github.com/gama-platform"><i class="fab fa-github"></i> GitHub</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://gama-platform.github.io/blog/feed" target="_blank"><i class="fa fa-rss"></i> Blog RSS</a></div><div style="flex-grow:2"><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div style="color:hsla(0,0%,100%,.4);flex-grow:3"><h5>License</h5><p>Copyright (C) - 2020 GAMA-Platform.</p><p>Permission is granted to copy, distribute and/or modify this document under the terms of the GNU Free Documentation License, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.</p><p>A copy of the license is included <a href="https://github.com/gama-platform/gama/wiki/LICENSE.md" style="display:initial">here</a>, in the repository of the wiki content.</p></div></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.fbAsyncInit = function() {FB.init({appId:'524881055001796',xfbml:true,version:'v2.7'});};(function(d, s, id){var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) {return;}js = d.createElement(s); js.id = id;js.src = '//connect.facebook.net/en_US/sdk.js';fjs.parentNode.insertBefore(js, fjs);}(document, 'script','facebook-jssdk'));
                </script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'undefined',
                indexName: 'undefined',
                inputSelector: '#search_input_react'
              });
            </script></body></html>