<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Comodel SIR Switch · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="GAMA"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Comodel SIR Switch · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gama-platform.github.io/"/><meta property="og:description" content="GAMA"/><meta property="og:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/searchEngine.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/gama-logo_white.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/wiki/Home" target="_self">Documentation</a></li><li class=""><a href="/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Comodel SIR Switch</h1></header><article><div><span><p><em>Author : HUYNH Quang Nghi</em></p>
<p>This is a comodel that implement the dynamic of SIR_switch: it will use the EBM when the density of population is big and ABM when the density of population is low. It demonstrate the capability of using dynamically the legacy models.
SIR_ABM_coupling is the coupling that manipulates the elements inside SIR_ABM model and proposes the function would be used from outside. SIR_ABM is a simple example of SIR that use the agents to represent the spreading of disease..
SIR_EBM_coupling is the coupling that manipulates the elements inside SIR_EBM model and proposes the function would be used from outside. SIR_EBM is a simple example of ODE use into agents with the example of the SIR equation system.</p>
<p>Imported models :</p>
<pre><code class="hljs"><span class="hljs-builtin">model</span> SIR_ABM 

<span class="hljs-class">global</span>{
    <span class="hljs-literal">geometry</span> shape&lt;-envelope(square(100));
    <span class="hljs-literal">float</span> beta &lt;- 0.5 ;      
    <span class="hljs-literal">float</span> nu &lt;- 0.001 ;
    <span class="hljs-literal">float</span> delta &lt;- 0.01;
    init{
        create Host number:495 ;
        create Host number:5{state&lt;-1;}
        
    }
}

<span class="hljs-class">species <span class="hljs-title">Host</span> <span class="hljs-title">skills</span>:[<span class="hljs-title">moving</span>]</span>{
    <span class="hljs-literal">int</span> state&lt;-0;
    <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">rgb</span>&gt; color&lt;-[#green, #red, #yellow];
    <span class="hljs-class">reflex <span class="hljs-title">moving</span></span>{
        do wander;
    }


    
    <span class="hljs-class">reflex <span class="hljs-title">become_infected</span> <span class="hljs-title">when</span>: <span class="hljs-title">state</span>=1 </span>{
        <span class="hljs-literal">list</span> n&lt;- self neighbors_at(1);
        ask n{          
            <span class="hljs-keyword">if</span> (flip(beta)) {
                state&lt;-1;    
            }
        }
    }
    
    <span class="hljs-class">reflex <span class="hljs-title">become_immune</span> <span class="hljs-title">when</span>: (<span class="hljs-title">state</span>=1 <span class="hljs-title">and</span> <span class="hljs-title">flip</span>(<span class="hljs-title">delta</span>)) </span>{
        state&lt;-2;
    }
    
            
    aspect base{
        draw circle(1) color: color[state];
    }
}
<span class="hljs-class">experiment <span class="hljs-title">SIR_ABM_exp</span> <span class="hljs-title">type</span>:<span class="hljs-title">gui</span></span>{
    output {
        <span class="hljs-class">display <span class="hljs-title">gridDisp</span></span>{
            <span class="hljs-class">species <span class="hljs-title">Host</span> <span class="hljs-title">aspect</span>:<span class="hljs-title">base</span>;</span>
        }
    }
}
</code></pre>
<pre><code class="hljs"><span class="hljs-builtin">model</span> SIR_ABM_coupling

import <span class="hljs-string">"SIR_ABM.gaml"</span>
<span class="hljs-class">experiment <span class="hljs-title">SIR_ABM_coupling_exp</span> <span class="hljs-title">type</span>: <span class="hljs-title">gui</span> <span class="hljs-title">parent</span>: <span class="hljs-title">SIR_ABM_exp</span></span>
{
    <span class="hljs-literal">int</span> get_num_S
    {
        return length(Host where (each.state = 0));
    }

    <span class="hljs-literal">int</span> get_num_I
    {
        return length(Host where (each.state = 1));
    }

    <span class="hljs-literal">int</span> get_num_R
    {
        return length(Host where (each.state = 2));
    }

    action set_num_S_I_R (<span class="hljs-literal">int</span> numS, <span class="hljs-literal">int</span> numI, <span class="hljs-literal">int</span> numR)
    {
        unknown call;
        call &lt;- set_num_S(numS);
        call &lt;- set_num_I(numI);
        call &lt;- set_num_R(numR);
    }

    action set_num_S (<span class="hljs-literal">int</span> num)
    {
        ask (Host where (each.state = 0))
        {
            do die;
        }

        create Host number: num
        {
            state &lt;- 0;
        }

    }

    action set_num_I (<span class="hljs-literal">int</span> num)
    {
        ask (Host where (each.state = 1))
        {
            do die;
        }

        create Host number: num
        {
            state &lt;- 1;
        }

    }

    action set_num_R (<span class="hljs-literal">int</span> num)
    {
        ask (Host where (each.state = 2))
        {
            do die;
        }

        create Host number: num
        {
            state &lt;- 2;
        }

    }

    output
    {
    }

}
</code></pre>
<pre><code class="hljs"><span class="hljs-builtin">model</span> SIR_EBM

<span class="hljs-class">global </span>{
    init{
        create agent_with_SIR_dynamic;
    } 
}


<span class="hljs-class">species <span class="hljs-title">agent_with_SIR_dynamic</span> </span>{
    <span class="hljs-literal">int</span> N &lt;- 495 ;
    <span class="hljs-literal">int</span> iInit &lt;- 5;     

    <span class="hljs-literal">float</span> t;  
    <span class="hljs-literal">float</span> S &lt;- N - <span class="hljs-literal">float</span>(iInit);          
    <span class="hljs-literal">float</span> I &lt;- <span class="hljs-literal">float</span>(iInit); 
    <span class="hljs-literal">float</span> R &lt;- 0.0; 
    
    <span class="hljs-literal">float</span> alpha &lt;- 0.2;
    <span class="hljs-literal">float</span> beta &lt;- 0.8; 

    <span class="hljs-literal">float</span> h &lt;- 0.01;
   
    equation SIR{ 
        diff(S,t) = (- beta *   S * I / N);
        diff(I,t) = (  beta*  S * I / N) - (alpha * I)  ;
        diff(R,t) = (  alpha  *  I) ;
    }
                
    <span class="hljs-class">reflex <span class="hljs-title">solving</span> </span>{
<span class="hljs-comment">//      write S;</span>
        solve SIR method: <span class="hljs-string">"rk4"</span> step: h;<span class="hljs-comment">// cycle_length: 1/h ;</span>
    }    
}


<span class="hljs-class">experiment <span class="hljs-title">SIR_EBM_exp</span> <span class="hljs-title">type</span>: <span class="hljs-title">gui</span> </span>{
    output { 
        <span class="hljs-class">display <span class="hljs-title">display_charts</span> </span>{
            chart <span class="hljs-string">"SIR_agent"</span> type: series background: #white {
                data 'S' value: first(<span class="hljs-literal">list</span>(agent_with_SIR_dynamic)).S color: #green ;               
                data 'I' value: first(<span class="hljs-literal">list</span>(agent_with_SIR_dynamic)).I color: #red ;
                data 'R' value: first(<span class="hljs-literal">list</span>(agent_with_SIR_dynamic)).R color: #blue ;
            }
        }
    }
}
</code></pre>
<pre><code class="hljs"><span class="hljs-builtin">model</span> SIR_EBM_coupling

import <span class="hljs-string">"SIR_EBM.gaml"</span>
<span class="hljs-class">experiment <span class="hljs-title">SIR_EBM_coupling_exp</span> <span class="hljs-title">type</span>: <span class="hljs-title">gui</span> <span class="hljs-title">parent</span>: <span class="hljs-title">SIR_EBM_exp</span></span>
{
    <span class="hljs-literal">int</span> get_num_S
    {
        return first(agent_with_SIR_dynamic).S;
    }

    <span class="hljs-literal">int</span> get_num_I
    {
        return first(agent_with_SIR_dynamic).I;
    }

    <span class="hljs-literal">int</span> get_num_R
    {
        return first(agent_with_SIR_dynamic).R;
    }

    action set_num_S_I_R (<span class="hljs-literal">int</span> numS, <span class="hljs-literal">int</span> numI, <span class="hljs-literal">int</span> numR)
    {
        unknown call;
        call &lt;- set_num_S(numS);
        call &lt;- set_num_I(numI);
        call &lt;- set_num_R(numR);
    }

    action set_num_S (<span class="hljs-literal">int</span> num)
    {
        first(agent_with_SIR_dynamic).S &lt;- <span class="hljs-literal">float</span>(num);
    }

    action set_num_I (<span class="hljs-literal">int</span> num)
    {
        first(agent_with_SIR_dynamic).I &lt;- <span class="hljs-literal">float</span>(num);
    }

    action set_num_R (<span class="hljs-literal">int</span> num)
    {
        first(agent_with_SIR_dynamic).R &lt;- <span class="hljs-literal">float</span>(num);
    }

    output
    {
    }

}
</code></pre>
<p>Code of the model :</p>
<pre><code class="hljs"><span class="hljs-builtin">model</span> Comodel_SIR_Switch

import <span class="hljs-string">"Legacy_models/SIR_EBM_coupling.gaml"</span> as SIR_1
import <span class="hljs-string">"Legacy_models/SIR_ABM_coupling.gaml"</span> as SIR_2


<span class="hljs-class">global</span>
{
    <span class="hljs-literal">geometry</span> shape &lt;- envelope(square(100));
    <span class="hljs-literal">int</span> switch_threshold &lt;- 120; <span class="hljs-comment">// threshold for switching models</span>
    <span class="hljs-literal">int</span> threshold_to_IBM &lt;- 220; <span class="hljs-comment">// threshold under which the model swith to IBM</span>
    <span class="hljs-literal">int</span> threshold_to_Maths &lt;- 20;
    init
    {
        create SIR_1.SIR_EBM_coupling_exp;
        create SIR_2.SIR_ABM_coupling_exp;
        create Switch;
    }

}

<span class="hljs-class">species <span class="hljs-title">Switch</span></span>
{
    <span class="hljs-literal">int</span> S &lt;- 495;
    <span class="hljs-literal">int</span> I &lt;- 5;
    <span class="hljs-literal">int</span> R &lt;- 0;
    <span class="hljs-class">reflex <span class="hljs-title">request_from_micro_model</span></span>
    {
        <span class="hljs-comment">//if the size of S population and I population are bigger than a threshold, use the EBM</span>
        <span class="hljs-keyword">if</span> (S &gt; threshold_to_Maths and I &gt; threshold_to_Maths)
        {
            ask world
            {
                unknown call;
                call &lt;- first(SIR_1.SIR_EBM_coupling_exp).set_num_S_I_R(myself.S, myself.I, myself.R);
                ask first(SIR_1.SIR_EBM_coupling_exp).simulation
                {
                    loop times: 5
                    {
                        do _step_;
                    }

                }

                myself.S &lt;- first(SIR_1.SIR_EBM_coupling_exp).get_num_S();
                myself.I &lt;- first(SIR_1.SIR_EBM_coupling_exp).get_num_I();
                myself.R &lt;- first(SIR_1.SIR_EBM_coupling_exp).get_num_R();
            }

        }
        
        <span class="hljs-comment">//if the size of S population or  I population are smaller  than a threshold, use the ABM</span>
        <span class="hljs-keyword">if</span> (I &lt; threshold_to_IBM or S &lt; threshold_to_IBM)
        {
            ask world
            {
                unknown call;
                call &lt;- first(SIR_2.SIR_ABM_coupling_exp).set_num_S_I_R(myself.S, myself.I, myself.R);
                ask first(SIR_2.SIR_ABM_coupling_exp).simulation
                {
                    loop times: 1
                    {
                        do _step_;
                    }

                }

                myself.S &lt;- first(SIR_2.SIR_ABM_coupling_exp).get_num_S();
                myself.I &lt;- first(SIR_2.SIR_ABM_coupling_exp).get_num_I();
                myself.R &lt;- first(SIR_2.SIR_ABM_coupling_exp).get_num_R();
            }

        }

    }

    aspect base
    {
        draw square(100);
    }

}

<span class="hljs-class">experiment <span class="hljs-title">Simple_exp</span> <span class="hljs-title">type</span>: <span class="hljs-title">gui</span></span>
{
    output
    {
        <span class="hljs-class">display <span class="hljs-title">co_SIR_chart</span></span>
        {
            chart <span class="hljs-string">"SIR_agent"</span> type: series background: # white
            {
                data 'S' value: first(Switch).S color: # green;
                data 'I' value: first(Switch).I color: # red;
                data 'R' value: first(Switch).R color: # yellow;
            }

        }

    }

}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a></div><div><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div><h5>Ecosystem</h5><a href="https://github.com/gama-platform/gama"><i class="fab fa-github"></i> GitHub Gama</a><a href="https://github.com/gama-platform/gama.experimental"><i class="fas fa-puzzle-piece"></i> Gama Experimental Plugins</a><a href="https://github.com/gama-platform/gama.models.experimental"><i class="fas fa-scroll"></i> Gama Experimental Models</a></div></section><section class="copyright">Copyright © 2019 GAMA-Platform</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'undefined',
                indexName: 'undefined',
                inputSelector: '#search_input_react'
              });
            </script></body></html>