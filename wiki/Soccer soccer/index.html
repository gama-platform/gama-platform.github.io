<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Soccer Game · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="[//]: # (keyword|operator_norm)"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Soccer Game · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gama-platform.github.io/"/><meta property="og:description" content="[//]: # (keyword|operator_norm)"/><meta property="og:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://gama-platform.github.io/blog/atom.xml" title="GAMA-Platform Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://gama-platform.github.io/blog/feed.xml" title="GAMA-Platform Blog RSS Feed"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/searchEngine.js"></script><script type="text/javascript" src="/js/dark.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/gama-logo_white.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/wiki/Home" target="_self">Documentation</a></li><li class=""><a href="/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Soccer Game</h1></header><article><div><span><p><em>Author : Julien</em></p>
<p>This model shows how can we make an easy simulation of collective games, such as soccer.
Each player have an offensive and a defensive position, and a behavior associated. Each player of the defensive team can either search to catch the ball or mark an other player (offensive player) according to his defensive position.
Each player of the offensive team can either run to its offensive place (when he does not have the ball), run with the balloon / pass the ball / try to score a goal (when he has the ball). By changing the different parameters, you can see the concequences in real time.</p>
<p>Code of the model :</p>
<pre><code class="hljs">
<span class="hljs-builtin">model</span> soccer

global {
    <span class="hljs-literal">geometry</span> shape &lt;- rectangle(120#m,90#m);
    <span class="hljs-literal">float</span> red_players_speed &lt;- 1.0;
    <span class="hljs-literal">float</span> blue_players_speed &lt;- 1.0;
    <span class="hljs-literal">float</span> red_size_play_area &lt;- 30.0 <span class="hljs-symbol">min:</span>1.0 <span class="hljs-symbol">max:</span>100.0;
    <span class="hljs-literal">float</span> blue_size_play_area &lt;- 30.0 <span class="hljs-symbol">min:</span> 1.0 <span class="hljs-symbol">max:</span>100.0;
    <span class="hljs-literal">float</span> previous_red_size_play_area &lt;- red_size_play_area; <span class="hljs-comment">// just to check if the parameter value has been changed</span>
    <span class="hljs-literal">float</span> previous_blue_size_play_area &lt;- blue_size_play_area; <span class="hljs-comment">// just to check if the parameter value has been changed</span>
    <span class="hljs-literal">float</span> red_collective_play &lt;- 0.5 <span class="hljs-symbol">min:</span>0.0 <span class="hljs-symbol">max:</span>1.0;
    <span class="hljs-literal">float</span> blue_collective_play &lt;- 0.5 <span class="hljs-symbol">min:</span>0.0 <span class="hljs-symbol">max:</span>1.0;
    <span class="hljs-literal">float</span> red_recuperation_ability &lt;- 0.5 <span class="hljs-symbol">min:</span>0.0 <span class="hljs-symbol">max:</span>1.0;
    <span class="hljs-literal">float</span> blue_recuperation_ability &lt;- 0.5 <span class="hljs-symbol">min:</span>0.0 <span class="hljs-symbol">max:</span>1.0;
    
    <span class="hljs-literal">int</span> red_score &lt;- 0;
    <span class="hljs-literal">int</span> red_possession &lt;- 0;
    <span class="hljs-literal">int</span> nb_red_pass &lt;- 0;
    <span class="hljs-literal">int</span> nb_red_pass_succeed &lt;- 0;
    <span class="hljs-literal">int</span> nb_red_interception &lt;- 0;
    <span class="hljs-literal">int</span> blue_score &lt;- 0;
    <span class="hljs-literal">int</span> blue_possession &lt;- 0;
    <span class="hljs-literal">int</span> nb_blue_pass &lt;- 0;
    <span class="hljs-literal">int</span> nb_blue_pass_succeed &lt;- 0;
    <span class="hljs-literal">int</span> nb_blue_interception &lt;- 0;
    
    <span class="hljs-literal">bool</span> show_status &lt;- false;
    <span class="hljs-literal">bool</span> show_area &lt;- false;
    <span class="hljs-literal">bool</span> show_marked_player &lt;- false;
    <span class="hljs-literal">bool</span> show_ball_indicator &lt;- false;
    
    <span class="hljs-literal">bool</span> play_with_offside &lt;- true;
    
    <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">point</span>&gt; bluePlayerPosition &lt;- [{8,10}, {8,80}, {10,30}, {10,60},
        {30,25}, {28,45}, {30,65},
        {50,25}, {50,65}, {55,45}
    ];
    
    <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">point</span>&gt; redPlayerPosition &lt;- [{120-8,10}, {120-8,80}, {120-10,30}, {120-10,60},
        {120-30,25}, {120-28,45}, {120-30,65},
        {120-50,25}, {120-50,65}, {120-55,45}
    ];
    
    ball ball_agent;
    player closest_red_player_from_the_ball;
    player closest_blue_player_from_the_ball;
    player called_player;
    <span class="hljs-literal">string</span> team_possession &lt;- <span class="hljs-string">""</span>;
    <span class="hljs-literal">float</span> blue_offside_pos &lt;- 120.0;
    <span class="hljs-literal">float</span> red_offside_pos &lt;- 0.0;
    
    init {
        <span class="hljs-keyword">loop</span> pos <span class="hljs-symbol">over:</span>redPlayerPosition {
            <span class="hljs-keyword">create</span> player <span class="hljs-symbol">with:</span>[team::<span class="hljs-string">"red"</span>, location::pos];
        }
        <span class="hljs-keyword">loop</span> pos <span class="hljs-symbol">over:</span>bluePlayerPosition {
            <span class="hljs-keyword">create</span> player <span class="hljs-symbol">with:</span>[team::<span class="hljs-string">"blue"</span>, location::pos];
        }
        <span class="hljs-keyword">create</span> ball <span class="hljs-symbol">with:</span>[location::location] <span class="hljs-symbol">returns:</span>ball_agt;
        ball_agent&lt;-ball_agt at 0;
        <span class="hljs-keyword">create</span> goal <span class="hljs-symbol">with:</span>[location::{0,location.y}, team::<span class="hljs-string">"blue"</span>];
        <span class="hljs-keyword">create</span> goal <span class="hljs-symbol">with:</span>[location::{120,location.y}, team::<span class="hljs-string">"red"</span>];
    }
    
    <span class="hljs-builtin">reflex</span> update {
        <span class="hljs-literal">float</span> shortest_distance &lt;- 100.0;
        <span class="hljs-literal">float</span> offside_pos &lt;- 0.0;
        <span class="hljs-keyword">ask</span> player where (each.team = <span class="hljs-string">"red"</span>) {
            <span class="hljs-keyword">if</span> (distance_to_ball &lt; shortest_distance and inactivity_time=0) {
                closest_red_player_from_the_ball &lt;- self;
                shortest_distance &lt;- distance_to_ball;
            }
            <span class="hljs-keyword">if</span> (location.x &gt; offside_pos) {
                offside_pos &lt;- location.x;
                red_offside_pos &lt;- offside_pos;
            }
        }
        <span class="hljs-keyword">if</span> (not play_with_offside) {
            red_offside_pos &lt;- 120.0;
        }
        
        shortest_distance &lt;- 100.0;
        offside_pos &lt;- 100.0;
        <span class="hljs-keyword">ask</span> player where (each.team = <span class="hljs-string">"blue"</span>) {
            <span class="hljs-keyword">if</span> (distance_to_ball &lt; shortest_distance and inactivity_time=0) {
                closest_blue_player_from_the_ball &lt;- self;
                shortest_distance &lt;- distance_to_ball;
            }
            <span class="hljs-keyword">if</span> (location.x &lt; offside_pos) {
                offside_pos &lt;- location.x;
                blue_offside_pos &lt;- offside_pos;
            }
        }
        <span class="hljs-keyword">if</span> (not play_with_offside) {
            blue_offside_pos &lt;- 0.0;
        }
        
        <span class="hljs-keyword">if</span> (previous_red_size_play_area != red_size_play_area) {
            <span class="hljs-keyword">ask</span> area where (each.team = <span class="hljs-string">"red"</span>) {
                <span class="hljs-keyword">do</span> update_size;
            }
            previous_red_size_play_area &lt;- red_size_play_area;
        }
        <span class="hljs-keyword">if</span> (previous_blue_size_play_area != blue_size_play_area) {
            <span class="hljs-keyword">ask</span> area where (each.team = <span class="hljs-string">"blue"</span>) {
                <span class="hljs-keyword">do</span> update_size;
            }
            previous_blue_size_play_area &lt;- blue_size_play_area;
        }
        <span class="hljs-keyword">if</span> (team_possession = <span class="hljs-string">"blue"</span>) {
            blue_possession &lt;- blue_possession + 1;
        }
        <span class="hljs-keyword">if</span> (team_possession = <span class="hljs-string">"red"</span>) {
            red_possession &lt;- red_possession + 1;
        }
    }
    
    <span class="hljs-keyword">action</span> reinit_phase {
        <span class="hljs-keyword">ask</span> player {
            location &lt;- init_pos;
            previous_pos &lt;- init_pos;
        }
        ball_agent.location &lt;- location;
        ball_agent.destination &lt;- location;
        ball_agent.speed &lt;- 0.0;
    }
}

<span class="hljs-literal">species</span> player <span class="hljs-symbol">skills:</span>[<span class="hljs-builtin">moving</span>] {
    <span class="hljs-literal">string</span> team &lt;- <span class="hljs-string">""</span>; <span class="hljs-comment">// value : "blue" (left side) or "red" (right side)</span>
    <span class="hljs-literal">bool</span> possess_ball &lt;- false;
    <span class="hljs-literal">int</span> inactivity_time &lt;- 0 <span class="hljs-symbol">update:</span>(inactivity_time&lt;=0) ? 0 : inactivity_time-1;
    <span class="hljs-literal">int</span> seed &lt;- rnd(100);
    <span class="hljs-literal">point</span> init_pos;
    <span class="hljs-literal">point</span> previous_pos;
    
    <span class="hljs-comment">// strategy</span>
    area defensive_pos;
    area offensive_pos;
    player marked_player;
    <span class="hljs-literal">float</span> collective_mark &lt;- 0.5 <span class="hljs-symbol">update:</span>(team=<span class="hljs-string">"red"</span>) ? red_collective_play : blue_collective_play;
    <span class="hljs-literal">float</span> recuperation_mark &lt;- 0.5 <span class="hljs-symbol">update:</span>(team=<span class="hljs-string">"red"</span>) ? red_recuperation_ability : blue_recuperation_ability;
    
    <span class="hljs-literal">string</span> <span class="hljs-keyword">status</span> &lt;- <span class="hljs-string">""</span>;
    
    <span class="hljs-comment">// moving attributes</span>
    <span class="hljs-literal">float</span> running_speed_without_ball &lt;- 0.8 <span class="hljs-symbol">update:</span>(team=<span class="hljs-string">"red"</span>) ? red_players_speed*0.8 : blue_players_speed*0.8;
    <span class="hljs-literal">float</span> running_speed_with_ball &lt;- 0.6 <span class="hljs-symbol">update:</span>(team=<span class="hljs-string">"red"</span>) ? red_players_speed*0.5 : blue_players_speed*0.5;
    <span class="hljs-literal">float</span> speed &lt;- 0.0 <span class="hljs-symbol">max:</span>1.2;
    <span class="hljs-literal">point</span> velocity &lt;- {0,0};
    
    <span class="hljs-literal">float</span> distance_to_closest_ennemy &lt;- 100.0;
    <span class="hljs-literal">float</span> distance_to_ennemy_goal &lt;- 100.0 <span class="hljs-symbol">update:</span>self distance_to ( (goal where (each.team != team)) at 0);
    <span class="hljs-literal">float</span> distance_to_ball &lt;- 100.0 <span class="hljs-symbol">update:</span>self distance_to ball_agent;
    
    init {
        init_pos &lt;- location;
        previous_pos &lt;- location;
        <span class="hljs-keyword">create</span> area <span class="hljs-symbol">with:</span>[location::init_pos, team::self.team, position::init_pos] <span class="hljs-symbol">returns:</span>def_pos;
        defensive_pos &lt;- def_pos at 0;
        <span class="hljs-literal">point</span> offensivePos &lt;- {(team=<span class="hljs-string">"red"</span>) ? init_pos.x-60 : init_pos.x+60,init_pos.y};
        <span class="hljs-keyword">create</span> area <span class="hljs-symbol">with:</span>[location::offensivePos, team::self.team, position::offensivePos] <span class="hljs-symbol">returns:</span>off_pos;
        offensive_pos &lt;- off_pos at 0;
    }
    
    <span class="hljs-builtin">reflex</span> update_status {
        distance_to_closest_ennemy &lt;- 100.0;
        <span class="hljs-keyword">loop</span> pl <span class="hljs-symbol">over:</span>player where (each.team != team) {
            <span class="hljs-literal">float</span> distance_to_ennemy &lt;- self distance_to pl;
            <span class="hljs-keyword">if</span> (distance_to_ennemy &lt; distance_to_closest_ennemy) {
                distance_to_closest_ennemy &lt;- distance_to_ennemy;
            }
        }
    }
    
    <span class="hljs-builtin">reflex</span> defensive_behavior <span class="hljs-symbol">when:</span>team_possession != team {
        <span class="hljs-comment">// the ball is not possessed by the team.</span>
        <span class="hljs-keyword">do</span> apply_inertia;
        <span class="hljs-keyword">if</span> (self = closest_red_player_from_the_ball or self = closest_blue_player_from_the_ball) {
            <span class="hljs-keyword">do</span> run_to_ball;
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">do</span> defensive_move;
        }
    }
    
    <span class="hljs-builtin">reflex</span> offensive_behavior <span class="hljs-symbol">when:</span>team_possession = team {
        <span class="hljs-keyword">do</span> apply_inertia;
        <span class="hljs-keyword">if</span> (possess_ball) {
            <span class="hljs-keyword">do</span> run_with_ball;
            <span class="hljs-keyword">if</span> (distance_to_ennemy_goal &lt; 30 and flip(1/(distance_to_ennemy_goal*distance_to_ennemy_goal/10+1))) {
                <span class="hljs-comment">// shoot !</span>
                <span class="hljs-keyword">do</span> kick_ball_to_goal;
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// pass !</span>
                <span class="hljs-keyword">if</span> (distance_to_closest_ennemy &lt; 5) {
                    <span class="hljs-keyword">if</span> (flip(collective_mark)) {
                        <span class="hljs-keyword">do</span> pass_the_ball;
                    }
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> flip(collective_mark/50) {
                    <span class="hljs-keyword">do</span> pass_the_ball;
                }
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ball_agent.belong_to_team = <span class="hljs-string">""</span> and
            (self = closest_red_player_from_the_ball or self = closest_blue_player_from_the_ball
            or self = called_player)
        ) {
            <span class="hljs-keyword">do</span> run_to_ball;
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">do</span> offensive_move;
        }
    }
    
    <span class="hljs-builtin">reflex</span> choose_player_to_mark <span class="hljs-symbol">when:</span>(cycle mod 20=seed or cycle=0) {
        <span class="hljs-keyword">if</span> ( not empty(player where(each.offensive_pos intersects defensive_pos)) ) {
            marked_player &lt;- 1 among (player where((each.offensive_pos intersects defensive_pos) and (each.team != team))) at 0;
        }
    }
    
    <span class="hljs-keyword">action</span> apply_inertia {
        <span class="hljs-literal">point</span> prev_pos &lt;- location;
        <span class="hljs-literal">point</span> inertia_vect &lt;- {(location.x-previous_pos.x)*0.8,(location.y-previous_pos.y)*0.8};
        <span class="hljs-literal">float</span> max_inertia &lt;- running_speed_without_ball;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">norm</span>(inertia_vect) &gt; max_inertia) {
            <span class="hljs-literal">float</span> inertia_x &lt;-  sqrt(abs(max_inertia*max_inertia-inertia_vect.y*inertia_vect.y));
            <span class="hljs-literal">float</span> inertia_y &lt;-  sqrt(abs(max_inertia*max_inertia-inertia_vect.x*inertia_vect.x));
            inertia_x &lt;- (inertia_vect.x &lt; 0) ? -inertia_x : inertia_x;
            inertia_y &lt;- (inertia_vect.y &lt; 0) ? -inertia_y : inertia_y;
            inertia_vect &lt;- {inertia_x,inertia_y};
        }
        location &lt;- location + inertia_vect;
        previous_pos &lt;- prev_pos;
    }
    
    <span class="hljs-keyword">action</span> run_to_ball {
        <span class="hljs-literal">point</span> targetPos;
        <span class="hljs-keyword">if</span> (ball_agent.ball_direction intersects circle(1)) {
            targetPos &lt;- ball_agent.location;
        }
        <span class="hljs-keyword">else</span> {
            targetPos &lt;- (ball_agent.ball_direction closest_points_with self) at 0;
        }
        <span class="hljs-keyword">do</span> goto <span class="hljs-symbol">with:</span>[target::targetPos, speed::running_speed_without_ball];
        
        <span class="hljs-keyword">status</span> &lt;- <span class="hljs-string">"run to the ball"</span>;
        
        <span class="hljs-comment">// if close enough, catch the ball</span>
        <span class="hljs-keyword">if</span> (location distance_to ball_agent.location &lt; 1.5#m) {
            <span class="hljs-keyword">if</span> (self = called_player) {
                <span class="hljs-keyword">do</span> take_ball;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ball_agent.belong_to_team = <span class="hljs-string">""</span>) {
                <span class="hljs-keyword">if</span> flip(1/(ball_agent.speed*recuperation_mark+1)) {
                    <span class="hljs-keyword">do</span> take_ball;
                }
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (team_possession = team) {
                    <span class="hljs-comment">// result of a long pass for instance</span>
                    <span class="hljs-keyword">if</span> (flip(recuperation_mark*1.5)) {
                        <span class="hljs-keyword">do</span> take_ball;
                    }
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// interception of the ball</span>
                    <span class="hljs-keyword">if</span> (flip(recuperation_mark*0.8)) {
                        <span class="hljs-keyword">do</span> take_ball;
                    }
                }
            }
        }
    }
    
    <span class="hljs-keyword">action</span> run_with_ball {
        <span class="hljs-keyword">status</span> &lt;- <span class="hljs-string">"run with the ball"</span>;
        <span class="hljs-literal">point</span> goal_pos;
        <span class="hljs-keyword">ask</span> goal {
            <span class="hljs-keyword">if</span> (self.team != myself.team) {
                goal_pos &lt;- location;
            }
        }
        <span class="hljs-keyword">do</span> goto <span class="hljs-symbol">with:</span>[target::goal_pos, speed::running_speed_with_ball];
        ball_agent.location &lt;- location;
    }
    
    <span class="hljs-keyword">action</span> offensive_move {
        <span class="hljs-comment">// try to reach an offensive postion</span>
        <span class="hljs-literal">point</span> target_location;
        <span class="hljs-literal">geometry</span> possible_pos &lt;- (team=<span class="hljs-string">"red"</span>) ? world inter (rectangle({blue_offside_pos,0},{120,90}))
        : world inter (rectangle({0,0},{red_offside_pos,90}));
        
        
        <span class="hljs-comment">// check if the player is in the field</span>
        <span class="hljs-keyword">if</span> (location.y &lt; 0) {
            target_location &lt;- {location.x,90};
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (location.y &gt; 90) {
            target_location &lt;- {location.x,0};
        }
        <span class="hljs-comment">// check if the player is in offside position</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( (location.x &gt; red_offside_pos and team = <span class="hljs-string">"blue"</span>) or (location.x &lt; blue_offside_pos and team = <span class="hljs-string">"red"</span>)) {
            target_location &lt;- (team=<span class="hljs-string">"red"</span>) ? {120,location.y} : {0,location.y};
            <span class="hljs-keyword">status</span> &lt;- <span class="hljs-string">"run to a non offside position"</span>;
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">status</span> &lt;- <span class="hljs-string">"run to a offensive place"</span>;
            <span class="hljs-keyword">if</span> (not (possible_pos intersects offensive_pos)) {
                target_location &lt;- (team=<span class="hljs-string">"red"</span>) ? {blue_offside_pos,location.y} : {red_offside_pos,location.y};
            }
            <span class="hljs-keyword">else</span>
            {
                target_location &lt;- any_location_in(offensive_pos inter possible_pos);
            }
        }
        <span class="hljs-keyword">do</span> goto <span class="hljs-symbol">target:</span>target_location <span class="hljs-symbol">speed:</span>running_speed_without_ball;
    }
    
    <span class="hljs-keyword">action</span> defensive_move {
        <span class="hljs-comment">// try to mark an ennemy player</span>
        <span class="hljs-keyword">status</span> &lt;- <span class="hljs-string">"mark ennemy player"</span>;
        <span class="hljs-keyword">if</span> (not (marked_player = nil)) {
            <span class="hljs-keyword">do</span> goto <span class="hljs-symbol">with:</span>[target::marked_player.location+((team=<span class="hljs-string">"red"</span>)?{2+rnd(5.0),rnd(2.0)-1} : {-2-rnd(5.0),rnd(2.0)-1}), speed::running_speed_without_ball];
        }
    }
    
    <span class="hljs-keyword">action</span> kick_ball_to_goal {
        <span class="hljs-keyword">do</span> loose_ball;
        <span class="hljs-keyword">ask</span> ball_agent {
            <span class="hljs-keyword">do</span> shooted <span class="hljs-symbol">speed_atr:</span>4.0 <span class="hljs-symbol">target_position:</span>((goal where (each.team != myself.team)) at 0).location;
        }
        inactivity_time &lt;- 20;
    }
    
    <span class="hljs-keyword">action</span> pass_the_ball {
        <span class="hljs-literal">float</span> wisest_choice_mark &lt;- -100.0;
        player wisest_target;
        <span class="hljs-keyword">ask</span> player  where(each.team = team and each != self and (self distance_to each &gt; 15)) {
            <span class="hljs-literal">int</span> number_of_ennemies_on_range &lt;- length(player at_distance 5 where (each.team != myself.team));
            <span class="hljs-literal">float</span> wise_choice_mark &lt;- 100-distance_to_ball+number_of_ennemies_on_range*10-2*distance_to_ennemy_goal;
            <span class="hljs-keyword">if</span> (wise_choice_mark &gt; wisest_choice_mark) {
                wisest_target &lt;- self;
                wisest_choice_mark &lt;- wise_choice_mark;
            }
        }
        <span class="hljs-keyword">if</span> (wisest_choice_mark &gt; -100.0) {
            <span class="hljs-comment">// a target has been found</span>
            <span class="hljs-keyword">do</span> loose_ball;
            <span class="hljs-keyword">ask</span> ball_agent {
                <span class="hljs-keyword">do</span> shooted <span class="hljs-symbol">target_position:</span>wisest_target.location <span class="hljs-symbol">speed_atr:</span>wisest_target.distance_to_ball/8;
            }
            called_player &lt;- wisest_target;
            inactivity_time &lt;- 20;
            <span class="hljs-keyword">if</span> (team = <span class="hljs-string">"red"</span>) {nb_red_pass &lt;- nb_red_pass+1;}
            <span class="hljs-keyword">else</span> {nb_blue_pass &lt;- nb_blue_pass+1;}
        }
    }
    
    <span class="hljs-keyword">action</span> take_ball {
        <span class="hljs-keyword">if</span> (ball_agent.belong_to_team != <span class="hljs-string">""</span> and ball_agent.belong_to_team != team) {
            <span class="hljs-keyword">ask</span> ball_agent.belong_to_player {
                <span class="hljs-keyword">do</span> loose_ball;
            }
        }
        team_possession &lt;- team;
        possess_ball &lt;- true;
        ball_agent.belong_to_team &lt;- team;
        ball_agent.belong_to_player &lt;- self;
        ball_agent.speed &lt;- 0.0;
        <span class="hljs-keyword">if</span> (self = called_player) {
            <span class="hljs-keyword">if</span> (team = <span class="hljs-string">"red"</span>) {nb_red_pass_succeed &lt;- nb_red_pass_succeed+1;}
            <span class="hljs-keyword">else</span> {nb_blue_pass_succeed &lt;- nb_blue_pass_succeed+1;}
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (team = <span class="hljs-string">"red"</span>) {nb_red_interception &lt;- nb_red_interception+1;}
            <span class="hljs-keyword">else</span> {nb_blue_interception &lt;- nb_blue_interception+1;}
        }
        called_player &lt;- nil;
    }
    
    <span class="hljs-keyword">action</span> loose_ball {
        possess_ball &lt;- false;
        ball_agent.belong_to_team &lt;- <span class="hljs-string">""</span>;
    }
    
    <span class="hljs-keyword">aspect</span> base {
        <span class="hljs-keyword">draw</span> circle(1) <span class="hljs-symbol">color:</span>(team=<span class="hljs-string">"red"</span>) ? #red : #blue;
        <span class="hljs-keyword">if</span> (show_status) {
            <span class="hljs-keyword">draw</span> <span class="hljs-literal">string</span>(<span class="hljs-keyword">status</span>);
            <span class="hljs-keyword">if</span> (marked_player != nil) {
                <span class="hljs-keyword">draw</span> polyline([location,marked_player.location]);
            }
        }
        <span class="hljs-keyword">if</span> (marked_player != nil and show_marked_player) {
            <span class="hljs-keyword">draw</span> polyline([location,marked_player.location]) <span class="hljs-symbol">end_arrow:</span>1 <span class="hljs-symbol">color:</span>#chartreuse;
        }
    }
}

<span class="hljs-literal">species</span> area {
    <span class="hljs-literal">string</span> team &lt;- <span class="hljs-string">""</span>;
    <span class="hljs-literal">point</span> position;
    
    init {
        shape &lt;- ((team=<span class="hljs-string">"red"</span>) ? square(red_size_play_area) : square(blue_size_play_area)) inter world;
    }
    
    <span class="hljs-keyword">action</span> update_size {
        location &lt;- position;
        shape &lt;- ((team=<span class="hljs-string">"red"</span>) ? square(red_size_play_area) : square(blue_size_play_area)) inter world;
    }
    
    <span class="hljs-keyword">aspect</span> base {
        <span class="hljs-keyword">if</span> (show_area) {
            <span class="hljs-keyword">draw</span> shape <span class="hljs-symbol">color:</span><span class="hljs-literal">rgb</span>(128,128,128,50) <span class="hljs-symbol">border:</span>(team=<span class="hljs-string">"red"</span>) ? <span class="hljs-literal">rgb</span>(256,0.0,0.0,100) : <span class="hljs-literal">rgb</span>(0.0,0.0,256.0,100);
        }
    }
}

<span class="hljs-literal">species</span> ball <span class="hljs-symbol">skills:</span>[<span class="hljs-builtin">moving</span>]{
    <span class="hljs-literal">string</span> belong_to_team &lt;- <span class="hljs-string">""</span>;
    player belong_to_player;
    <span class="hljs-literal">float</span> speed &lt;- 0.0 <span class="hljs-symbol">update:</span>speed*0.9;
    <span class="hljs-literal">list</span>&lt;<span class="hljs-literal">point</span>&gt; nextPlace;
    <span class="hljs-literal">geometry</span> ball_direction;
    <span class="hljs-builtin">reflex</span> update {
        <span class="hljs-literal">float</span> future_speed &lt;- speed;
        <span class="hljs-literal">point</span> tmpPos&lt;-location;
        <span class="hljs-keyword">loop</span> i <span class="hljs-symbol">from:</span>0 <span class="hljs-symbol">to:</span>10 {
            tmpPos &lt;- {tmpPos.x+cos(heading)*speed,tmpPos.y+sin(heading)*speed};
            future_speed &lt;- future_speed*0.9;
        }
        ball_direction &lt;- line([location,tmpPos]);
        <span class="hljs-keyword">if</span> ((location.x+cos(heading)*speed) &gt; 120) {
            blue_score &lt;- blue_score + 1;
            <span class="hljs-keyword">ask</span> world {
                <span class="hljs-keyword">do</span> reinit_phase;
            }
        }
        <span class="hljs-keyword">if</span> ((location.x+cos(heading)*speed) &lt; 0) {
            red_score &lt;- red_score + 1;
            <span class="hljs-keyword">ask</span> world {
                <span class="hljs-keyword">do</span> reinit_phase;
            }
        }
        <span class="hljs-keyword">do</span> wander <span class="hljs-symbol">amplitude:</span>1;
    }
    <span class="hljs-keyword">action</span> shooted (<span class="hljs-literal">point</span> target_position, <span class="hljs-literal">float</span> speed_atr) {
        speed &lt;- speed_atr;
        <span class="hljs-keyword">do</span> goto <span class="hljs-symbol">target:</span>target_position;
    }
    <span class="hljs-keyword">aspect</span> base {
        <span class="hljs-keyword">draw</span> circle(0.5) <span class="hljs-symbol">color:</span>#white <span class="hljs-symbol">border:</span>#black;
        <span class="hljs-keyword">if</span> (show_ball_indicator) {
            <span class="hljs-keyword">draw</span> ball_direction <span class="hljs-symbol">end_arrow:</span>1 <span class="hljs-symbol">color:</span>#chartreuse;
            <span class="hljs-keyword">if</span> (team_possession=<span class="hljs-string">"red"</span>) {
                <span class="hljs-keyword">draw</span> circle(0.5) <span class="hljs-symbol">color:</span>#darkred <span class="hljs-symbol">border:</span>#black;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (team_possession=<span class="hljs-string">"blue"</span>) {
                <span class="hljs-keyword">draw</span> circle(0.5) <span class="hljs-symbol">color:</span>#darkblue <span class="hljs-symbol">border:</span>#black;
            }
        }
    }
}

<span class="hljs-literal">species</span> goal {
    <span class="hljs-literal">string</span> team &lt;- <span class="hljs-string">""</span>;
    <span class="hljs-keyword">aspect</span> base {
        <span class="hljs-keyword">draw</span> rectangle(0.1,7.32) <span class="hljs-symbol">color:</span>#black;
    }
}


<span class="hljs-builtin">experiment</span> <span class="hljs-keyword">match</span> <span class="hljs-symbol">type:</span>gui {
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"blue running speed"</span> <span class="hljs-symbol">var:</span>blue_players_speed <span class="hljs-symbol">category:</span><span class="hljs-string">"Blue Team"</span>;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"red running speed"</span> <span class="hljs-symbol">var:</span>red_players_speed <span class="hljs-symbol">category:</span><span class="hljs-string">"Red Team"</span>;
    <span class="hljs-comment">// speed of players when they run. Note that a player which have the ball will run at 50% of his max capacity, and he will run at 80% of his max capacity if he does not have the ball.</span>
    
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"blue collective play"</span> <span class="hljs-symbol">var:</span>blue_collective_play <span class="hljs-symbol">category:</span><span class="hljs-string">"Blue Team"</span>;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"red collective play"</span> <span class="hljs-symbol">var:</span>red_collective_play <span class="hljs-symbol">category:</span><span class="hljs-string">"Red Team"</span>;
    <span class="hljs-comment">// propention of giving the ball to an other player of the team. If the value is 0, the player will never pass the ball.</span>
    
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"blue recuperation ability"</span> <span class="hljs-symbol">var:</span>blue_recuperation_ability <span class="hljs-symbol">category:</span><span class="hljs-string">"Blue Team"</span>;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"red recuperation ability"</span> <span class="hljs-symbol">var:</span>red_recuperation_ability <span class="hljs-symbol">category:</span><span class="hljs-string">"Red Team"</span>;
    <span class="hljs-comment">// ability to catch the ball when no player has it and when a player of the other team has it. 1 for very good hability, 0 for very poor hability.</span>
    
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"blue play area size"</span> <span class="hljs-symbol">var:</span>blue_size_play_area <span class="hljs-symbol">category:</span><span class="hljs-string">"Blue Team"</span>;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"red play area size"</span> <span class="hljs-symbol">var:</span>red_size_play_area <span class="hljs-symbol">category:</span><span class="hljs-string">"Red Team"</span>;
    <span class="hljs-comment">// change the size of the area of each player. The bigger this area is, the less players will maintains their position.</span>
    
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"display status"</span> <span class="hljs-symbol">var:</span>show_status <span class="hljs-symbol">category:</span><span class="hljs-string">"Display"</span>;
    <span class="hljs-comment">// displays or not the current status of the player (his intentions)</span>
    
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"display play area"</span> <span class="hljs-symbol">var:</span>show_area <span class="hljs-symbol">category:</span><span class="hljs-string">"Display"</span>;
    <span class="hljs-comment">// displays or not the offensive and defensive area of each player. The bigger this area is, the less players will maintains their position.</span>
    
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"display marked player"</span> <span class="hljs-symbol">var:</span>show_marked_player <span class="hljs-symbol">category:</span><span class="hljs-string">"Display"</span>;
    <span class="hljs-comment">// displays or not an arrow between the player that are marked each other.</span>
    
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"display ball indicators"</span> <span class="hljs-symbol">var:</span>show_ball_indicator <span class="hljs-symbol">category:</span><span class="hljs-string">"Display"</span>;
    <span class="hljs-comment">// changes the color of the ball if the ball is possessed by the blue or the red team. Display also the direction of the ball when it has been shooted.</span>
    
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"play with offside position"</span> <span class="hljs-symbol">var:</span>play_with_offside <span class="hljs-symbol">category:</span><span class="hljs-string">"Rules"</span>;
    <span class="hljs-comment">// play with or without the "offside" rule.</span>
    
    <span class="hljs-keyword">output</span> {
        <span class="hljs-keyword">display</span> <span class="hljs-string">"soccer_field"</span> {
            <span class="hljs-comment">// display the field.</span>
            <span class="hljs-keyword">image</span> <span class="hljs-string">"../images/soccer_field.png"</span>;
            <span class="hljs-literal">species</span> player <span class="hljs-symbol">aspect:</span>base;
            <span class="hljs-literal">species</span> ball <span class="hljs-symbol">aspect:</span>base;
            <span class="hljs-literal">species</span> goal <span class="hljs-symbol">aspect:</span>base;
            <span class="hljs-literal">species</span> area <span class="hljs-symbol">aspect:</span>base;
            <span class="hljs-keyword">graphics</span> <span class="hljs-string">"score_display"</span> {
                <span class="hljs-keyword">draw</span> <span class="hljs-string">"Blue side - "</span>+<span class="hljs-literal">string</span>(blue_score) <span class="hljs-symbol">color:</span>#blue <span class="hljs-symbol">at:</span> {10,5} <span class="hljs-symbol">font:</span> font(<span class="hljs-string">"Helvetica"</span>, 18 * #zoom, #bold) <span class="hljs-symbol">perspective:</span>true;
                <span class="hljs-keyword">draw</span> <span class="hljs-literal">string</span>(red_score)+<span class="hljs-string">" - Red side"</span> <span class="hljs-symbol">color:</span>#red <span class="hljs-symbol">at:</span> {100,5} <span class="hljs-symbol">font:</span> font(<span class="hljs-string">"Helvetica"</span>, 18 * #zoom, #bold) <span class="hljs-symbol">perspective:</span>true;
                <span class="hljs-keyword">if</span> (show_status) {
                    <span class="hljs-keyword">draw</span> line([{red_offside_pos,0},{red_offside_pos,90}]) <span class="hljs-symbol">color:</span>#red;
                    <span class="hljs-keyword">draw</span> line([{blue_offside_pos,0},{blue_offside_pos,90}]) <span class="hljs-symbol">color:</span>#blue;
                }
            }
        }
        <span class="hljs-keyword">display</span> <span class="hljs-string">"match_stats"</span> {
            <span class="hljs-comment">// display some statistics about the game</span>
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"ball_possession"</span> <span class="hljs-symbol">type:</span>pie <span class="hljs-symbol">position:</span>{0,0} <span class="hljs-symbol">size:</span>{0.5,0.5} {
                <span class="hljs-keyword">data</span> <span class="hljs-string">"Red possession"</span> <span class="hljs-symbol">value:</span>red_possession <span class="hljs-symbol">color:</span>#red;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"Blue possession"</span> <span class="hljs-symbol">value:</span>blue_possession <span class="hljs-symbol">color:</span>#blue;
            }
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"red pass"</span> <span class="hljs-symbol">type:</span>pie <span class="hljs-symbol">position:</span>{0,0.5} <span class="hljs-symbol">size:</span>{0.5,0.5} {
                <span class="hljs-comment">// note that a pass is said "successful" if the player that has the ball was the player called initially. A "failed pass" does not necessary means that the team have lost the ball.</span>
                    <span class="hljs-keyword">data</span> <span class="hljs-string">"Red pass succeed"</span> <span class="hljs-symbol">value:</span>(nb_red_pass = 0) ? 0 : <span class="hljs-literal">float</span>(nb_red_pass_succeed)/<span class="hljs-literal">float</span>(nb_red_pass) <span class="hljs-symbol">color:</span>#red;
                    <span class="hljs-keyword">data</span> <span class="hljs-string">"Red pass failed"</span> <span class="hljs-symbol">value:</span>(nb_red_pass = 0) ? 0 : 1-<span class="hljs-literal">float</span>(nb_red_pass_succeed)/<span class="hljs-literal">float</span>(nb_red_pass) <span class="hljs-symbol">color:</span>#darkred;
            }
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"blue pass"</span> <span class="hljs-symbol">type:</span>pie <span class="hljs-symbol">position:</span>{0.5,0.5} <span class="hljs-symbol">size:</span>{0.5,0.5} {
                <span class="hljs-comment">// note that a pass is said "successful" if the player that has the ball was the player called initially. A "failed pass" does not necessary means that the team have lost the ball.</span>
                <span class="hljs-keyword">data</span> <span class="hljs-string">"Blue pass succeed"</span> <span class="hljs-symbol">value:</span>(nb_blue_pass = 0) ? 0 : <span class="hljs-literal">float</span>(nb_blue_pass_succeed)/<span class="hljs-literal">float</span>(nb_blue_pass) <span class="hljs-symbol">color:</span>#blue;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"Blue pass failed"</span> <span class="hljs-symbol">value:</span>(nb_blue_pass = 0) ? 0 : 1-<span class="hljs-literal">float</span>(nb_blue_pass_succeed)/<span class="hljs-literal">float</span>(nb_blue_pass) <span class="hljs-symbol">color:</span>#darkblue;
            }
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"number pass"</span> <span class="hljs-symbol">type:</span>series <span class="hljs-symbol">position:</span>{0.5,0} <span class="hljs-symbol">size:</span>{0.5,0.5} {
                <span class="hljs-keyword">data</span> <span class="hljs-string">"Number pass red"</span> <span class="hljs-symbol">value:</span>nb_red_pass <span class="hljs-symbol">color:</span>#red;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"Number pass blue"</span> <span class="hljs-symbol">value:</span>nb_blue_pass <span class="hljs-symbol">color:</span>#blue;
            }
        }
    }
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a></div><div><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div><h5>Ecosystem</h5><a href="https://github.com/gama-platform/gama"><i class="fab fa-github"></i> GitHub Gama</a><a href="https://github.com/gama-platform/gama.experimental"><i class="fas fa-puzzle-piece"></i> Gama Experimental Plugins</a><a href="https://github.com/gama-platform/gama.models.experimental"><i class="fas fa-scroll"></i> Gama Experimental Models</a></div></section><section class="copyright"><a href="https://github.com/gama-platform/gama/wiki/LICENSE.md">GFDL 3</a> - 2019 GAMA-Platform</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.fbAsyncInit = function() {FB.init({appId:'238065426321929',xfbml:true,version:'v2.7'});};(function(d, s, id){var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) {return;}js = d.createElement(s); js.id = id;js.src = '//connect.facebook.net/en_US/sdk.js';fjs.parentNode.insertBefore(js, fjs);}(document, 'script','facebook-jssdk'));
                </script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'undefined',
                indexName: 'undefined',
                inputSelector: '#search_input_react'
              });
            </script></body></html>