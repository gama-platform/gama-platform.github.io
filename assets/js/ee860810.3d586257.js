"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[42821],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=p(n),d=r,h=m["".concat(l,".").concat(d)]||m[d]||c[d]||s;return n?a.createElement(h,o(o({ref:t},u),{},{components:n})):a.createElement(h,o({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[m]="string"==typeof e?e:r,o[1]=i;for(var p=2;p<s;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},20580:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>p,toc:()=>m});var a=n(87462),r=n(63366),s=(n(67294),n(3905)),o=["components"],i={title:"Calling gama from another program"},l=void 0,p={unversionedId:"HeadlessTutorial",id:"HeadlessTutorial",title:"Calling gama from another program",description:"This tutorial presents an example for using Headless. The tutorial shows how to use Headless Legacy mode, Headless batch and Headless server.",source:"@site/../docs/HeadlessTutorial.md",sourceDirName:".",slug:"/HeadlessTutorial",permalink:"/wiki/next/HeadlessTutorial",draft:!1,editUrl:"https://github.com/gama-platform/gama/wiki/HeadlessTutorial/_edit",tags:[],version:"current",frontMatter:{title:"Calling gama from another program"},sidebar:"main",previous:{title:"Headless mode for dummies",permalink:"/wiki/next/Headless-mode-for-dummies"},next:{title:"Writing Unit Tests in GAML",permalink:"/wiki/next/Writing_Tests"}},u={},m=[{value:"1. Example using python with Headless legacy",id:"1-example-using-python-with-headless-legacy",level:2},{value:"2. Example on using python with Headless batch",id:"2-example-on-using-python-with-headless-batch",level:2},{value:"3. Example on using python with Headless server",id:"3-example-on-using-python-with-headless-server",level:2},{value:"Start the GAMA server",id:"start-the-gama-server",level:3},{value:"Use the Python wrapper instead",id:"use-the-python-wrapper-instead",level:3},{value:"Bare minimum code",id:"bare-minimum-code",level:3},{value:"It gets even better !",id:"it-gets-even-better-",level:3},{value:"Sample python script",id:"sample-python-script",level:4}],c={toc:m},d="wrapper";function h(e){var t=e.components,n=(0,r.Z)(e,o);return(0,s.kt)(d,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"This tutorial presents an example for using Headless. The tutorial shows how to use Headless Legacy mode, Headless batch and Headless server.\nAll the files related to this tutorial (images and models) are available in the Headless folder (headless/samples/predatorPrey)."),(0,s.kt)("h2",{id:"1-example-using-python-with-headless-legacy"},"1. Example using python with Headless legacy"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python"},'import os\n\nGAMA_folder_with_SDK = r"D:\\software\\GAMA_1.9.2_Windows_with_JDK\\headless"\n\nModel_file = GAMA_folder_with_SDK + r"\\samples\\predatorPrey\\predatorPrey.gaml"\n\nExperimentName = "prey_predator"\nXML_file = GAMA_folder_with_SDK + r"\\samples\\predatorPrey.xml"\nOutput_folder = GAMA_folder_with_SDK + r"\\samples\\predatorPrey"\n\nos.chdir(GAMA_folder_with_SDK)\nos.system("gama-headless.bat -xml " + ExperimentName + " " + Model_file + " " + XML_file)\nos.system("gama-headless.bat " + XML_file + " "+ Output_folder)\nprint("Results of the model is in the folder:" + Output_folder)\nprint("Snapshot is store in the folder:" + Output_folder + r"\\snapshot")\n')),(0,s.kt)("p",null,"The results of the experiment is stored in the set folder. In which the snapshot for every step is also saved in the snapshot folder.\n",(0,s.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/11825516/232184826-53d83320-6cc2-4025-b619-632eb10739d2.png",alt:"Snapshot folder of Headless legacy"})),(0,s.kt)("h2",{id:"2-example-on-using-python-with-headless-batch"},"2. Example on using python with Headless batch"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python"},'import os\nGAMA_folder_with_SDK = r"D:\\software\\GAMA_1.9.2_Windows_with_JDK\\headless"\n\nModel_file = GAMA_folder_with_SDK + r"\\samples\\predatorPrey\\predatorPrey.gaml"\n\nExperimentName = "Optimization"\n\nos.chdir(GAMA_folder_with_SDK)\nos.system("gama-headless.bat -batch " + ExperimentName + " " + Model_file)\n\nprint("The result is store in the file:" + GAMA_folder_with_SDK + r"\\samples\\predatorPrey\\results.csv")\n')),(0,s.kt)("h2",{id:"3-example-on-using-python-with-headless-server"},"3. Example on using python with Headless server"),(0,s.kt)("p",null,"The legacy version allows you to access the headless feature of GAMA by controling the model parameters and experiment plan from oustide GAMA model file . The headless batch, allows you to access the headless feature of GAMA with the model parameters and experiment plans defined inside the GAMA model file. The headless server, allows you to not only to access the headless feature but also to interact with the currently running GAMA experiment. You can load, play, pause, reload, stop and exit an experiment with very specific commands as described ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/gama-platform/gama/wiki/HeadlessServer#available-commands"},"here"),"."),(0,s.kt)("p",null,"The general sequence of operations is:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Start the server from a command line ",(0,s.kt)("inlineCode",{parentName:"li"},"gama-headless.sh -socket 6868")," , this opens the communication via port 6868 using websockets."),(0,s.kt)("li",{parentName:"ul"},"Connect to the server from another application/script that supports interacting with websockets. e.g., python. See below to use a python wrapper."),(0,s.kt)("li",{parentName:"ul"},"Start with the ",(0,s.kt)("inlineCode",{parentName:"li"},"load")," command to load an experiment and then use one of the specific commands as described ",(0,s.kt)("a",{parentName:"li",href:"https://github.com/gama-platform/gama/wiki/HeadlessServer#available-commands"},"here")," to construct a sequence of operations as required by your workflow. ")),(0,s.kt)("h3",{id:"start-the-gama-server"},"Start the GAMA server"),(0,s.kt)("p",null,"On your command line, execute the following commmand, you will find the gama-headless.sh in the headless folder inside your GAMA installation."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"gama-headless.sh -socket 6868\n")),(0,s.kt)("h3",{id:"use-the-python-wrapper-instead"},"Use the Python wrapper instead"),(0,s.kt)("p",null,"The GAMA developers have made available an elegant python wrapper that simplifies using GAMA server with python scripts and is available ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/gama-platform/Gama-client-python"},"here"),". However if you are not a serious programmer and just want to use this tool, the following bare minimum code shall get you started and you can slowly add one command after another to build your sequence of operations to interact with the GAMA server. Before you can start, you have to install the wrapper. In your python environment, install the ",(0,s.kt)("strong",{parentName:"p"},"gama-client")," package with the command:"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"pip install gama-client")),(0,s.kt)("p",null,"You can check that everything went well by opening a python console and try the following line:"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"from gama_client.base_client import GamaBaseClient")),(0,s.kt)("p",null,"If you don't see any error messages, then the python wrapper has been installed correctly. "),(0,s.kt)("h3",{id:"bare-minimum-code"},"Bare minimum code"),(0,s.kt)("p",null,"The whole interaction with the GAMA server is facilitated using the ",(0,s.kt)("inlineCode",{parentName:"p"},"asyncio")," library in Python and our wrapper that we installed in the previous step. The discussion on use of asyncio is beyond the scope of this tutorial, so just take it as granted. This whole interaction can be considered a dialouge (two way communication) between the client (you/ your script) and the server (GAMA server). You send a command to the server, and the server sends back a message. You parse this message and its contents and construct the next command to interact with the server. This back and forth continues untill you use the ",(0,s.kt)("inlineCode",{parentName:"p"},"exit")," command or if an error occurs on the server. "),(0,s.kt)("p",null,"Among all the messages sent by the server, as a beginner you should know about these four main messages: ",(0,s.kt)("inlineCode",{parentName:"p"},"ConnectionSuccessful")," (you connected to the server), ",(0,s.kt)("inlineCode",{parentName:"p"},"CommandExecutedSuccessfully")," (your command was well received and executed), ",(0,s.kt)("inlineCode",{parentName:"p"},"UnableToExecuteRequest")," (something is wrong with your model), ",(0,s.kt)("inlineCode",{parentName:"p"},"MalformedRequest")," (something is wrong with your command format) "),(0,s.kt)("p",null,"Just run the following python script and if all goes well, you are ready to use the GAMA server via python. "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python"},'\nimport asyncio\nfrom gama_client.base_client import GamaBaseClient\n\nasync def message_handler(message):\n    print("received message:", message)\n\n\nasync def main():\n    client = GamaBaseClient("localhost", 6868, message_handler)\n    await client.connect(False)\n\n    while True:\n        await asyncio.sleep(1)\n\nif __name__ == "__main__":\n    asyncio.run(main())\n')),(0,s.kt)("h3",{id:"it-gets-even-better-"},"It gets even better !"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"A word of caution"),"\nIt is recommended that you slowly build on to the above script by adding ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/gama-platform/gama/wiki/HeadlessServer#available-commands"},"commands")," step by step. You may use the script below as guidance to learn and to stay on course and not having to search a lot through the documentation. Blindly copy-pasting  the code and changing the parameters without understanding is not advised.  "),(0,s.kt)("p",null,"The python wrapper makes it even easier for beginners. So easy that you just have to change values of the following 5 variables in the sample python script below to make use of GAMA server."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'    MY_SERVER_URL = "localhost"\n    MY_SERVER_PORT = 6868\n    GAML_FILE_PATH_ON_SERVER = r"D:\\Gama\\headless\\samples\\predatorPrey\\predatorPrey.gaml"  \n    EXPERIMENT_NAME = "prey_predatorExp"\n    MY_EXP_INIT_PARAMETERS = [{"type": "int", "name": "nb_preys_init", "value": 100}]\n')),(0,s.kt)("h4",{id:"sample-python-script"},"Sample python script"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python"},'import asyncio\nfrom asyncio import Future\nfrom typing import Dict\n\nfrom gama_client.base_client import GamaBaseClient\nfrom gama_client.command_types import CommandTypes\nfrom gama_client.message_types import MessageTypes\n\nexperiment_future: Future\nplay_future: Future\npause_future: Future\nexpression_future: Future\nstep_future: Future\nstop_future: Future\n\n\nasync def message_handler(message: Dict):\n    print("received", message)\n    if "command" in message:\n        if message["command"]["type"] == CommandTypes.Load.value:\n            experiment_future.set_result(message)\n        elif message["command"]["type"] == CommandTypes.Play.value:\n            play_future.set_result(message)\n        elif message["command"]["type"] == CommandTypes.Pause.value:\n            pause_future.set_result(message)\n        elif message["command"]["type"] == CommandTypes.Expression.value:\n            expression_future.set_result(message)\n        elif message["command"]["type"] == CommandTypes.Step.value:\n            step_future.set_result(message)\n        elif message["command"]["type"] == CommandTypes.Stop.value:\n            stop_future.set_result(message)\n\n\nasync def main():\n\n    global experiment_future\n    global play_future\n    global pause_future\n    global expression_future\n    global step_future\n    global stop_future\n\n    # Experiment and Gama-server constants\n    MY_SERVER_URL = "localhost"\n    MY_SERVER_PORT = 6868\n    GAML_FILE_PATH_ON_SERVER = r"D:\\Gama\\headless\\samples\\predatorPrey\\predatorPrey.gaml"\n    EXPERIMENT_NAME = "prey_predatorExp"\n    MY_EXP_INIT_PARAMETERS = [{"type": "int", "name": "nb_preys_init", "value": 100}]\n\n    client = GamaBaseClient(MY_SERVER_URL, MY_SERVER_PORT, message_handler)\n\n    print("connecting to Gama server")\n    await client.connect()\n\n    print("initialize a gaml model")\n    experiment_future = asyncio.get_running_loop().create_future()\n    await client.load(GAML_FILE_PATH_ON_SERVER, EXPERIMENT_NAME, True, True, True, MY_EXP_INIT_PARAMETERS)\n    gama_response = await experiment_future\n\n    try:\n        experiment_id = gama_response["content"]\n    except Exception as e:\n        print("error while initializing", gama_response, e)\n        return\n\n    print("initialization successful, running the model")\n    play_future = asyncio.get_running_loop().create_future()\n    await client.play(experiment_id)\n    gama_response = await play_future\n    if gama_response["type"] != MessageTypes.CommandExecutedSuccessfully.value:\n        print("error while trying to run the experiment", gama_response)\n        return\n\n    print("model running, waiting a bit")\n    await asyncio.sleep(2)\n\n    print("pausing the model")\n    pause_future = asyncio.get_running_loop().create_future()\n    await client.pause(experiment_id)\n    gama_response = await pause_future\n    if gama_response["type"] != MessageTypes.CommandExecutedSuccessfully.value:\n        print("Unable to pause the experiment", gama_response)\n        return\n\n    expression_future = asyncio.get_running_loop().create_future()\n    await client.expression(experiment_id, r"cycle")\n    gama_response = await expression_future\n    print("asking simulation the value of: cycle=", gama_response["content"])\n\n    expression_future = asyncio.get_running_loop().create_future()\n    await client.expression(experiment_id, r"nb_preys/nb_preys_init")\n    gama_response = await expression_future\n    print("asking simulation the value of: nb_preys/nb_preys_init=",  gama_response["content"])\n\n    print("asking gama to run 10 more steps of the experiment")\n    step_future = asyncio.get_running_loop().create_future()\n    await client.step(experiment_id, 10, True)\n    gama_response = await step_future\n    if gama_response["type"] != MessageTypes.CommandExecutedSuccessfully.value:\n        print("Unable to execute 10 new steps in the experiment", gama_response)\n        return\n\n    expression_future = asyncio.get_running_loop().create_future()\n    await client.expression(experiment_id, r"cycle")\n    gama_response = await expression_future\n    print("asking simulation the value of: cycle=", gama_response["content"])\n\n    print("killing the simulation")\n    stop_future = asyncio.get_running_loop().create_future()\n    await client.stop(experiment_id)\n    gama_response = await stop_future\n    if gama_response["type"] != MessageTypes.CommandExecutedSuccessfully.value:\n        print("Unable to stop the experiment", gama_response)\n        return\n\n\nif __name__ == "__main__":\n    asyncio.run(main())\n')))}h.isMDXComponent=!0}}]);