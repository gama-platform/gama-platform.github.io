"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[15731],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},h="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),h=s(n),c=i,u=h["".concat(p,".").concat(c)]||h[c]||m[c]||r;return n?a.createElement(u,o(o({ref:t},d),{},{components:n})):a.createElement(u,o({ref:t},d))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=c;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[h]="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},49694:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>p,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>h});var a=n(87462),i=n(63366),r=(n(67294),n(3905)),o=["components"],l={title:"5. Visualizing in 3D"},p=void 0,s={unversionedId:"IncrementalModel_step5",id:"version-1.9.2/IncrementalModel_step5",title:"5. Visualizing in 3D",description:"This step Illustrates how to define a 3D display.",source:"@site/versioned_docs/version-1.9.2/IncrementalModel_step5.md",sourceDirName:".",slug:"/IncrementalModel_step5",permalink:"/wiki/IncrementalModel_step5",draft:!1,editUrl:"https://github.com/gama-platform/gama/wiki/IncrementalModel_step5/_edit",tags:[],version:"1.9.2",frontMatter:{title:"5. Visualizing in 3D"},sidebar:"tuto",previous:{title:"4. Movement on Graph",permalink:"/wiki/IncrementalModel_step4"},next:{title:"6. Multi-Level",permalink:"/wiki/IncrementalModel_step6"}},d={},h=[{value:"Formulation",id:"formulation",level:2},{value:"Model Definition",id:"model-definition",level:2},{value:"building",id:"building",level:3},{value:"road",id:"road",level:3},{value:"global variable",id:"global-variable",level:3},{value:"people",id:"people",level:3},{value:"display",id:"display",level:3},{value:"Complete Model",id:"complete-model",level:2}],m={toc:h},c="wrapper";function u(e){var t=e.components,l=(0,i.Z)(e,o);return(0,r.kt)(c,(0,a.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This step Illustrates how to define a 3D display."),(0,r.kt)("h2",{id:"formulation"},"Formulation"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add a variable (height: int from 10m to 20m) and modify the aspect of buildings to display them in 3D."),(0,r.kt)("li",{parentName:"ul"},"Add a variable (display","_","shape: geometry; shape with a buffer of 2m) and modify the aspect of the roads to display them with this new shape."),(0,r.kt)("li",{parentName:"ul"},"Add a new global variable that indicate if it is night or not (bool: night before 7h and after 20h)."),(0,r.kt)("li",{parentName:"ul"},"Define a new aspect (sphere3D) for people to display them as sphere."),(0,r.kt)("li",{parentName:"ul"},"Modify the display to use this new aspect.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Incremental model 5: add a 3D display to the model.",src:n(30748).Z,width:"1612",height:"831"})),(0,r.kt)("h2",{id:"model-definition"},"Model Definition"),(0,r.kt)("h3",{id:"building"},"building"),(0,r.kt)("p",null,"First, we add a new variable for buildings (",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"height")),") of type float from 10m to 20m. Then we modify the aspect in order to specify a depth for the geometry (using the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"depth"))," facet)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"species building {\n    float height <- rnd(10#m, 20#m) ;\n    aspect default {\n    draw shape color: #gray border: #black depth: height;\n    }\n}\n")),(0,r.kt)("h3",{id:"road"},"road"),(0,r.kt)("p",null,"Concerning the road,  we add a new variable (",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"display_shape")),') of type geometry that corresponds to the shape of the road with a buffer of 2 meters. Then we modify the aspect in order to display this geometry instead of the shape of the agent. In order to avoid "z-fighting" problems, we add depth to the geometry (of 3 meters).'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"species road {\n    geometry display_shape <- shape + 2.0;\n    aspect default {\n    draw display_shape color: #black depth: 3.0;\n    }\n}\n")),(0,r.kt)("h3",{id:"global-variable"},"global variable"),(0,r.kt)("p",null,"We define a new global variable called ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"is_night"))," of type ",(0,r.kt)("inlineCode",{parentName:"p"},"bool")," to indicate if it is night or not. This variable will be updated at each simulation step and will be ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," if the current hour is lower than 7h or higher than 20h. It will be used in the display to change the light of the scene (to set it darker in the night)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"global{\n    ...\n    bool is_night <- true update: current_date.hour < 7 or current_date.hour > 20;\n    ...\n}\n")),(0,r.kt)("h3",{id:"people"},"people"),(0,r.kt)("p",null,"We define a new aspect for the people agent called ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"sphere3D")),". This aspect draws people agent as a 3m sphere. In order to avoid to cut the sphere in half, we translate the centroid of the drawn sphere to 3m along the z-axis."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"species people skills:[moving]{     \n    ...\n    aspect sphere3D{\n    draw sphere(3) at: {location.x,location.y,location.z + 3} color:is_infected ? #red : #green;\n    }\n}\n")),(0,r.kt)("h3",{id:"display"},"display"),(0,r.kt)("p",null,"The element that we have to modify is the display. We change its name to ",(0,r.kt)("strong",{parentName:"p"},"map","_","3D")," to better reflect its visual aspect."),(0,r.kt)("p",null,"In order to get a 3D aspect, we specify that this display will be an OpenGL one. For that, we just have to add the facet ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"type: opengl")),". In addition,\nwe first add an ambient light with a ",(0,r.kt)("inlineCode",{parentName:"p"},"light")," statement inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"display")," with the id ",(0,r.kt)("inlineCode",{parentName:"p"},"#ambient")," and an ",(0,r.kt)("inlineCode",{parentName:"p"},"intensity")," set to 20. To get a different light between night and day, we add one more ",(0,r.kt)("inlineCode",{parentName:"p"},"light")," statement with the ",(0,r.kt)("inlineCode",{parentName:"p"},"#default")," id and to have a nice effect night/day, we will set the intensity of the light to 50 during the night, and 127 for the day. To learn more about light, please read this ",(0,r.kt)("a",{parentName:"p",href:"ManipulateLight"},"page"),"."),(0,r.kt)("p",null,"Then, we add a new layer that consists of an image (soil.jpg) by using the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"image"))," statement."),(0,r.kt)("p",null,"In order to see the people inside the building, we add transparency to the building (0.5). The transparency of a layer is a float value between 0 (solid) and 1 (totally transparent). In order to be able to manage this transparency aspect, OpenGL has to draw the people agents before the building, thus we modify the order of drawing of the different layers (people agents before building agents). At last, we modify the displayed aspect of the people agents by the new one: ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"sphere3D")),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'experiment main_experiment type:gui{\n    ...\n    output {\n    ...\n    display map_3D type: opengl {\n        light #ambient intensity: 20;\n        light #default intensity:(is_night ? 0 : 127);\n        image "../includes/soil.jpg";\n        species road ;\n        species people aspect:sphere3D;         \n        species building  transparency: 0.5;\n    }\n    ...\n    }\n}\n')),(0,r.kt)("h2",{id:"complete-model"},"Complete Model"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-gaml",metastring:"reference",reference:!0},"https://github.com/gama-platform/gama/blob/GAMA_1.9.2/msi.gama.models/models/Tutorials/Incremental%20Model/models/Incremental%20Model%205.gaml\n")))}u.isMDXComponent=!0},30748:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Incremental_model5-640acca56cb1eefdfe1fa0a6980f3f44.jpg"}}]);