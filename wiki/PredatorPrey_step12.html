<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>12. Image loading · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;This 12th step illustrates how to load an image file and to use it to initialize a grid.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="12. Image loading · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gama-platform.github.io/"/><meta property="og:description" content="&lt;p&gt;This 12th step illustrates how to load an image file and to use it to initialize a grid.&lt;/p&gt;
"/><meta property="og:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/searchEngine.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/gama-logo_white.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/wiki/Home" target="_self">Documentation</a></li><li class="siteNavGroupActive"><a href="/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Predator Prey</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Tutorials<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/Tutorials">Tutorials</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Predator Prey<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey">Predator Prey</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step1">1. Basic Model</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step2">2. Vegetation Dynamic</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step3">3. Prey Agent Behavior</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step4">4. Inspectors and Monitors</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step5">5. Predator Agent</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step6">6. Breeding</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step7">7. Agent Aspect</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step8">8. Complex Behavior</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step9">9. Stopping condition</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step10">10. Charts</a></li><li class="navListItem"><a class="navItem" href="/wiki/PredatorPrey_step11">11. Writing Files</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/wiki/PredatorPrey_step12">12. Image loading</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Road Traffic<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel">Road Traffic</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step1">1. Loading of GIS Data</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step2">2. People Agents</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step3">3. Movement of People</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step4">4. Weight for Road Network</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step5">5. Dynamic weights</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step6">6. Charts</a></li><li class="navListItem"><a class="navItem" href="/wiki/RoadTrafficModel_step7">7. Automatic Road Repair</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">3D Tutorial<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/ThreeD">3D Tutorial</a></li><li class="navListItem"><a class="navItem" href="/wiki/ThreeD_step1">1. Basic Model</a></li><li class="navListItem"><a class="navItem" href="/wiki/ThreeD_step2">2. Moving Cells</a></li><li class="navListItem"><a class="navItem" href="/wiki/ThreeD_step3">3. Connections</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Incremental Model<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel">Incremental Model</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step1">1. Simple SI Model</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step2">2. Charts</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step3">3. Integration of GIS Data</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step4">4. Movement on Graph</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step5">5. Visualizing in 3D</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step6">6. Multi-Level</a></li><li class="navListItem"><a class="navItem" href="/wiki/IncrementalModel_step7">7. Differential Equations</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Luneray&#x27;s flu<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu">Luneray&#x27;s flu</a></li><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu_step1">1. Creation of a first basic disease spreading model</a></li><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu_step2">2. Definition of monitors and chart outputs</a></li><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu_step3">3. Importation of GIS data</a></li><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu_step4">4. Use of a graph to constraint the movements of people</a></li><li class="navListItem"><a class="navItem" href="/wiki/LuneraysFlu_step5">5. Definition of 3D displays</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Co-modeling<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/CoModelingTutorial">Co-modeling tutorial</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">BDI Agents<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents">BDI Agents</a></li><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents_step1">1. Skeleton model</a></li><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents_step2">2. BDI Agents</a></li><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents_step3">3. Social relation</a></li><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents_step4">4. Emotions and Personality</a></li><li class="navListItem"><a class="navItem" href="/wiki/BDIAgents_step5">5. Norms, obligation and enforcement</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">12. Image loading</h1></header><article><div><span><p>This 12th step illustrates how to load an image file and to use it to initialize a grid.</p>
<h2><a class="anchor" aria-hidden="true" id="formulation"></a><a href="#formulation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Formulation</h2>
<ul>
<li>Building of the initial environment (food and foodProd of the cells) from a image file</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="model-definition"></a><a href="#model-definition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Model Definition</h2>
<h3><a class="anchor" aria-hidden="true" id="global-variable"></a><a href="#global-variable" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>global variable</h3>
<p>We add a new global variable: the image file:</p>
<pre><code class="hljs">    <span class="hljs-literal">file</span> map_init &lt;- image_file(<span class="hljs-string">"../images/predator_prey_raster_map.png"</span>);
</code></pre>
<p>The image file is here: <img src="../resources/images/tutorials/predator_prey_raster_map.png" alt="images/predator_prey_raster_map.png"></p>
<p>You have to copy it in your project folder: images/</p>
<h3><a class="anchor" aria-hidden="true" id="model-initialization"></a><a href="#model-initialization" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>model initialization</h3>
<p>In order to have a more complex environment, we want to use this image as the initialization of the environment. The food level available in a vegetation_cell will be based on the green level of the corresponding pixel in the image. You will be able to use such process to represent existing real environment in your model.
We modify the global init of the model in order to cast the image file in a matrix. We use for that the <strong>file as_matrix  {nb_cols, nb_lines}</strong> operator that allows to convert a file (image, csv) to a matrix composed of <strong>nb_cols</strong> columns and <strong>nb_lines</strong> lines.</p>
<p>Concerning the manipulation of matrix, it is possible to obtain the element [i,j] of a matrix by using <strong>my_matrix [i,j]</strong>.</p>
<p>A  grid can be view as spatial matrix: each cell of a grid has two built-in variables <strong>grid_x</strong> and <strong>grid_y</strong> that represent the column and line indexes of the cell.</p>
<pre><code class="hljs">  init {
      <span class="hljs-keyword">create</span> prey <span class="hljs-symbol">number:</span> nb_preys_init ;
      <span class="hljs-keyword">create</span> predator <span class="hljs-symbol">number:</span> nb_predators_init ;
      <span class="hljs-literal">matrix</span> init_data &lt;- map_init as_matrix {50,50};
      <span class="hljs-keyword">ask</span> vegetation_cell {
         color &lt;- <span class="hljs-literal">rgb</span> (init_data[grid_x,grid_y]) ;
         food &lt;- 1 - ((color as <span class="hljs-literal">list</span>)[0] / 255) ;
         foodProd &lt;- food / 100 ;
      }
   }
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="conclusion"></a><a href="#conclusion" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>Congratulations, you have complete your first GAMA models! Now, you have enough knowledge to create many models that includes: dynamic grid-based environment, moving and interacting agents and the needed visualization to make good use of your simulation. Feel free to use this knowledge to create your very own models! Or perhaps you want to continue your study with the more advanced <a href="Tutorials">tutorials</a>?</p>
<h2><a class="anchor" aria-hidden="true" id="complete-model"></a><a href="#complete-model" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Complete Model</h2>
<pre><code class="hljs"><span class="hljs-builtin">model</span> prey_predator

global {
    <span class="hljs-literal">int</span> nb_preys_init &lt;- 200;
    <span class="hljs-literal">int</span> nb_predators_init &lt;- 20;
    <span class="hljs-literal">float</span> prey_max_energy &lt;- 1.0;
    <span class="hljs-literal">float</span> prey_max_transfert &lt;- 0.1 ;
    <span class="hljs-literal">float</span> prey_energy_consum &lt;- 0.05;
    <span class="hljs-literal">float</span> predator_max_energy &lt;- 1.0;
    <span class="hljs-literal">float</span> predator_energy_transfert &lt;- 0.5;
    <span class="hljs-literal">float</span> predator_energy_consum &lt;- 0.02;
    <span class="hljs-literal">float</span> prey_proba_reproduce &lt;- 0.01;
    <span class="hljs-literal">int</span> prey_nb_max_offsprings &lt;- 5; 
    <span class="hljs-literal">float</span> prey_energy_reproduce &lt;- 0.5; 
    <span class="hljs-literal">float</span> predator_proba_reproduce &lt;- 0.01;
    <span class="hljs-literal">int</span> predator_nb_max_offsprings &lt;- 3;
    <span class="hljs-literal">float</span> predator_energy_reproduce &lt;- 0.5;
    <span class="hljs-literal">file</span> map_init &lt;- image_file(<span class="hljs-string">"../images/predator_prey_raster_map.png"</span>);
    
    <span class="hljs-literal">int</span> nb_preys -&gt; {length (prey)};
    <span class="hljs-literal">int</span> nb_predators -&gt; {length (predator)};
    
    init {
        <span class="hljs-keyword">create</span> prey <span class="hljs-symbol">number:</span> nb_preys_init ; 
        <span class="hljs-keyword">create</span> predator <span class="hljs-symbol">number:</span> nb_predators_init ;
        <span class="hljs-keyword">ask</span> vegetation_cell {
            color &lt;- <span class="hljs-literal">rgb</span> (map_init at {grid_x,grid_y}) ;
            food &lt;- 1 - (((color as <span class="hljs-literal">list</span>)[0]) / 255) ;
            foodProd &lt;- food / 100 ; 
        }
    }
    
    <span class="hljs-builtin">reflex</span> save_result <span class="hljs-symbol">when:</span> (nb_preys &gt; 0) and (nb_predators &gt; 0){
        <span class="hljs-keyword">save</span> (<span class="hljs-string">"cycle: "</span>+ cycle + <span class="hljs-string">"; nbPreys: "</span> + nb_preys
            + <span class="hljs-string">"; minEnergyPreys: "</span> + ((prey as <span class="hljs-literal">list</span>) min_of each.energy)
            + <span class="hljs-string">"; maxSizePreys: "</span> + ((prey as <span class="hljs-literal">list</span>) max_of each.energy) 
            + <span class="hljs-string">"; nbPredators: "</span> + nb_predators           
            + <span class="hljs-string">"; minEnergyPredators: "</span> + ((predator as <span class="hljs-literal">list</span>) min_of each.energy)          
            + <span class="hljs-string">"; maxSizePredators: "</span> + ((predator as <span class="hljs-literal">list</span>) max_of each.energy)) 
            <span class="hljs-symbol">to:</span> <span class="hljs-string">"results.txt"</span> <span class="hljs-symbol">type:</span> <span class="hljs-string">"text"</span> ;
    }
    
    <span class="hljs-builtin">reflex</span> stop_simulation <span class="hljs-symbol">when:</span> (nb_preys = 0) or (nb_predators = 0) {
        <span class="hljs-keyword">do</span> halt ;
    } 
}

<span class="hljs-literal">species</span> generic_species {
    <span class="hljs-literal">float</span> size &lt;- 1.0;
    <span class="hljs-literal">rgb</span> color  ;
    <span class="hljs-literal">float</span> max_energy;
    <span class="hljs-literal">float</span> max_transfert;
    <span class="hljs-literal">float</span> energy_consum;
    <span class="hljs-literal">float</span> proba_reproduce ;
    <span class="hljs-literal">float</span> nb_max_offsprings;
    <span class="hljs-literal">float</span> energy_reproduce;
    image_file my_icon;
    vegetation_cell myCell &lt;- one_of (vegetation_cell) ;
    <span class="hljs-literal">float</span> energy &lt;- (rnd(1000) / 1000) * max_energy  <span class="hljs-symbol">update:</span> energy - energy_consum <span class="hljs-symbol">max:</span> max_energy ;
    
    init {
        location &lt;- myCell.location;
    }
        
    <span class="hljs-builtin">reflex</span> basic_move {
        myCell &lt;- choose_cell();
        location &lt;- myCell.location; 
    } 
    
    vegetation_cell choose_cell {
        <span class="hljs-keyword">return</span> nil;
    }
        
    <span class="hljs-builtin">reflex</span> die <span class="hljs-symbol">when:</span> energy &lt;= 0 {
        <span class="hljs-keyword">do</span> die ;
    }
    
    <span class="hljs-builtin">reflex</span> reproduce <span class="hljs-symbol">when:</span> (energy &gt;= energy_reproduce) and (flip(proba_reproduce)) {
        <span class="hljs-literal">int</span> nb_offsprings &lt;- 1 + rnd(nb_max_offsprings -1);
        <span class="hljs-keyword">create</span> <span class="hljs-literal">species</span>(self) <span class="hljs-symbol">number:</span> nb_offsprings {
            myCell &lt;- myself.myCell ;
            location &lt;- myCell.location ;
            energy &lt;- myself.energy / nb_offsprings ;
        }
        energy &lt;- energy / nb_offsprings ;
    }
    
    <span class="hljs-keyword">aspect</span> base {
        <span class="hljs-keyword">draw</span> circle(size) <span class="hljs-symbol">color:</span> color ;
    }
    <span class="hljs-keyword">aspect</span> icon {
        <span class="hljs-keyword">draw</span> my_icon <span class="hljs-symbol">size:</span> 2 * size ;
    }
    <span class="hljs-keyword">aspect</span> info {
        <span class="hljs-keyword">draw</span> square(size) <span class="hljs-symbol">color:</span> color ;
        <span class="hljs-keyword">draw</span> <span class="hljs-literal">string</span>(energy with_precision 2) <span class="hljs-symbol">size:</span> 3 <span class="hljs-symbol">color:</span> #black ;
    }
}

<span class="hljs-literal">species</span> prey <span class="hljs-symbol">parent:</span> generic_species {
    <span class="hljs-literal">rgb</span> color &lt;- #blue;
    <span class="hljs-literal">float</span> max_energy &lt;- prey_max_energy ;
    <span class="hljs-literal">float</span> max_transfert &lt;- prey_max_transfert ;
    <span class="hljs-literal">float</span> energy_consum &lt;- prey_energy_consum ;
    <span class="hljs-literal">float</span> proba_reproduce &lt;- prey_proba_reproduce ;
    <span class="hljs-literal">int</span> nb_max_offsprings &lt;- prey_nb_max_offsprings ;
    <span class="hljs-literal">float</span> energy_reproduce &lt;- prey_energy_reproduce ;
    <span class="hljs-literal">file</span> my_icon &lt;- <span class="hljs-literal">file</span>(<span class="hljs-string">"../images/predator_prey_sheep.png"</span>) ;
        
    <span class="hljs-builtin">reflex</span> eat <span class="hljs-symbol">when:</span> myCell.food &gt; 0 {
        <span class="hljs-literal">float</span> energy_transfert &lt;- min([max_transfert, myCell.food]) ;
        myCell.food &lt;- myCell.food - energy_transfert ;
        energy &lt;- energy + energy_transfert ;
    }
    
    vegetation_cell choose_cell {
        <span class="hljs-keyword">return</span> (myCell.neighbors) with_max_of (each.food);
    }
}
    
<span class="hljs-literal">species</span> predator <span class="hljs-symbol">parent:</span> generic_species {
    <span class="hljs-literal">rgb</span> color &lt;- #red ;
    <span class="hljs-literal">float</span> max_energy &lt;- predator_max_energy ;
    <span class="hljs-literal">float</span> energy_transfert &lt;- predator_energy_transfert ;
    <span class="hljs-literal">float</span> energy_consum &lt;- predator_energy_consum ;
    <span class="hljs-literal">list</span>&lt;prey&gt; reachable_preys <span class="hljs-symbol">update:</span> prey inside (myCell);
    <span class="hljs-literal">float</span> proba_reproduce &lt;- predator_proba_reproduce ;
    <span class="hljs-literal">int</span> nb_max_offsprings &lt;- predator_nb_max_offsprings ;
    <span class="hljs-literal">float</span> energy_reproduce &lt;- predator_energy_reproduce ;
    <span class="hljs-literal">file</span> my_icon &lt;- <span class="hljs-literal">file</span>(<span class="hljs-string">"../images/predator_prey_wolf.png"</span>) ;
    
    <span class="hljs-builtin">reflex</span> eat <span class="hljs-symbol">when:</span> ! empty(reachable_preys) {
        <span class="hljs-keyword">ask</span> one_of (reachable_preys) {
            <span class="hljs-keyword">do</span> die ;
        }
        energy &lt;- energy + energy_transfert ;
    }
    
    vegetation_cell choose_cell {
        vegetation_cell myCell_tmp &lt;- shuffle(myCell.neighbors) first_with (!(empty (prey inside (each))));
        <span class="hljs-keyword">if</span> myCell_tmp != nil {
            <span class="hljs-keyword">return</span> myCell_tmp;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> one_of (myCell.neighbors);
        } 
    }
}
    
grid vegetation_cell <span class="hljs-symbol">width:</span> 50 <span class="hljs-symbol">height:</span> 50 <span class="hljs-symbol">neighbors:</span> 4 {
    <span class="hljs-literal">float</span> maxFood &lt;- 1.0 ;
    <span class="hljs-literal">float</span> foodProd &lt;- (rnd(1000) / 1000) * 0.01 ;
    <span class="hljs-literal">float</span> food &lt;- (rnd(1000) / 1000) <span class="hljs-symbol">max:</span> maxFood <span class="hljs-symbol">update:</span> food + foodProd ;
    <span class="hljs-literal">rgb</span> color &lt;- <span class="hljs-literal">rgb</span>(<span class="hljs-literal">int</span>(255 * (1 - food)), 255, <span class="hljs-literal">int</span>(255 * (1 - food))) <span class="hljs-symbol">update:</span> <span class="hljs-literal">rgb</span>(<span class="hljs-literal">int</span>(255 * (1 - food)), 255, <span class="hljs-literal">int</span>(255 *(1 - food))) ;
    <span class="hljs-literal">list</span>&lt;vegetation_cell&gt; neighbors  &lt;- (self neighbors_at 2); 
}

<span class="hljs-builtin">experiment</span> prey_predator <span class="hljs-symbol">type:</span> gui {
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Initial number of preys: "</span> <span class="hljs-symbol">var:</span> nb_preys_init  <span class="hljs-symbol">min:</span> 0 <span class="hljs-symbol">max:</span> 1000 <span class="hljs-symbol">category:</span> <span class="hljs-string">"Prey"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Prey max energy: "</span> <span class="hljs-symbol">var:</span> prey_max_energy <span class="hljs-symbol">category:</span> <span class="hljs-string">"Prey"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Prey max transfert: "</span> <span class="hljs-symbol">var:</span> prey_max_transfert  <span class="hljs-symbol">category:</span> <span class="hljs-string">"Prey"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Prey energy consumption: "</span> <span class="hljs-symbol">var:</span> prey_energy_consum  <span class="hljs-symbol">category:</span> <span class="hljs-string">"Prey"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Initial number of predators: "</span> <span class="hljs-symbol">var:</span> nb_predators_init  <span class="hljs-symbol">min:</span> 0 <span class="hljs-symbol">max:</span> 200 <span class="hljs-symbol">category:</span> <span class="hljs-string">"Predator"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Predator max energy: "</span> <span class="hljs-symbol">var:</span> predator_max_energy <span class="hljs-symbol">category:</span> <span class="hljs-string">"Predator"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Predator energy transfert: "</span> <span class="hljs-symbol">var:</span> predator_energy_transfert  <span class="hljs-symbol">category:</span> <span class="hljs-string">"Predator"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Predator energy consumption: "</span> <span class="hljs-symbol">var:</span> predator_energy_consum  <span class="hljs-symbol">category:</span> <span class="hljs-string">"Predator"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Prey probability reproduce: '</span> <span class="hljs-symbol">var:</span> prey_proba_reproduce <span class="hljs-symbol">category:</span> <span class="hljs-string">'Prey'</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Prey nb max offsprings: '</span> <span class="hljs-symbol">var:</span> prey_nb_max_offsprings <span class="hljs-symbol">category:</span> <span class="hljs-string">'Prey'</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Prey energy reproduce: '</span> <span class="hljs-symbol">var:</span> prey_energy_reproduce <span class="hljs-symbol">category:</span> <span class="hljs-string">'Prey'</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Predator probability reproduce: '</span> <span class="hljs-symbol">var:</span> predator_proba_reproduce <span class="hljs-symbol">category:</span> <span class="hljs-string">'Predator'</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Predator nb max offsprings: '</span> <span class="hljs-symbol">var:</span> predator_nb_max_offsprings <span class="hljs-symbol">category:</span> <span class="hljs-string">'Predator'</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Predator energy reproduce: '</span> <span class="hljs-symbol">var:</span> predator_energy_reproduce <span class="hljs-symbol">category:</span> <span class="hljs-string">'Predator'</span> ;
    
    <span class="hljs-keyword">output</span> {
        <span class="hljs-keyword">display</span> main_display {
            grid vegetation_cell <span class="hljs-symbol">lines:</span> #black ;
            <span class="hljs-literal">species</span> prey <span class="hljs-symbol">aspect:</span> icon ;
            <span class="hljs-literal">species</span> predator <span class="hljs-symbol">aspect:</span> icon ;
        }
        <span class="hljs-keyword">display</span> info_display {
            grid vegetation_cell <span class="hljs-symbol">lines:</span> #black ;
            <span class="hljs-literal">species</span> prey <span class="hljs-symbol">aspect:</span> info ;
            <span class="hljs-literal">species</span> predator <span class="hljs-symbol">aspect:</span> info ;
        }
        <span class="hljs-keyword">display</span> Population_information <span class="hljs-symbol">refresh:</span>every(5#cycles) {
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"Species evolution"</span> <span class="hljs-symbol">type:</span> series <span class="hljs-symbol">size:</span> {1,0.5} <span class="hljs-symbol">position:</span> {0, 0} {
                <span class="hljs-keyword">data</span> <span class="hljs-string">"number_of_preys"</span> <span class="hljs-symbol">value:</span> nb_preys <span class="hljs-symbol">color:</span> #blue ;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"number_of_predator"</span> <span class="hljs-symbol">value:</span> nb_predators <span class="hljs-symbol">color:</span> #red ;
            }
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"Prey Energy Distribution"</span> <span class="hljs-symbol">type:</span> histogram <span class="hljs-symbol">background:</span> <span class="hljs-literal">rgb</span>(<span class="hljs-string">"lightGray"</span>) <span class="hljs-symbol">size:</span> {0.5,0.5} <span class="hljs-symbol">position:</span> {0, 0.5} {
                <span class="hljs-keyword">data</span> <span class="hljs-string">"]0;0.25]"</span> <span class="hljs-symbol">value:</span> prey count (each.energy &lt;= 0.25) <span class="hljs-symbol">color:</span>#blue;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"]0.25;0.5]"</span> <span class="hljs-symbol">value:</span> prey count ((each.energy &gt; 0.25) and (each.energy &lt;= 0.5)) <span class="hljs-symbol">color:</span>#blue;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"]0.5;0.75]"</span> <span class="hljs-symbol">value:</span> prey count ((each.energy &gt; 0.5) and (each.energy &lt;= 0.75)) <span class="hljs-symbol">color:</span>#blue;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"]0.75;1]"</span> <span class="hljs-symbol">value:</span> prey count (each.energy &gt; 0.75) <span class="hljs-symbol">color:</span>#blue;
            }
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"Predator Energy Distribution"</span> <span class="hljs-symbol">type:</span> histogram <span class="hljs-symbol">background:</span> <span class="hljs-literal">rgb</span>(<span class="hljs-string">"lightGray"</span>) <span class="hljs-symbol">size:</span> {0.5,0.5} <span class="hljs-symbol">position:</span> {0.5, 0.5} {
                <span class="hljs-keyword">data</span> <span class="hljs-string">"]0;0.25]"</span> <span class="hljs-symbol">value:</span> predator count (each.energy &lt;= 0.25) <span class="hljs-symbol">color:</span> #red ;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"]0.25;0.5]"</span> <span class="hljs-symbol">value:</span> predator count ((each.energy &gt; 0.25) and (each.energy &lt;= 0.5)) <span class="hljs-symbol">color:</span> #red ;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"]0.5;0.75]"</span> <span class="hljs-symbol">value:</span> predator count ((each.energy &gt; 0.5) and (each.energy &lt;= 0.75)) <span class="hljs-symbol">color:</span> #red ;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"]0.75;1]"</span> <span class="hljs-symbol">value:</span> predator count (each.energy &gt; 0.75) <span class="hljs-symbol">color:</span> #red;
            }
        }
        <span class="hljs-keyword">monitor</span> <span class="hljs-string">"Number of preys"</span> <span class="hljs-symbol">value:</span> nb_preys;
        <span class="hljs-keyword">monitor</span> <span class="hljs-string">"Number of predators"</span> <span class="hljs-symbol">value:</span> nb_predators;
    }
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/wiki/PredatorPrey_step11"><span class="arrow-prev">← </span><span>11. Writing Files</span></a><a class="docs-next button" href="/wiki/RoadTrafficModel"><span>Road Traffic</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#formulation">Formulation</a></li><li><a href="#model-definition">Model Definition</a><ul class="toc-headings"><li><a href="#global-variable">global variable</a></li><li><a href="#model-initialization">model initialization</a></li></ul></li><li><a href="#conclusion">Conclusion</a></li><li><a href="#complete-model">Complete Model</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a></div><div><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div><h5>Ecosystem</h5><a href="https://github.com/gama-platform/gama"><i class="fab fa-github"></i> GitHub Gama</a><a href="https://github.com/gama-platform/gama.experimental"><i class="fas fa-puzzle-piece"></i> Gama Experimental Plugins</a><a href="https://github.com/gama-platform/gama.models.experimental"><i class="fas fa-scroll"></i> Gama Experimental Models</a></div></section><section class="copyright">Copyright © 2019 GAMA-Platform</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'undefined',
                indexName: 'undefined',
                inputSelector: '#search_input_react'
              });
            </script></body></html>