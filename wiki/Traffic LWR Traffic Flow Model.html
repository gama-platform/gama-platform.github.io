<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Trafic Group (R2D2) MAPS7 - LWR Model · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="[//]: # (keyword|operator_ln)"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Trafic Group (R2D2) MAPS7 - LWR Model · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gama-platform.github.io/"/><meta property="og:description" content="[//]: # (keyword|operator_ln)"/><meta property="og:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/searchEngine.js"></script><script type="text/javascript" src="/js/dark.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/gama-logo_white.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/wiki/Home" target="_self">Documentation</a></li><li class=""><a href="/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Trafic Group (R2D2) MAPS7 - LWR Model</h1></header><article><div><span><p><em>Author : A. Banos, N. Corson, C. Pivano, L. Rajaonarivo, P. Taillandier</em></p>
<p>The LWR model was proposed by Lighthill and Whitham (1955) and by Richards (1956). It describes the trafic at a global level considering the speed, concentration and flows without taking into account the individual behavior af vehicles. Speed, concentration and flow are the three components of the LWR model. This models reproduces flow of traffic and congestion in specific conditions (homogeneous traffic), going from one equilibrium state to another (see the fundamental diagramm of traffic, which gives flow according to concentration).
In this model, a road is divided into sections and we arbitrarily give to the middle section a lower speed and critical concentration.</p>
<p>Code of the model :</p>
<pre><code class="hljs">

<span class="hljs-builtin">model</span> TraficGroup

global {
        
    <span class="hljs-literal">float</span> road_size &lt;- 10 #km ;                         <span class="hljs-comment">// Size of the road</span>
    
    <span class="hljs-literal">geometry</span> shape &lt;- rectangle (road_size, 200 #m) ;   <span class="hljs-comment">// The world is a rectangle with a length equals to the size of the road and a height of 200m</span>
        
    <span class="hljs-literal">float</span> time_step &lt;- 1.0 ;                            <span class="hljs-comment">// Time step </span>
    <span class="hljs-literal">int</span> nb_sections &lt;- 10 ;                             <span class="hljs-comment">// Number of sections of the road</span>
    <span class="hljs-literal">float</span> section_size &lt;- road_size / nb_sections ;     <span class="hljs-comment">// Size of a section</span>
    
    <span class="hljs-literal">float</span> car_size &lt;- 4 #m ;                                    <span class="hljs-comment">// Size of a car</span>
    <span class="hljs-literal">float</span> nb_max_cars_on_section &lt;- section_size / car_size ;   <span class="hljs-comment">// Maximum number of cars on one section </span>
    
       init{
            
            <span class="hljs-comment">// Creation of the nb_sections sections which compose the road. </span>
            
           <span class="hljs-keyword">loop</span> i <span class="hljs-symbol">from:</span> 0 <span class="hljs-symbol">to:</span> (nb_sections - 1){
              <span class="hljs-keyword">create</span> section <span class="hljs-symbol">with:</span> [shape:: line([{i * section_size , 100},{(i +1) * section_size , 100}])];
           }
            
            <span class="hljs-comment">// For each section, as we need to have information concerning the previous and the next one, we define which section is the previous and which is the next.</span>
            <span class="hljs-comment">// The previous section is the one which last point corresponds to the first point of the actual section. </span>
            <span class="hljs-comment">// The next section is the one which first point corresponds to the last point of the actual section. </span>
            
            <span class="hljs-keyword">ask</span> section{
                previous &lt;- section first_with (last(each.shape.points) = first(self.shape.points)) ;
                next &lt;- section first_with (first(each.shape.points) = last(self.shape.points)) ;
            }
    
            <span class="hljs-comment">// For each section, we define a critical concentration (see the fundamental diagram), a maximum speed, a concentration and a flow (which are = 0 at initialization). </span>
            <span class="hljs-comment">// A fundamental relation about trafic gives : flow = concentration * speed.</span>
            
            <span class="hljs-keyword">ask</span> section{
                critical_concentration &lt;- 125.0 ; <span class="hljs-comment">//Kc</span>
                max_speed &lt;- 50 #km/#h; <span class="hljs-comment">// Vl</span>
                current_concentration &lt;- 0.0 ;
                current_flow &lt;- current_concentration * max_speed ;
                max_flow &lt;- critical_concentration * max_speed ; 
            }
                        
            <span class="hljs-comment">// The concentration and flow ot first section are initialized.</span>
            
            <span class="hljs-keyword">ask</span> section[0]{
                current_concentration &lt;- nb_max_cars_on_section ;
                current_flow &lt;- current_concentration * max_speed ;
            }
            
            <span class="hljs-comment">// The middle section is supposed to have a different maximum speed and a different critical concentration so that we can observe congestion phenomenon.</span>
            <span class="hljs-comment">// This middle section is green.</span>
            
            <span class="hljs-keyword">ask</span> section[<span class="hljs-literal">int</span>(nb_sections/2)] {
                    critical_concentration &lt;- 10.0 ; 
                    max_flow &lt;- critical_concentration * max_speed ; 
                    max_speed &lt;- 10 #km/#h; 
                    color &lt;- #green;
            }
        }
        
   <span class="hljs-comment">// To update flow and concentration at each time step in each section, we use an offer and a demand function. </span>
   <span class="hljs-comment">// These functions define the welcome capacity (offer) and the emission capacity (demand) of a section.</span>
   
    <span class="hljs-builtin">reflex</span> offer_function {
         <span class="hljs-keyword">ask</span> section {
              <span class="hljs-keyword">if</span> current_concentration &lt;= critical_concentration {
                offer &lt;- max_flow ;
              }
              <span class="hljs-keyword">else</span> {
                offer &lt;- max([0 , (- max_flow / critical_concentration) * current_concentration + 2 * max_flow ]);
              }
          
      }
    }
    
    <span class="hljs-builtin">reflex</span> demand_function {
        <span class="hljs-keyword">ask</span> section{
              <span class="hljs-keyword">if</span> current_concentration &lt;= critical_concentration {
                    demand &lt;- max([0 , ( max_flow / critical_concentration) * current_concentration]) ;
              }
              <span class="hljs-keyword">else</span> {
                    demand &lt;- max_flow ;
              }
        }
    }
    
    <span class="hljs-comment">// The flow and concentration are then updated according to the offer and demand functions of the current section, but also of the next and previous ones.</span>
    
    <span class="hljs-comment">// During a time step, the flow of a section take the minimum value between its demand and the offer of the next section.</span>
    <span class="hljs-comment">// The flow of the last section is equal to its demand. </span>
    
    <span class="hljs-builtin">reflex</span> update_flow{
        <span class="hljs-keyword">ask</span> section  {
            <span class="hljs-literal">float</span> next_offer &lt;-  (self.next != nil) ? (self.next).offer : self.demand;
            current_flow &lt;- min([self.demand, next_offer]);
        }
    }
    
    
    <span class="hljs-comment">// After a time step, the concentration is updated from the current concentration, according to the incoming and outgoing concentrations.</span>
    <span class="hljs-comment">// The first section concentration on ly takes into account the outgoing concentration of vehicles.</span>
    
    <span class="hljs-builtin">reflex</span> update_concentration{
        <span class="hljs-keyword">ask</span> section   {
            <span class="hljs-literal">float</span> previous_flow &lt;- (self.previous != nil) ? (self.previous).current_flow : 0.0;
            current_concentration &lt;- current_concentration + time_step/section_size *(previous_flow - self.current_flow) ;
        }   
    }
    
    <span class="hljs-comment">// When there is less than one car left on the road, the simulation stops.</span>
    
    <span class="hljs-builtin">reflex</span> stop_simulation <span class="hljs-symbol">when:</span> sum(section collect each.current_concentration) &lt; 1.0 {
        <span class="hljs-keyword">do</span> pause;
    }
}

<span class="hljs-comment">// A road is divided into sections. </span>
<span class="hljs-comment">// Each section has a concentration, a flow, an offer and a demand, a critical concentration, a maximum speed and a maximum flow, </span>
<span class="hljs-comment">// and a previous and a next section.</span>

<span class="hljs-literal">species</span> section {
    <span class="hljs-literal">float</span> current_concentration  ;
    <span class="hljs-literal">float</span> current_flow  ;
    
    <span class="hljs-literal">float</span> offer ;
    <span class="hljs-literal">float</span> demand  ;
    
    <span class="hljs-literal">rgb</span> color;
    
    <span class="hljs-literal">float</span> critical_concentration ; 
    <span class="hljs-literal">float</span> max_speed ; 
    <span class="hljs-literal">float</span> max_flow ; 

    section previous ;
    section next ;
    
    <span class="hljs-comment">// The width of a section depends on its concentration.</span>
    
    <span class="hljs-keyword">aspect</span> shape_section {
        <span class="hljs-keyword">draw</span> shape + (1 + 15 * ln (current_concentration + 1)) <span class="hljs-symbol">color:</span> color;        
    } 

}


<span class="hljs-builtin">experiment</span> TraficGroup <span class="hljs-symbol">type:</span> gui {

    <span class="hljs-comment">// Users can chose the number of sections and the time step.</span>

    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Number of sections'</span> <span class="hljs-symbol">var:</span> nb_sections <span class="hljs-symbol">category:</span> <span class="hljs-string">"Section parameter"</span>;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">'Time step - DeltaT'</span> <span class="hljs-symbol">var:</span> time_step <span class="hljs-symbol">category:</span> <span class="hljs-string">"Time parameter"</span>;
        
    <span class="hljs-keyword">output</span> {
        
        <span class="hljs-comment">// A monitor gives the number of cars on the road at every time step.</span>
        
        <span class="hljs-keyword">monitor</span> <span class="hljs-string">"Sum Concentrations"</span> <span class="hljs-symbol">value:</span> sum(section collect each.current_concentration);
        
        <span class="hljs-comment">// A display shows the road. Section width depend on their concentration.</span>
        
        <span class="hljs-keyword">display</span> TheRoad{
            <span class="hljs-literal">species</span> section <span class="hljs-symbol">aspect:</span> shape_section ;
        }
        
        <span class="hljs-comment">// The greeen time series correspond to the middle section (on which concentration and maximum speed are lower).</span>
        <span class="hljs-comment">// The red time series correspond to the section just before the middle one.</span>
                
        <span class="hljs-keyword">display</span> Concentrations {
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"Concentrations"</span> <span class="hljs-symbol">type:</span> series  {
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 0'</span> <span class="hljs-symbol">value:</span> section[0].current_concentration <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false ;               
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 1'</span> <span class="hljs-symbol">value:</span> section[1].current_concentration <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 2'</span> <span class="hljs-symbol">value:</span> section[2].current_concentration <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 3'</span> <span class="hljs-symbol">value:</span> section[3].current_concentration <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;                
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 4'</span> <span class="hljs-symbol">value:</span> section[<span class="hljs-literal">int</span>(nb_sections/2 - 1 ) ].current_concentration <span class="hljs-symbol">color:</span> #red <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 5'</span> <span class="hljs-symbol">value:</span> section[<span class="hljs-literal">int</span>(nb_sections/2)].current_concentration <span class="hljs-symbol">color:</span> #green <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 6'</span> <span class="hljs-symbol">value:</span> section[6].current_concentration <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;                
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 7'</span> <span class="hljs-symbol">value:</span> section[7].current_concentration <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 8'</span> <span class="hljs-symbol">value:</span> section[8].current_concentration <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 9'</span> <span class="hljs-symbol">value:</span> section[9].current_concentration <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;
                }
            }
            
            <span class="hljs-keyword">display</span> Flows {
                <span class="hljs-keyword">chart</span> <span class="hljs-string">"Flows"</span> <span class="hljs-symbol">type:</span> series  {
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 0'</span> <span class="hljs-symbol">value:</span> section[0].current_flow <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;             
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 1'</span> <span class="hljs-symbol">value:</span> section[1].current_flow <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 2'</span> <span class="hljs-symbol">value:</span> section[2].current_flow <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 3'</span> <span class="hljs-symbol">value:</span> section[3].current_flow <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;             
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 4'</span> <span class="hljs-symbol">value:</span> section[<span class="hljs-literal">int</span>(nb_sections/2 - 1)].current_flow <span class="hljs-symbol">color:</span> #red <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 5'</span> <span class="hljs-symbol">value:</span> section[<span class="hljs-literal">int</span>(nb_sections/2)].current_flow <span class="hljs-symbol">color:</span> #green <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 6'</span> <span class="hljs-symbol">value:</span> section[6].current_flow <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;             
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 7'</span> <span class="hljs-symbol">value:</span> section[7].current_flow <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 8'</span> <span class="hljs-symbol">value:</span> section[8].current_flow <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;
                <span class="hljs-keyword">data</span> <span class="hljs-string">'Section 9'</span> <span class="hljs-symbol">value:</span> section[9].current_flow <span class="hljs-symbol">color:</span> #gray <span class="hljs-symbol">marker:</span> false;
                }
            }
    }
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a></div><div><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div><h5>Ecosystem</h5><a href="https://github.com/gama-platform/gama"><i class="fab fa-github"></i> GitHub Gama</a><a href="https://github.com/gama-platform/gama.experimental"><i class="fas fa-puzzle-piece"></i> Gama Experimental Plugins</a><a href="https://github.com/gama-platform/gama.models.experimental"><i class="fas fa-scroll"></i> Gama Experimental Models</a></div></section><section class="copyright">Copyright © 2019 GAMA-Platform</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'undefined',
                indexName: 'undefined',
                inputSelector: '#search_input_react'
              });
            </script></body></html>