# .travis.yml
language: node_js
dist: trusty
node_js:
  - '8'
branches:
  only:
    - sources
cache:
  yarn: true
addons:
  sonarcloud:
    organization: "gama-platform"
    token:
      secure: "$S0NAR_TOKEN" # encrypted value of your token
      
before_script:
  # the following command line builds the project, runs the tests with coverage and then execute the SonarCloud analysis
  - sonar-scanner -X -Dsonar.projectKey=gama-platform_gama-platform.github.io -Dsonar.projectName=gama-platform.github.io -Dsonar.projectVersion=1.0.0 -Dsonar.sources=. -Dsonar.language=js -Dsonar.host.url=https://sonarcloud.io

  #  Setup
  - git config --global user.name "${GH_NAME}"
  - git config --global user.email "${GH_EMAIL}"
  - echo "machine github.com login ${GH_NAME} password ${BOT_TOKEN}" > ~/.netrc

script:  
  #  Get new wiki
  - git clone https://github.com/gama-platform/gama.wiki.git
  
  #  Reorganise folders to be more Docusaurus-friendly
  - sh ./script/unstructurize.sh
  - sh ./script/link_fixer.sh
  - sed -i '/^$/d' './docs/_Sidebar.md' # Remove blank line
  - php script/sidebarCopy.php
  - php script/sidebarSearch.php
  - sh script/autoHeader.sh

  #  Compile website
  - cd website && yarn install && GIT_USER="${GH_NAME}" yarn run publish-gh-pages

