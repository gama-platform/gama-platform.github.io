<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Simple Road Network · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="[//]: # (keyword|operator_as_map)"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Simple Road Network · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gama-platform.github.io/"/><meta property="og:description" content="[//]: # (keyword|operator_as_map)"/><meta property="og:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://gama-platform.github.io/blog/atom.xml" title="GAMA-Platform Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://gama-platform.github.io/blog/feed.xml" title="GAMA-Platform Blog RSS Feed"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/searchEngine.js"></script><script type="text/javascript" src="/js/dark.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/gama-logo_white.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/wiki/Home" target="_self">Documentation</a></li><li class=""><a href="/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Simple Road Network</h1></header><article><div><span><p><em>Author : Patrick Taillandier</em></p>
<p>Model using shapefiles to create buildings and a road graph, with people going from their living place to their work place depending on the hour. The traffic jam is also taken into account to slow the people agents when they are too much on the same road. The experiment shows a display of the city, with people agents, buildings and roads, a display of the traffic jam occuring on the roads, and a chart display showing two charts : one for the traffic jam coefficients, and an other for the objectives of the people agents.</p>
<p>Code of the model :</p>
<pre><code class="hljs">  
<span class="hljs-builtin">model</span> RoadTrafficCity
 
   
global {   
    
    <span class="hljs-comment">//Shapefiles for the buildings, the roads and the bounds of the environment</span>
    <span class="hljs-literal">file</span> shape_file_roads <span class="hljs-symbol">parameter:</span> <span class="hljs-string">"Shapefile for the roads:"</span> <span class="hljs-symbol">category:</span> <span class="hljs-string">"GIS"</span> &lt;- <span class="hljs-literal">file</span>(<span class="hljs-string">"../includes/ManhattanRoads.shp"</span>) ;
    <span class="hljs-literal">file</span> shape_file_bounds <span class="hljs-symbol">parameter:</span> <span class="hljs-string">"Shapefile for the bounds:"</span> <span class="hljs-symbol">category:</span> <span class="hljs-string">"GIS"</span> &lt;- <span class="hljs-literal">file</span>(<span class="hljs-string">"../includes/ManhattanBounds.shp"</span>) ;
    <span class="hljs-literal">file</span> shape_file_buildings <span class="hljs-symbol">parameter:</span> <span class="hljs-string">"Shapefile for the buildings:"</span> <span class="hljs-symbol">category:</span> <span class="hljs-string">"GIS"</span> &lt;- <span class="hljs-literal">file</span>(<span class="hljs-string">"../includes/ManhattanBuildings.shp"</span>) ;
    <span class="hljs-literal">geometry</span> shape &lt;- envelope(shape_file_bounds);
    
    <span class="hljs-comment">//Stock the number of times agents reached their goal (their house or work place)</span>
    <span class="hljs-literal">int</span> nbGoalsAchived &lt;- 0;
    
    <span class="hljs-comment">//represent the day time for the agent to inform them to go work or home</span>
    <span class="hljs-literal">int</span> day_time <span class="hljs-symbol">update:</span> cycle mod 144 ;
    
    <span class="hljs-comment">//Variables to manage the minimal and maximal time to start working</span>
    <span class="hljs-literal">int</span> min_work_start &lt;- 36;
    <span class="hljs-literal">int</span> max_work_start &lt;- 60;
    
    <span class="hljs-comment">//Number of people created</span>
    <span class="hljs-literal">int</span> nb_people &lt;- 500;
    
    <span class="hljs-comment">//Variables to manage the minimal and maximal time to go home</span>
    <span class="hljs-literal">int</span> min_work_end &lt;- 84; 
    <span class="hljs-literal">int</span> max_work_end &lt;- 132; 
    
    <span class="hljs-comment">//Manage the speed allowed in the model for the people agents</span>
    <span class="hljs-literal">float</span> min_speed &lt;- 50.0;
    <span class="hljs-literal">float</span> max_speed &lt;- 100.0; 
    
    <span class="hljs-comment">//Graph of the road network</span>
    <span class="hljs-literal">graph</span> the_graph;
    
     
    init {  
        
        <span class="hljs-comment">//creation of the agents of road and building species using the shapefile and linking the </span>
        <span class="hljs-keyword">create</span> road <span class="hljs-symbol">from:</span> shape_file_roads <span class="hljs-symbol">with:</span>[nbLanes::<span class="hljs-literal">int</span>(read(<span class="hljs-string">"lanes"</span>))];
        <span class="hljs-keyword">create</span> building <span class="hljs-symbol">from:</span> shape_file_buildings;
        
        <span class="hljs-comment">//Increase the shape of roads according to the number of lanes it has</span>
        <span class="hljs-keyword">ask</span> road as <span class="hljs-literal">list</span> {
            visu_geom &lt;- shape + (2 * nbLanes); 
        }
        <span class="hljs-comment">//Initliazation of the graph with the road species</span>
        the_graph &lt;-  (as_edge_graph(road));
        
        <span class="hljs-comment">//Initialization of nb_people agents of people species</span>
        <span class="hljs-comment">// and definition of their living and working places</span>
        <span class="hljs-keyword">create</span> people <span class="hljs-symbol">number:</span> nb_people { 
            living_space &lt;- 3.0;
            tolerance &lt;- 0.1;
            lanes_attribute &lt;- <span class="hljs-string">"nbLanes"</span>;
            obstacle_species &lt;- [<span class="hljs-literal">species</span>(self)]; 
            speed &lt;- min_speed + rnd (max_speed - min_speed) ;
            start_work &lt;- min_work_start + rnd (max_work_start - min_work_start) ;
            end_work &lt;- min_work_end + rnd (max_work_end - min_work_end) ;
            living_place &lt;- one_of(building) ;
            working_place &lt;- one_of(building) ;
            location &lt;- living_place.location; 
        }   
    }
    
    <span class="hljs-comment">//Update of the graph every 10 Cycles to take into account the traffic jam of the road in the weights of the graph</span>
    <span class="hljs-builtin">reflex</span> update_graph <span class="hljs-symbol">when:</span>every(10){
        <span class="hljs-literal">map</span>&lt;road,<span class="hljs-literal">float</span>&gt; weights_map &lt;- road as_map (each:: (each.shape.perimeter * each.coeff_traffic));
        the_graph &lt;- the_graph with_weights weights_map;
    }
    
} 
    
<span class="hljs-literal">species</span> road  { 
    <span class="hljs-literal">int</span> nbLanes;
    <span class="hljs-literal">int</span> indexDirection; 
    <span class="hljs-literal">bool</span> blocked &lt;- false;
    <span class="hljs-literal">rgb</span> color &lt;- #black;
    <span class="hljs-literal">float</span> coeff_traffic &lt;- 1.0 <span class="hljs-symbol">update:</span> 1 + (<span class="hljs-literal">float</span>(length(people at_distance 1.0)) / shape.perimeter * 200 / nbLanes);
    <span class="hljs-literal">geometry</span> visu_geom;
    
    <span class="hljs-keyword">aspect</span> base { 
        <span class="hljs-keyword">draw</span> shape <span class="hljs-symbol">color:</span> #black ;
    } 
    
    
    <span class="hljs-comment">//Command that the user can execute to remove or add a road </span>
    <span class="hljs-keyword">user_command</span> <span class="hljs-string">"Remove a road"</span> <span class="hljs-symbol">action:</span> <span class="hljs-keyword">remove</span>;
    <span class="hljs-keyword">user_command</span> <span class="hljs-string">"Add a road"</span> <span class="hljs-symbol">action:</span> <span class="hljs-keyword">add</span>;
         
    <span class="hljs-keyword">action</span> <span class="hljs-keyword">remove</span> {
        blocked &lt;- true;
        the_graph &lt;-  (as_edge_graph(road where (!each.blocked))) ;
        <span class="hljs-literal">map</span>&lt;road,<span class="hljs-literal">float</span>&gt; weights_map &lt;- road as_map (each:: each.coeff_traffic);
        the_graph &lt;- the_graph  with_weights weights_map;
        color &lt;- #magenta;
    }
        
    <span class="hljs-keyword">action</span> <span class="hljs-keyword">add</span> {
        blocked &lt;- false;
        the_graph &lt;-  (as_edge_graph(road where (!each.blocked)));
        <span class="hljs-literal">map</span>&lt;road,<span class="hljs-literal">float</span>&gt; weights_map &lt;- road as_map (each:: each.coeff_traffic);
        the_graph &lt;- the_graph  with_weights weights_map;
        color &lt;- #black;
    }
        
    <span class="hljs-keyword">aspect</span> road_width {  
        <span class="hljs-keyword">draw</span> visu_geom <span class="hljs-symbol">color:</span> color ;
    }
    
    <span class="hljs-keyword">aspect</span> traffic_jam {  
        <span class="hljs-keyword">if</span> (coeff_traffic &gt; 0.025) {
            <span class="hljs-keyword">draw</span> shape + (coeff_traffic / 4.0) <span class="hljs-symbol">color:</span> #red ;
        }
    }       
}
    
<span class="hljs-literal">species</span> building  { 
    <span class="hljs-literal">rgb</span> color &lt;- #gray;
    <span class="hljs-keyword">aspect</span> base { 
        <span class="hljs-keyword">draw</span> shape <span class="hljs-symbol">color:</span> color ;
    }
}
    
<span class="hljs-literal">species</span> people <span class="hljs-symbol">skills:</span> [<span class="hljs-builtin">driving</span>]{ 
    <span class="hljs-literal">float</span> speed; 
    <span class="hljs-literal">rgb</span> color &lt;- <span class="hljs-literal">rgb</span>([rnd(255),rnd(255),rnd(255)]) ;
    <span class="hljs-literal">point</span> targetBis &lt;- nil ; 
    <span class="hljs-literal">point</span> previousLoc &lt;- nil;
    <span class="hljs-literal">bool</span> normalMove &lt;- true;
    <span class="hljs-literal">float</span> evadeDist &lt;- 500.0;
    building living_place &lt;- nil ;
    building working_place &lt;- nil ;
    <span class="hljs-literal">int</span> start_work ;
    <span class="hljs-literal">int</span> end_work  ;
    <span class="hljs-literal">string</span> objective ; 
    <span class="hljs-literal">point</span> the_target &lt;- nil ;
        
    <span class="hljs-comment">//Reflex to make the agent move while it had a target and normalMove equals true</span>
    <span class="hljs-builtin">reflex</span> move <span class="hljs-symbol">when:</span> the_target != nil and normalMove{
        previousLoc &lt;- copy(location);
        <span class="hljs-keyword">do</span> goto_driving <span class="hljs-symbol">target:</span> the_target <span class="hljs-symbol">on:</span> the_graph <span class="hljs-symbol">speed:</span> speed ; 
        <span class="hljs-keyword">switch</span> location { 
            <span class="hljs-keyword">match</span> the_target {
                the_target &lt;- nil;
                nbGoalsAchived &lt;- nbGoalsAchived +1;
            }
            <span class="hljs-keyword">match</span> previousLoc {
                targetBis &lt;- last((one_of(road where (each distance_to self &lt; evadeDist)).shape).points);
                normalMove &lt;- false;
            }
        }
    }
        
    <span class="hljs-comment">//Reflex to make the agent move when it is not normal moving </span>
    <span class="hljs-builtin">reflex</span> EvadeMove <span class="hljs-symbol">when:</span> !(normalMove){
        previousLoc &lt;- copy(location);
        <span class="hljs-keyword">do</span> goto_driving <span class="hljs-symbol">target:</span> targetBis <span class="hljs-symbol">on:</span> the_graph <span class="hljs-symbol">speed:</span> speed ; 
        <span class="hljs-keyword">switch</span> location { 
            <span class="hljs-keyword">match</span> targetBis {
                normalMove &lt;- true;
            }
            <span class="hljs-keyword">match</span> previousLoc {
                targetBis &lt;- last((one_of(road where (each distance_to self &lt; evadeDist)).shape).points);
            }
        }
    }
    
    <span class="hljs-comment">//Reflex to make the agent go to its working place when it's time to go work</span>
    <span class="hljs-builtin">reflex</span> time_to_work <span class="hljs-symbol">when:</span> day_time = start_work {
        objective &lt;- <span class="hljs-string">"working"</span> ;
        the_target &lt;- any_location_in (working_place);
    }
    
    <span class="hljs-comment">//Reflex to make the agent go to its living place when it's time to go home</span>
    <span class="hljs-builtin">reflex</span> time_to_go_home <span class="hljs-symbol">when:</span> day_time = end_work {
        objective &lt;- <span class="hljs-string">"go home"</span> ;
        the_target &lt;- any_location_in (living_place); 
    }  
    
    <span class="hljs-keyword">aspect</span> base {
        <span class="hljs-keyword">draw</span> circle(20) <span class="hljs-symbol">color:</span> color;
    }
}

<span class="hljs-builtin">experiment</span> traffic <span class="hljs-symbol">type:</span> gui {
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Shapefile for the buildings:"</span> <span class="hljs-symbol">var:</span> shape_file_buildings <span class="hljs-symbol">category:</span> <span class="hljs-string">"GIS"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Shapefile for the roads:"</span> <span class="hljs-symbol">var:</span> shape_file_roads <span class="hljs-symbol">category:</span> <span class="hljs-string">"GIS"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Shapefile for the bounds:"</span> <span class="hljs-symbol">var:</span> shape_file_bounds <span class="hljs-symbol">category:</span> <span class="hljs-string">"GIS"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Number of people agents"</span> <span class="hljs-symbol">var:</span> nb_people <span class="hljs-symbol">category:</span> <span class="hljs-string">"People"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Earliest hour to start work"</span> <span class="hljs-symbol">var:</span> min_work_start <span class="hljs-symbol">category:</span> <span class="hljs-string">"People"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Latest hour to start work"</span> <span class="hljs-symbol">var:</span> max_work_start <span class="hljs-symbol">category:</span> <span class="hljs-string">"People"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Earliest hour to end work"</span> <span class="hljs-symbol">var:</span> min_work_end <span class="hljs-symbol">category:</span> <span class="hljs-string">"People"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"Latest hour to end work"</span> <span class="hljs-symbol">var:</span> max_work_end <span class="hljs-symbol">category:</span> <span class="hljs-string">"People"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"minimal speed"</span> <span class="hljs-symbol">var:</span> min_speed <span class="hljs-symbol">category:</span> <span class="hljs-string">"People"</span> ;
    <span class="hljs-keyword">parameter</span> <span class="hljs-string">"maximal speed"</span> <span class="hljs-symbol">var:</span> max_speed <span class="hljs-symbol">category:</span> <span class="hljs-string">"People"</span> ;
    
    <span class="hljs-keyword">output</span> {
        <span class="hljs-keyword">display</span> city_display {
            <span class="hljs-literal">species</span> road <span class="hljs-symbol">aspect:</span> road_width ;
            <span class="hljs-literal">species</span> building <span class="hljs-symbol">aspect:</span> base;
            <span class="hljs-literal">species</span> people <span class="hljs-symbol">aspect:</span> base;
        }
        <span class="hljs-keyword">display</span> traffic_jam_display {
            <span class="hljs-literal">species</span> road <span class="hljs-symbol">aspect:</span> base ;
            <span class="hljs-literal">species</span> road <span class="hljs-symbol">aspect:</span> traffic_jam ;
        }
        <span class="hljs-keyword">display</span> chart_display <span class="hljs-symbol">refresh:</span> every(10) {
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"Traffic jam"</span> <span class="hljs-symbol">type:</span> series <span class="hljs-symbol">size:</span> {0.9, 0.4} <span class="hljs-symbol">position:</span> {0.05, 0.05} {
                <span class="hljs-keyword">data</span> <span class="hljs-string">"Mean road traffic coefficient"</span> <span class="hljs-symbol">value:</span> mean (road collect each.coeff_traffic) <span class="hljs-symbol">style:</span> line <span class="hljs-symbol">color:</span> #green ;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"Max road traffic coefficient"</span> <span class="hljs-symbol">value:</span> road max_of (each.coeff_traffic) <span class="hljs-symbol">style:</span> line <span class="hljs-symbol">color:</span> #red ;
            }
            <span class="hljs-keyword">chart</span> <span class="hljs-string">"People Objectif"</span> <span class="hljs-symbol">type:</span> pie <span class="hljs-symbol">style:</span> exploded <span class="hljs-symbol">size:</span> {0.9, 0.4} <span class="hljs-symbol">position:</span> {0.05, 0.55} {
                <span class="hljs-keyword">data</span> <span class="hljs-string">"Working"</span> <span class="hljs-symbol">value:</span> length ((people as <span class="hljs-literal">list</span>) where (each.objective=<span class="hljs-string">"working"</span>)) <span class="hljs-symbol">color:</span> #green ;
                <span class="hljs-keyword">data</span> <span class="hljs-string">"Staying home"</span> <span class="hljs-symbol">value:</span> length ((people as <span class="hljs-literal">list</span>) where (each.objective=<span class="hljs-string">"go home"</span>)) <span class="hljs-symbol">color:</span> #blue ;
            }
        }
        <span class="hljs-keyword">monitor</span> <span class="hljs-string">"Number of goals achieved"</span> <span class="hljs-symbol">value:</span> nbGoalsAchived ;
    }
}



</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap" style="margin-bottom:0"><a href="/" class="nav-home"><img src="/img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://github.com/gama-platform"><i class="fab fa-github"></i> GitHub</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://gama-platform.github.io/blog/feed" target="_blank"><i class="fa fa-rss"></i> Blog RSS</a></div><div style="flex-grow:2"><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div style="color:hsla(0,0%,100%,.4);flex-grow:3"><h5>License</h5><p>Copyright (C) - 2019 GAMA-Platform.</p><p>Permission is granted to copy, distribute and/or modify this document under the terms of the GNU Free Documentation License, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.</p><p>A copy of the license is included <a href="https://github.com/gama-platform/gama/wiki/LICENSE.md" style="display:initial">here</a>, in the repository of the wiki content.</p></div></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'undefined',
                indexName: 'undefined',
                inputSelector: '#search_input_react'
              });
            </script></body></html>