"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[26452],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>k});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),d=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=d(e.components);return a.createElement(p.Provider,{value:t},e.children)},m="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),m=d(n),h=i,k=m["".concat(p,".").concat(h)]||m[h]||g[h]||r;return n?a.createElement(k,o(o({ref:t},s),{},{components:n})):a.createElement(k,o({ref:t},s))}));function k(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=h;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[m]="string"==typeof e?e:i,o[1]=l;for(var d=2;d<r;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},54163:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>p,default:()=>k,frontMatter:()=>l,metadata:()=>d,toc:()=>m});var a=n(87462),i=n(63366),r=(n(67294),n(3905)),o=["components"],l={title:"3. Movement of People"},p=void 0,d={unversionedId:"RoadTrafficModel_step3",id:"RoadTrafficModel_step3",title:"3. Movement of People",description:"This third step presents how to create a road system from GIS data. More precisely, it shows how to build a graph from a list of polylines and to constrain the movement of an agent according to this graph.",source:"@site/../docs/RoadTrafficModel_step3.md",sourceDirName:".",slug:"/RoadTrafficModel_step3",permalink:"/wiki/next/RoadTrafficModel_step3",draft:!1,editUrl:"https://github.com/gama-platform/gama/wiki/RoadTrafficModel_step3/_edit",tags:[],version:"current",frontMatter:{title:"3. Movement of People"}},s={},m=[{value:"Formulation",id:"formulation",level:2},{value:"Model Definition",id:"model-definition",level:2},{value:"<code>people</code> agents",id:"people-agents",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Initialization",id:"initialization",level:3},{value:"Complete Model",id:"complete-model",level:2}],g={toc:m},h="wrapper";function k(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)(h,(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This third step presents how to create a road system from GIS data. More precisely, it shows how to build a graph from a list of polylines and to constrain the movement of an agent according to this graph."),(0,r.kt)("h2",{id:"formulation"},"Formulation"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For each ",(0,r.kt)("inlineCode",{parentName:"li"},"people")," agent, definition of 2 new attributes: ",(0,r.kt)("inlineCode",{parentName:"li"},"living_place")," (building of type 'Residential') and ",(0,r.kt)("inlineCode",{parentName:"li"},"working_place")," (building of type 'Industrial')."),(0,r.kt)("li",{parentName:"ul"},"For each ",(0,r.kt)("inlineCode",{parentName:"li"},"people")," agent: definition of ",(0,r.kt)("inlineCode",{parentName:"li"},"start_work")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"end_work")," hours attributes that respectively represent when the agent leaves its house to go to work and when it leaves its working place to go back home. These hours will be randomly defined between 6 AM (",(0,r.kt)("inlineCode",{parentName:"li"},"min_work_start"),") and 8 AM (",(0,r.kt)("inlineCode",{parentName:"li"},"max_work_start"),") for ",(0,r.kt)("inlineCode",{parentName:"li"},"start_work")," and 4 PM (",(0,r.kt)("inlineCode",{parentName:"li"},"min_work_end"),") and 8 PM (",(0,r.kt)("inlineCode",{parentName:"li"},"max_work_end"),") for ",(0,r.kt)("inlineCode",{parentName:"li"},"end_work"),"."),(0,r.kt)("li",{parentName:"ul"},"For each ",(0,r.kt)("inlineCode",{parentName:"li"},"people")," agent: definition of an ",(0,r.kt)("inlineCode",{parentName:"li"},"objective")," attribute: this one can 'go home' or 'working'."),(0,r.kt)("li",{parentName:"ul"},"For each ",(0,r.kt)("inlineCode",{parentName:"li"},"people")," agent: define a speed. The speed will be randomly defined between 1 km/h (",(0,r.kt)("inlineCode",{parentName:"li"},"min_speed"),") and 5 km/h (",(0,r.kt)("inlineCode",{parentName:"li"},"max_speed"),")."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"people")," agents move along the road, taking the shortest path."),(0,r.kt)("li",{parentName:"ul"},"All the previously introduced values will be defined in global attributes.")),(0,r.kt)("h2",{id:"model-definition"},"Model Definition"),(0,r.kt)("h3",{id:"people-agents"},(0,r.kt)("inlineCode",{parentName:"h3"},"people")," agents"),(0,r.kt)("p",null,"First, we have to change the skill of the ",(0,r.kt)("inlineCode",{parentName:"p"},"people")," agents: as we want to use an action of the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"moving"))," skill (",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"goto")),"), we will provide the ",(0,r.kt)("inlineCode",{parentName:"p"},"people")," agents with this skill. A ",(0,r.kt)("a",{parentName:"p",href:"AttachingSkills"},"skill")," is a built-in module that provide the modeler a self-contain and relevant set of actions and variables."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"species people skills: [moving] {\n    ...\n}\n")),(0,r.kt)("p",null,"Then, we have to add new attributes to the people agents: ",(0,r.kt)("inlineCode",{parentName:"p"},"living_place"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"working_place"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"start_work"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"end_work")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"objective"),". In addition, we will add a ",(0,r.kt)("inlineCode",{parentName:"p"},"the_target")," variable that will represent the point toward which the agent will be currently moving."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"species people skills: [moving]{\n    rgb color <- #yellow ;\n    building living_place <- nil ;\n    building working_place <- nil ;\n    int start_work ;\n    int end_work  ;\n    string objective ; \n    point the_target <- nil ;\n      \n    ...\n}\n")),(0,r.kt)("p",null,"We define two reflexes that allow to change the ",(0,r.kt)("inlineCode",{parentName:"p"},"objective")," (and ",(0,r.kt)("inlineCode",{parentName:"p"},"the_target"),") of the agent at the ",(0,r.kt)("inlineCode",{parentName:"p"},"start_work")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"end_work")," hours. Concerning ",(0,r.kt)("inlineCode",{parentName:"p"},"the_target")," value, we choose a random point in the objective building (",(0,r.kt)("inlineCode",{parentName:"p"},"working_place")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"living_place"),") by using the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"any_location_in"))," operator. The attribute ",(0,r.kt)("inlineCode",{parentName:"p"},"current_date")," is a built-in global attribute of type ",(0,r.kt)("inlineCode",{parentName:"p"},"date")," that is automatically incremented from the ",(0,r.kt)("inlineCode",{parentName:"p"},"starting_date")," of the simulation by ",(0,r.kt)("inlineCode",{parentName:"p"},"step")," value. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'species people skills: [moving]{  \n    ...\n    reflex time_to_work when: current_date.hour = start_work and objective = "resting" {\n        objective <- "working" ;\n    the_target <- any_location_in (working_place);\n    }\n        \n    reflex time_to_go_home when: current_date.hour = end_work and objective = "working" {\n        objective <- "resting" ;\n    the_target <- any_location_in (living_place); \n    } \n    ...\n}\n')),(0,r.kt)("p",null,"At last, we define a reflex that allows the agent to move. If a target point is defined (",(0,r.kt)("inlineCode",{parentName:"p"},"the_target != nil"),"), the agent moves toward its target using the ",(0,r.kt)("inlineCode",{parentName:"p"},"goto")," action (provided by the ",(0,r.kt)("inlineCode",{parentName:"p"},"moving")," skill). Note that we specified a graph to constraint the movement of the agents on the road network with the facet ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"on")),". We will see later how this graph is built. The agent uses the shortest path (according to the graph) to go to the target point. When the agent arrives at its destination (",(0,r.kt)("inlineCode",{parentName:"p"},"the_target = self.location"),"), the target is set to nil (the agent will stop moving)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"species people skills: [moving]{\n    ...\n    reflex move when: the_target != nil {\n    do goto target: the_target on: the_graph ; \n    if the_target = location {\n        the_target <- nil ;\n    }\n    }\n}\n")),(0,r.kt)("h3",{id:"parameters"},"Parameters"),(0,r.kt)("p",null,"We add several parameters (and thus global variables) (",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"min_work_start")),", ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"max_work_start")),", ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"min_work_end")),", ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"max_work_end")),", ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"min_speed"))," and ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"max_speed")),") and two global variables: ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"the_graph"))," (graph computed from the road network). In addition, we set the starting date in order that the simulation starts at midnight."),(0,r.kt)("p",null,"In the global section:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'global {\n    ...\n    date starting_date <- date("2019-09-01-00-00-00");\n    int min_work_start <- 6;\n    int max_work_start <- 8;\n    int min_work_end <- 16; \n    int max_work_end <- 20; \n    float min_speed <- 1.0 #km / #h;\n    float max_speed <- 5.0 #km / #h; \n    graph the_graph;\n    ...\n}\n')),(0,r.kt)("p",null,"In the ",(0,r.kt)("inlineCode",{parentName:"p"},"experiment")," section, we add a ",(0,r.kt)("inlineCode",{parentName:"p"},"parameter")," statement for each global variable we want to have as a parameter:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'experiment road_traffic type: gui {\n    ... \n    parameter "Earliest hour to start work" var: min_work_start category: "People" min: 2 max: 8;\n    parameter "Latest hour to start work" var: max_work_start category: "People" min: 8 max: 12;\n    parameter "Earliest hour to end work" var: min_work_end category: "People" min: 12 max: 16;\n    parameter "Latest hour to end work" var: max_work_end category: "People" min: 16 max: 23;\n    parameter "minimal speed" var: min_speed category: "People" min: 0.1 #km/#h ;\n    parameter "maximal speed" var: max_speed category: "People" max: 10 #km/#h;\n    ...\n}\n')),(0,r.kt)("h3",{id:"initialization"},"Initialization"),(0,r.kt)("p",null,"First, we need to compute from the ",(0,r.kt)("inlineCode",{parentName:"p"},"road")," agents, a graph for the moving of the ",(0,r.kt)("inlineCode",{parentName:"p"},"people")," agents. The operator ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"as_edge_graph"))," allows doing that. It automatically builds from a set of agents or geometries a graph where the agents are the edges of the graph, a node represent the extremities of the agent geometry."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"global {\n    init {\n        ...\n        create road from: shape_file_roads ;\n        the_graph <- as_edge_graph(road);\n        ...\n    }\n")),(0,r.kt)("p",null,"We randomly assign one working place and one house to each ",(0,r.kt)("inlineCode",{parentName:"p"},"people")," agent. To simplify the GAML code, we define two temporary variables: the list of buildings of type 'Residential' and the list of buildings of type 'Industrial' (by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"where")," command). At the creation of each ",(0,r.kt)("inlineCode",{parentName:"p"},"people")," agent, we initialize its ",(0,r.kt)("inlineCode",{parentName:"p"},"speed")," (built-in attribute coming from the ",(0,r.kt)("inlineCode",{parentName:"p"},"moving")," skill), ",(0,r.kt)("inlineCode",{parentName:"p"},"start_work")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"end_work")," to each ",(0,r.kt)("inlineCode",{parentName:"p"},"people"),' agent (according to the min and max values defined in the global). We define as well an initial objective ("resting"). Concerning the definition of the ',(0,r.kt)("inlineCode",{parentName:"p"},"living_place")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"working_place"),", these ones are randomly chosen among the ",(0,r.kt)("inlineCode",{parentName:"p"},"residential_buildings")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"industrial_buildings")," lists."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'    init {\n        ...\n        list<building> residential_buildings <- building where (each.type="Residential");\n        list<building>  industrial_buildings <- building  where (each.type="Industrial") ;\n        create people number: nb_people {\n        speed <- rnd(min_speed, max_speed);\n        start_work <- rnd (min_work_start, max_work_start);\n        end_work <- rnd(min_work_end, max_work_end);\n            living_place <- one_of(residential_buildings) ;\n            working_place <- one_of(industrial_buildings) ;\n            objective <- "resting";\n            location <- any_location_in (living_place); \n       }\n    ...\n    }\n')),(0,r.kt)("h2",{id:"complete-model"},"Complete Model"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-gaml",metastring:"reference",reference:!0},"https://github.com/gama-platform/gama/blob/GAMA_1.9.0/msi.gama.models/models/Tutorials/Road%20Traffic/models/Model%2003.gaml\n")))}k.isMDXComponent=!0}}]);