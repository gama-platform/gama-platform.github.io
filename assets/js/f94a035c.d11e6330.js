"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3893],{3905:(e,a,t)=>{t.d(a,{Zo:()=>d,kt:()=>h});var n=t(67294);function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,o=function(e,a){if(null==e)return{};var t,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=n.createContext({}),m=function(e){var a=n.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},d=function(e){var a=m(e.components);return n.createElement(l.Provider,{value:a},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=m(t),u=o,h=p["".concat(l,".").concat(u)]||p[u]||c[u]||r;return t?n.createElement(h,i(i({ref:a},d),{},{components:t})):n.createElement(h,i({ref:a},d))}));function h(e,a){var t=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=u;var s={};for(var l in a)hasOwnProperty.call(a,l)&&(s[l]=a[l]);s.originalType=e,s[p]="string"==typeof e?e:o,i[1]=s;for(var m=2;m<r;m++)i[m]=t[m];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},40447:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>m,toc:()=>p});var n=t(87462),o=t(63366),r=(t(67294),t(3905)),i=["components"],s={title:"Headless Server"},l=void 0,m={unversionedId:"HeadlessServer",id:"HeadlessServer",title:"Headless Server",description:"Running a Gama Headless server:",source:"@site/../docs/HeadlessServer.md",sourceDirName:".",slug:"/HeadlessServer",permalink:"/wiki/next/HeadlessServer",draft:!1,editUrl:"https://github.com/gama-platform/gama/wiki/HeadlessServer/_edit",tags:[],version:"current",frontMatter:{title:"Headless Server"},sidebar:"side",previous:{title:"Headless Batch",permalink:"/wiki/next/HeadlessBatch"},next:{title:"Preferences",permalink:"/wiki/next/Preferences"}},d={},p=[{value:"Running a Gama Headless server:",id:"running-a-gama-headless-server",level:2},{value:"From the release",id:"from-the-release",level:3},{value:"From the command-line tool",id:"from-the-command-line-tool",level:3},{value:"From the source code",id:"from-the-source-code",level:3},{value:"From docker",id:"from-docker",level:3},{value:"Connection",id:"connection",level:2},{value:"General description of interactions",id:"general-description-of-interactions",level:2},{value:"Available commands",id:"available-commands",level:2},{value:"The <code>exit</code> command",id:"the-exit-command",level:3},{value:"Answer from gama-server",id:"answer-from-gama-server",level:4},{value:"The <code>load</code> command",id:"the-load-command",level:3},{value:"Answer from gama-server",id:"answer-from-gama-server-1",level:4},{value:"The <code>play</code> command",id:"the-play-command",level:3},{value:"Answer from gama-server",id:"answer-from-gama-server-2",level:4},{value:"The <code>pause</code> command",id:"the-pause-command",level:3},{value:"Answer from gama-server",id:"answer-from-gama-server-3",level:4},{value:"The <code>step</code> command",id:"the-step-command",level:3},{value:"Answer from gama-server",id:"answer-from-gama-server-4",level:4},{value:"The <code>stepBack</code> command",id:"the-stepback-command",level:3},{value:"Answer from gama-server",id:"answer-from-gama-server-5",level:4},{value:"The <code>stop</code> command",id:"the-stop-command",level:3},{value:"Answer from gama-server",id:"answer-from-gama-server-6",level:4},{value:"The <code>reload</code> command",id:"the-reload-command",level:3},{value:"Answer from gama-server",id:"answer-from-gama-server-7",level:4},{value:"The <code>expression</code> command",id:"the-expression-command",level:3},{value:"Answer from gama-server",id:"answer-from-gama-server-8",level:4},{value:"Gama-server messages",id:"gama-server-messages",level:2},{value:"Messages types",id:"messages-types",level:3},{value:"Connection related answers",id:"connection-related-answers",level:3},{value:"Command answers",id:"command-answers",level:3},{value:"errors and exceptions",id:"errors-and-exceptions",level:3},{value:"Simulations outputs",id:"simulations-outputs",level:3},{value:"Python wrapper",id:"python-wrapper",level:2},{value:"Javascript Client",id:"javascript-client",level:2},{value:"Hello World Visualization in MapBox",id:"hello-world-visualization-in-mapbox",level:3},{value:"Hello World Message example",id:"hello-world-message-example",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"crash on <code>load</code> command",id:"crash-on-load-command",level:4}],c={toc:p},u="wrapper";function h(e){var a=e.components,t=(0,o.Z)(e,i);return(0,r.kt)(u,(0,n.Z)({},c,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"running-a-gama-headless-server"},"Running a Gama Headless server:"),(0,r.kt)("p",null,"Before doing anything, make sure that you possess the rights to create files and directories at the location you are running gama-server because it will need it to create workspaces on the fly."),(0,r.kt)("h3",{id:"from-the-release"},"From the release"),(0,r.kt)("p",null,"Go to the ",(0,r.kt)("inlineCode",{parentName:"p"},"headless")," directory in your Gama installation folder and run the script ",(0,r.kt)("inlineCode",{parentName:"p"},"gama-headless.sh")," (or ",(0,r.kt)("inlineCode",{parentName:"p"},"gama-headless.bat"),") with the argument ",(0,r.kt)("inlineCode",{parentName:"p"},"-socket")," followed by the port number you want your Gama server to run on."),(0,r.kt)("p",null,"For example on Mac OS you could do:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd Gama.app/Contents/headless\n")),(0,r.kt)("p",null,"to move to the right directory, then run the script to listen on port ",(0,r.kt)("inlineCode",{parentName:"p"},"6868")," with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"gama-headless.sh -socket 6868\n")),(0,r.kt)("h3",{id:"from-the-command-line-tool"},"From the command-line tool"),(0,r.kt)("p",null,"The users who installed gama through a ",(0,r.kt)("inlineCode",{parentName:"p"},".deb")," file or ",(0,r.kt)("inlineCode",{parentName:"p"},"aur")," have access to the command ",(0,r.kt)("inlineCode",{parentName:"p"},"gama-headless")," and thus only need to open a terminal and run "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"gama-headless -socket 6868\n")),(0,r.kt)("p",null,"to run a Gama server on the port ",(0,r.kt)("inlineCode",{parentName:"p"},"6868"),". "),(0,r.kt)("h3",{id:"from-the-source-code"},"From the source code"),(0,r.kt)("p",null,"In Eclipse, instantiate a headless server by running ",(0,r.kt)("inlineCode",{parentName:"p"},"msi.gama.headless.id4_full")," with the following argument ",(0,r.kt)("inlineCode",{parentName:"p"},"-os ${target.os} -ws ${target.ws} -arch ${target.arch} -nl ${target.nl} -socket 6868")," (you can specify any other port)"),(0,r.kt)("h3",{id:"from-docker"},"From docker"),(0,r.kt)("p",null,"First ensure to pull the official docker image "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull gamaplatform/gama:<version>\n")),(0,r.kt)("p",null,"Then, run the container with the image you just pulled."),(0,r.kt)("p",null,"Do not forget to (1) expose the port you're starting your server on, and (2) mount your workspace inside the started container as below :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -v <path/to/your/workspace>:/working_dir -p 6868:6868 gamaplatform/gama:<version> -socket 6868\n")),(0,r.kt)("p",null,"For more informations, please refer to ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/commandline/run/"},"Docker's official documentation")," or ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gama-platform/gama.docker"},"GAMA image's repository"),"."),(0,r.kt)("h2",{id:"connection"},"Connection"),(0,r.kt)("p",null,"To connect to gama-server as a client you just need to access the following address: ",(0,r.kt)("inlineCode",{parentName:"p"},"ws://<ip>:<port>"),". For example if you try to connect to a gama-server running on your current computer and started with the command ",(0,r.kt)("inlineCode",{parentName:"p"},"gama-headless -socket 6868"),", you will have to connect to ",(0,r.kt)("inlineCode",{parentName:"p"},"ws://localhost:6868"),"."),(0,r.kt)("p",null,"Once a client is connected, gama-server will send a json object of type ",(0,r.kt)("inlineCode",{parentName:"p"},"ConnectionSuccessful"),"."),(0,r.kt)("h2",{id:"general-description-of-interactions"},"General description of interactions"),(0,r.kt)("p",null,"Once connected, you can ask gama-server to execute different commands to control the execution of different simulations. "),(0,r.kt)("p",null,"If you close your client application (or just close the socket on client-side) ",(0,r.kt)("strong",{parentName:"p"},"gama-server will destroy all running simulations")," of that client, so you have to keep your client alive. "),(0,r.kt)("p",null,"For every command treated by gama-server, it will send back a json object describing if the command has been executed correctly or if there was a problem. If an unexpected exception is raised in gama-server, it will try to send the connected clients a json-object describing it.\nThe same goes if a simulation throws an exception/error while running, the client that asked for it to run will receive it as a json-object. "),(0,r.kt)("p",null,"In addition, the client can ask gama-server to receive (or not) the different outputs of a simulation: ",(0,r.kt)("inlineCode",{parentName:"p"},"write")," statements, dialogs, status-bar changes etc. they will be sent as they come, in a specific json wrapper."),(0,r.kt)("h2",{id:"available-commands"},"Available commands"),(0,r.kt)("p",null,"All the commands sent to gama-server must be formatted as a ",(0,r.kt)("inlineCode",{parentName:"p"},"json")," object. "),(0,r.kt)("p",null,"The available commands are:"),(0,r.kt)("h3",{id:"the-exit-command"},"The ",(0,r.kt)("inlineCode",{parentName:"h3"},"exit")," command"),(0,r.kt)("p",null,"This command is used to kill gama-server.\nIt is triggered by sending a json object formatted as follows to the server"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "type": "exit"\n}\n')),(0,r.kt)("h4",{id:"answer-from-gama-server"},"Answer from gama-server"),(0,r.kt)("p",null,"It is the only command that won't send back a json object."),(0,r.kt)("h3",{id:"the-load-command"},"The ",(0,r.kt)("inlineCode",{parentName:"h3"},"load")," command"),(0,r.kt)("p",null,"This command is used to ask the server to initialize a specific experiment in a gaml file on the server's file-system.\nIt is triggered by sending a json object formatted as follows to the server:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "type": "load",\n  "model": "<gaml_file_path>",\n  "experiment": "<experiment_name>",\n  "console": "<console>", //optional\n  "status": "<status>", //optional\n  "dialog": "<dialog>", //optional\n  "parameters": "<params>", //optional\n  "until": "<end_condition>", //optional\n}\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"model")," parameter indicates the path of the experiment file on the server's file-system, and ",(0,r.kt)("inlineCode",{parentName:"p"},"experiment")," is the actual name of the experiment to run.\nThe three parameters ",(0,r.kt)("inlineCode",{parentName:"p"},"console"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"status")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"dialog")," are booleans used to set if the messages from respectively the console, the status-bar and the dialogs should be redirected to the client. They are optional as per default ",(0,r.kt)("inlineCode",{parentName:"p"},"console")," is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," and the two others to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),".\nYou can add an array of parameters that will be used to initialize the experiment's variables with the values you picked.\nThe value of ",(0,r.kt)("inlineCode",{parentName:"p"},"parameters")," should be formatted as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'[\n  {\n    "type": "<type of the first parameter>",\n    "value": "<value of the first parameter>",\n    "name": "<name of the first parameter in the gaml file>"\n  },\n  {\n    "type": "<type of the second parameter>",\n    "value": "<value of the second parameter>",\n    "name": "<name of the second parameter in the gaml file>"\n  },\n ...\n]\n')),(0,r.kt)("p",null,"You can also add an ending condition to your simulation with the parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"until"),", the condition must be expressed in gaml."),(0,r.kt)("h4",{id:"answer-from-gama-server-1"},"Answer from gama-server"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," field of the response json sent by gama-server after processing this command will directly contain the ",(0,r.kt)("inlineCode",{parentName:"p"},"experiment_id")," value stored as a string.\nThe experiment id should be used in all the other commands to refer to that specific experiment in order to control it."),(0,r.kt)("h3",{id:"the-play-command"},"The ",(0,r.kt)("inlineCode",{parentName:"h3"},"play")," command"),(0,r.kt)("p",null,"This command is used to actually run an experimented already initialized.\nIt is triggered by sending a json object formatted as follows to the server"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "type": "play",\n  "exp_id": "<experiment_id>",\n  "sync": "<synchronized>", //optional\n}\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"experiment_id")," is used to identify the experiment to play, and the optional ",(0,r.kt)("inlineCode",{parentName:"p"},"sync")," is a boolean used in the case where there was an end condition defined in the ",(0,r.kt)("inlineCode",{parentName:"p"},"load")," command, if it is true, gama-server will not send a response to the command, but only a end of simulation message once the condition is reached, if it's false gama-server will send both the response to the command and the ",(0,r.kt)("inlineCode",{parentName:"p"},"SimulationEnded")," message."),(0,r.kt)("h4",{id:"answer-from-gama-server-2"},"Answer from gama-server"),(0,r.kt)("p",null,"This command has an empty ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," field in the response json sent by gama-server after processing it.\nIn case where the end condition is reached, a message of type ",(0,r.kt)("inlineCode",{parentName:"p"},"SimulationEnded")," is sent to the client with an empty ",(0,r.kt)("inlineCode",{parentName:"p"},"content"),"."),(0,r.kt)("h3",{id:"the-pause-command"},"The ",(0,r.kt)("inlineCode",{parentName:"h3"},"pause")," command"),(0,r.kt)("p",null,"This command is used to pause a running experiment.\nIt is triggered by sending a json object formatted as follows to the server"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "type": "pause",\n  "exp_id": "<experiment_id>"\n}\n')),(0,r.kt)("h4",{id:"answer-from-gama-server-3"},"Answer from gama-server"),(0,r.kt)("p",null,"This command has an empty ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," field in the response json sent by gama-server after processing it."),(0,r.kt)("h3",{id:"the-step-command"},"The ",(0,r.kt)("inlineCode",{parentName:"h3"},"step")," command"),(0,r.kt)("p",null,"This command is used to process one (or a defined number of) step(s) of a simulation that has already been loaded.\nIt is triggered by sending a json object formatted as follows to the server"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "type": "step",\n  "exp_id": "<experiment_id>",\n  "nb_step": "<number_of_steps>", //optional\n  "sync": "<synchronized>", // optional\n}\n')),(0,r.kt)("p",null,"As usual ",(0,r.kt)("inlineCode",{parentName:"p"},"exp_id")," refers to the experiment you want to apply the command to. The ",(0,r.kt)("inlineCode",{parentName:"p"},"nb_step")," parameter indicates how many steps you want to execute, if you do not give that parameter gama-server will execute one step. The ",(0,r.kt)("inlineCode",{parentName:"p"},"sync")," parameter indicates whether gama-server must wait for the end of the step(s) to send back a success message (when its value is true), or just plan the step(s) and send one directly after (when its value is false), this parameter can be ignored and will be interpreted as if it were ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),". "),(0,r.kt)("h4",{id:"answer-from-gama-server-4"},"Answer from gama-server"),(0,r.kt)("p",null,"This command has an empty ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," field in the response json sent by gama-server after processing it."),(0,r.kt)("h3",{id:"the-stepback-command"},"The ",(0,r.kt)("inlineCode",{parentName:"h3"},"stepBack")," command"),(0,r.kt)("p",null,"This command is used to rollback the simulation one (or a defined number of) step(s) back. This command only works on experiments of type ",(0,r.kt)("inlineCode",{parentName:"p"},"memorize"),".\nIt is triggered by sending a json object formatted as follows to the server"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "type": "stepBack",\n  "exp_id": "<experiment_id>",\n  "nb_step": "<number_of_steps>", //optional\n  "sync": "<synchronized>", // optional\n}\n')),(0,r.kt)("p",null,"The parameters are exactly the same as in the ",(0,r.kt)("inlineCode",{parentName:"p"},"step")," command."),(0,r.kt)("h4",{id:"answer-from-gama-server-5"},"Answer from gama-server"),(0,r.kt)("p",null,"This command has an empty ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," field in the response json sent by gama-server after processing it."),(0,r.kt)("h3",{id:"the-stop-command"},"The ",(0,r.kt)("inlineCode",{parentName:"h3"},"stop")," command"),(0,r.kt)("p",null,"This command is used to stop (kill) a running experiment.\nIt is triggered by sending a json object formatted as follows to the server"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "type": "stop",\n  "exp_id": "<experiment_id>",\n}\n')),(0,r.kt)("h4",{id:"answer-from-gama-server-6"},"Answer from gama-server"),(0,r.kt)("p",null,"This command has an empty ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," field in the response json sent by gama-server after processing it."),(0,r.kt)("h3",{id:"the-reload-command"},"The ",(0,r.kt)("inlineCode",{parentName:"h3"},"reload")," command"),(0,r.kt)("p",null,"This command is used to reload an experiment. The experiment will be stop and the initialization process run again. You can use this command to change the simulation parameters or the ending condition.\nIt is triggered by sending a json object formatted as follows to the server"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "type": "reload",\n  "exp_id": "<experiment_id>",\n  "parameters": "<params>", //optional\n  "until": "<end_condition>", //optional\n}\n')),(0,r.kt)("p",null,"Just like for the ",(0,r.kt)("inlineCode",{parentName:"p"},"load")," command, the ",(0,r.kt)("inlineCode",{parentName:"p"},"parameters")," and the ",(0,r.kt)("inlineCode",{parentName:"p"},"until")," parameters are optional and must follow the same formatting."),(0,r.kt)("h4",{id:"answer-from-gama-server-7"},"Answer from gama-server"),(0,r.kt)("p",null,"This command has an empty ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," field in the response json sent by gama-server after processing it."),(0,r.kt)("h3",{id:"the-expression-command"},"The ",(0,r.kt)("inlineCode",{parentName:"h3"},"expression")," command"),(0,r.kt)("p",null,"This command is used to ask the server to evaluate a ",(0,r.kt)("inlineCode",{parentName:"p"},"gaml")," expression having an experiment as context.",(0,r.kt)("br",{parentName:"p"}),"\n","It is triggered by sending a json object formatted as follows to the server"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "type": "expression",\n  "exp_id": "<experiment_id>",\n  "expr": "<expression to evaluate>"\n}\n')),(0,r.kt)("p",null,"For example if you want to know the number of agents of species ",(0,r.kt)("inlineCode",{parentName:"p"},"people")," currently present in the simulation represented by the id ",(0,r.kt)("inlineCode",{parentName:"p"},"123"),", you could send this command to gama-server:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "type": "expression",\n  "exp_id": "123",\n  "expr": "length(people)"\n}\n')),(0,r.kt)("h4",{id:"answer-from-gama-server-8"},"Answer from gama-server"),(0,r.kt)("p",null,"If the command is executed successfully by gama-server the ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," field of the response json will directly contain the result of the evaluated expression as a string."),(0,r.kt)("h2",{id:"gama-server-messages"},"Gama-server messages"),(0,r.kt)("p",null,"All messages send by gama-server follow a json architecture that is formatted as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "type": "some string describing the type of message",\n  "content": "a field containing everything additional information for the message", //It can be a string, an int or a json object\n  "exp_id": "contains the experiment id (as a string) to which this message is linked to", //Optional, its presence depends on the message\'s type\n  "command": "a json containing the original command to which gama is responding",//Optional, is only present in messages responding directly to a command sent by the client\n}\n')),(0,r.kt)("h3",{id:"messages-types"},"Messages types"),(0,r.kt)("p",null,"All messages have in common a ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," field that informs the client of the type of message sent.\nThe different types possibles are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ConnectionSuccessful"),": Used when a client connected without any problem to gama-server"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SimulationStatus"),": Signals a message representing a simulation status"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SimulationStatusInform"),": Signals a message representing a simulation inform status"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SimulationStatusError"),": Signals a message representing a simulation error status"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SimulationStatusNeutral"),": Signals a message representing a simulation neutral status"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SimulationOutput"),": Signals a message as would be written in the console by a ",(0,r.kt)("inlineCode",{parentName:"li"},"write")," statement in gama with an interface"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SimulationDebug"),": Signals a message as would be written in the console by a ",(0,r.kt)("inlineCode",{parentName:"li"},"debug")," statement in gama with an interface"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SimulationDialog"),": Signals a message representing what would be a dialog in gama with an interface"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SimulationErrorDialog"),": Signals a message representing what would be an dialog in gama with an interface"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SimulationError"),": Signals a message representing an error raised in a running simulation"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"RuntimeError"),": Signals a message representing an exception raised in gama-server while trying to process a command"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"GamaServerError"),": Signals a message representing an unknown exception raised in gama-server (can be unrelated to any command)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"MalformedRequest"),": Signals that a command sent by the client doesn't follow the expected format (lack of parameter, wrong type etc.)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CommandExecutedSuccessfully"),": Signals that a command sent by the client was executed without any problem on gama-server"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SimulationEnded"),": Signals that a running simulation ",(0,r.kt)("strong",{parentName:"li"},"reached its end condition")," and stopped. Beware if the simulation stops for another reason, this message won't be send."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"UnableToExecuteRequest"),": Signals that a command cannot be executed, though it may be formatted correctly. It mainly occurs when trying to execute a command on a simulation that is not currently running.")),(0,r.kt)("h3",{id:"connection-related-answers"},"Connection related answers"),(0,r.kt)("p",null,"When your client is connected correctly to gama-server, a message is sent. Its ",(0,r.kt)("strong",{parentName:"p"},"type")," is ",(0,r.kt)("inlineCode",{parentName:"p"},"ConnectionSuccessful")," with an empty content.\nIn case of problem, the client may receive a message of ",(0,r.kt)("strong",{parentName:"p"},"type")," ",(0,r.kt)("inlineCode",{parentName:"p"},"GamaServerError")," or just get a timeout/broken connection message at the socket level."),(0,r.kt)("h3",{id:"command-answers"},"Command answers"),(0,r.kt)("p",null,"For every command described in the ",(0,r.kt)("a",{parentName:"p",href:"#available-commands"},"commands section"),", the client will received a json answer formatted as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "type": "some string describing the type of message",\n  "content": "a field containing every additional information for the message", //It can be a string, an int or a json object, depending on the type of message, it could also be empty\n  "command": "a json containing the original command to which gama is responding"\n}\n')),(0,r.kt)("p",null,"So for example if you send an expression command to gama, with an ",(0,r.kt)("inlineCode",{parentName:"p"},"experiment_id")," of value ",(0,r.kt)("strong",{parentName:"p"},"2")," and you want to evaluate the expression ",(0,r.kt)("inlineCode",{parentName:"p"},"length(people)")," to know the number of agent ",(0,r.kt)("strong",{parentName:"p"},"people")," in that simulation. You may receive an answer looking like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "type": "CommandExecutedSuccessfully", //The type indicates that everything went normally\n  "content": 102, //There are 102 agents of the species people in your simulation at the time of evaluation\n  "command": //The description of the command you sent, as interpreted by gama-server and turned into a json\n  {\n    "type": "expression",\n    "exp_id": "2",\n    "expr": "length(people)",\n  }\n}\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"command")," field is very useful for clients that run multiple simulations and commands at the same time, as it can be used to retrace which command the message responds to.\n",(0,r.kt)("strong",{parentName:"p"},"Note"),": The ",(0,r.kt)("inlineCode",{parentName:"p"},"command")," field contains all the parameters of the command sent by the client, including those that are not useful for GAMA to execute the command, you can thus use it to store more data, like an internal id used by the client, some kind of counter etc.. "),(0,r.kt)("p",null,"In case there is an error resulting from the processing of your command, you may receive an error message of type:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"MalformedRequest")," if you forgot a mandatory parameter to execute the command or gave objects that couldn't be de-serialized. The list of required parameters will be sent as a string in the ",(0,r.kt)("inlineCode",{parentName:"li"},"content")," field."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"UnableToExecuteRequest"),' if you are trying to execute a command on a simulation that is not currently running or some other problem of "logic". You will find more informations in the ',(0,r.kt)("inlineCode",{parentName:"li"},"content")," field."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"RuntimeError")," and ",(0,r.kt)("strong",{parentName:"li"},"GamaServerError")," if while executing your command, an exception happens, either in gaml code for ",(0,r.kt)("strong",{parentName:"li"},"RuntimeError")," or in gama's code for ",(0,r.kt)("strong",{parentName:"li"},"GamaServerError"),". The exception's description will be given in the ",(0,r.kt)("inlineCode",{parentName:"li"},"content")," field, as a json object containing the error message and the stack trace.")),(0,r.kt)("p",null,"There is no ",(0,r.kt)("inlineCode",{parentName:"p"},"exp_id")," field in those messages, because it is already included in all the ",(0,r.kt)("inlineCode",{parentName:"p"},"command")," fields that are related to an experiment."),(0,r.kt)("h3",{id:"errors-and-exceptions"},"errors and exceptions"),(0,r.kt)("p",null,"In addition to the error messages you can receive when directly requesting to execute a command (",(0,r.kt)("inlineCode",{parentName:"p"},"MalformedRequest"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"UnableToExecuteRequest"),") described in the ",(0,r.kt)("a",{parentName:"p",href:"#command-answers"},"command answers")," section, or the network errors that can be raised for external problems, it is possible that gama-server encounters an exception while running. In that case gama-server will send a json message formatted as described in the ",(0,r.kt)("a",{parentName:"p",href:"#gama-server-messages"},"Gama-server messages")," section, the two different types would either be ",(0,r.kt)("inlineCode",{parentName:"p"},"GamaServerError"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"RuntimeError")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"SimulationError")," and the ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," field would be filled as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "exception": "The java class of the exception",\n  "message": "The message describing the problem",\n  "stack": [],//The stack trace of the exception given as a list of strings\n}\n')),(0,r.kt)("p",null,"the ",(0,r.kt)("inlineCode",{parentName:"p"},"exp_id")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"command")," fields would be present if possible, depending on where the exception happens."),(0,r.kt)("h3",{id:"simulations-outputs"},"Simulations outputs"),(0,r.kt)("p",null,"As mentioned in the ",(0,r.kt)("a",{parentName:"p",href:"#general-description-of-interactions"},"introduction")," and the description of the ",(0,r.kt)("a",{parentName:"p",href:"#the-load-command"},"load command"),". You can ask gama-server to redirect the simulation's outputs. There are 3 different types of output produced by a simulation that you can chose to redirect or not:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the messages in the dialogs"),(0,r.kt)("li",{parentName:"ul"},"the messages in the status-bar"),(0,r.kt)("li",{parentName:"ul"},"the messages in the gama console\nEach has an associated boolean that you have to set to ",(0,r.kt)("inlineCode",{parentName:"li"},"true")," in the ",(0,r.kt)("a",{parentName:"li",href:"#the-load-command"},"load command")," in order to have it redirected to the client.")),(0,r.kt)("p",null,"The output messages are sent directly to the client as soon as they are asked by the simulation. The format of the output messages follows the usual ",(0,r.kt)("a",{parentName:"p",href:"#gama-server-messages"},"message format"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"exp_id")," will always be filled with the current experiment id, the 'command' field won't be present.\nThe different types of messages possible are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"for dialog messages: ",(0,r.kt)("inlineCode",{parentName:"li"},"SimulationDialog")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"SimulationErrorDialog")," respectively for normal dialogs and error dialogs"),(0,r.kt)("li",{parentName:"ul"},"for status messages: ",(0,r.kt)("inlineCode",{parentName:"li"},"SimulationStatusNeutral"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"SimulationStatusError"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"SimulationStatusInform"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"SimulationStatus")),(0,r.kt)("li",{parentName:"ul"},"for console messages: ",(0,r.kt)("inlineCode",{parentName:"li"},"SimulationOutput")," for the messages written with the ",(0,r.kt)("inlineCode",{parentName:"li"},"write")," statement and ",(0,r.kt)("inlineCode",{parentName:"li"},"SimulationDebug")," for the ones written with the ",(0,r.kt)("inlineCode",{parentName:"li"},"debug")," statement.")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," field will be formatted as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"for dialog messages, it's directly a string containing the message"),(0,r.kt)("li",{parentName:"ul"},"for status messages: ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "message": "the status message",\n  "icon": "the name/path of the associated icon", //only present for some SimulationStatus and SimulationStatusInform messages\n  "color": \n  {\n    "r": "red value", \n    "g": "green value", \n    "b": "blue value",\n  }, // The background color in the status-bar, only present in some SimulationStatus messages\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"for console messages:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "message": "the message as it would be written in the console",\n  "color": \n  {\n    "r": red_value, \n    "g": green_value, \n    "b": blue value,\n  }, // The text color\n  "cycle": simulation_cycle, // the cycle of the simulation at the moment the debug statement is executed, only for SimulationDebug messages\n}\n')),(0,r.kt)("h2",{id:"python-wrapper"},"Python wrapper"),(0,r.kt)("p",null,"A python package is available to interact with Gama server as a client, you can find it ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gama-platform/Gama-client-python"},"here"),". It will take care of formatting the queries to the server and receiving the answers. You simply have to install the package into your python environment with the command ",(0,r.kt)("inlineCode",{parentName:"p"},"pip install gama-client")," and then import ",(0,r.kt)("inlineCode",{parentName:"p"},"gama_client")," into your python files. For more information follow the ",(0,r.kt)("inlineCode",{parentName:"p"},"README.md")," available on the package's github."),(0,r.kt)("h2",{id:"javascript-client"},"Javascript Client"),(0,r.kt)("p",null,"There is also a javascript client being developed in this repository ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gama-platform/gama.client"},"gama.client")),(0,r.kt)("h3",{id:"hello-world-visualization-in-mapbox"},"Hello World Visualization in MapBox"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Clone the repository ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/gama-platform/gama.client"},"gama.client")),(0,r.kt)("li",{parentName:"ul"},"In ",(0,r.kt)("inlineCode",{parentName:"li"},"js/gama_client.js")," edit the following variable ",(0,r.kt)("inlineCode",{parentName:"li"},"ABSOLUTE_PATH_TO_GAMA")," to your local path (e.g ",(0,r.kt)("inlineCode",{parentName:"li"},"var ABSOLUTE_PATH_TO_GAMA = '/Users/arno/';"),") "),(0,r.kt)("li",{parentName:"ul"},"open ",(0,r.kt)("inlineCode",{parentName:"li"},"index.html"),"in a browser")),(0,r.kt)("h3",{id:"hello-world-message-example"},"Hello World Message example"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In ",(0,r.kt)("inlineCode",{parentName:"li"},"js/simple_syntax.js")," edit the following variable ",(0,r.kt)("inlineCode",{parentName:"li"},"modelPath")," to your model's path "),(0,r.kt)("li",{parentName:"ul"},"open ",(0,r.kt)("inlineCode",{parentName:"li"},"syntax.html"),"in a browser")),(0,r.kt)("h3",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("h4",{id:"crash-on-load-command"},"crash on ",(0,r.kt)("inlineCode",{parentName:"h4"},"load")," command"),(0,r.kt)("p",null,"It is possible that gama-server starts and accepts connections, but crashes when receiving a ",(0,r.kt)("inlineCode",{parentName:"p"},"load")," command with a message of the type:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"java.lang.Exception: java.lang.NoClassDefFoundError: org/eclipse/core/resources/ResourcesPlugin\n        at org.java_websocket.server.WebSocketServer$WebSocketWorker.run(WebSocketServer.java:1093)\nCaused by: java.lang.NoClassDefFoundError: org/eclipse/core/resources/ResourcesPlugin\n        at msi.gama.lang.gaml.indexer.GamlResourceIndexer.<clinit>(GamlResourceIndexer.java:54)\n        at msi.gama.lang.gaml.resource.GamlResource.doLinking(GamlResource.java:362)\n        at org.eclipse.xtext.resource.XtextResource.updateInternalState(XtextResource.java:304)\n        at org.eclipse.xtext.resource.XtextResource.updateInternalState(XtextResource.java:292)\n        at msi.gama.lang.gaml.resource.GamlResource.updateInternalState(GamlResource.java:308)\n        at org.eclipse.xtext.resource.XtextResource.doLoad(XtextResource.java:182)\n        at org.eclipse.xtext.linking.lazy.LazyLinkingResource.doLoad(LazyLinkingResource.java:115)\n        at org.eclipse.emf.ecore.resource.impl.ResourceImpl.load(ResourceImpl.java:1563)\n        at org.eclipse.emf.ecore.resource.impl.ResourceImpl.load(ResourceImpl.java:1342)\n        at org.eclipse.emf.ecore.resource.impl.ResourceSetImpl.demandLoad(ResourceSetImpl.java:259)\n        at org.eclipse.emf.ecore.resource.impl.ResourceSetImpl.demandLoadHelper(ResourceSetImpl.java:274)\n        at org.eclipse.xtext.resource.XtextResourceSet.getResource(XtextResourceSet.java:266)\n        at org.eclipse.xtext.resource.SynchronizedXtextResourceSet.getResource(SynchronizedXtextResourceSet.java:33)\n        at msi.gama.lang.gaml.validation.GamlModelBuilder.buildModelDescription(GamlModelBuilder.java:111)\n        at msi.gama.lang.gaml.validation.GamlModelBuilder.compile(GamlModelBuilder.java:97)\n        at msi.gama.headless.core.HeadlessSimulationLoader.loadModel(HeadlessSimulationLoader.java:155)\n        at msi.gama.headless.core.HeadlessSimulationLoader.loadModel(HeadlessSimulationLoader.java:126)\n        at msi.gama.headless.job.JobListFactory.constructAllJobs(JobListFactory.java:46)\n        at msi.gama.headless.script.ExperimentationPlanFactory.buildExperiment(ExperimentationPlanFactory.java:183)\n        at msi.gama.headless.listener.LoadCommand.launchGamlSimulation(LoadCommand.java:74)\n        at msi.gama.headless.listener.LoadCommand.execute(LoadCommand.java:37)\n        at msi.gama.headless.listener.LoadCommand.execute(LoadCommand.java:1)\n        at msi.gama.headless.listener.CommandExecutor.process(CommandExecutor.java:43)\n        at msi.gama.headless.listener.GamaWebSocketServer.onMessage(GamaWebSocketServer.java:209)\n        at org.java_websocket.server.WebSocketServer.onWebsocketMessage(WebSocketServer.java:712)\n        at org.java_websocket.drafts.Draft_6455.processFrameText(Draft_6455.java:986)\n        at org.java_websocket.drafts.Draft_6455.processFrame(Draft_6455.java:910)\n...\n")),(0,r.kt)("p",null,"This issue arises because gama-server tries to create a workspace for your experiment but does not have the appropriate rights to do it.\nIt can be the case in windows if you run gama-server directly from the ",(0,r.kt)("inlineCode",{parentName:"p"},"headless")," directory from the installation folder (protected by default) and that you are not an Admin"))}h.isMDXComponent=!0}}]);