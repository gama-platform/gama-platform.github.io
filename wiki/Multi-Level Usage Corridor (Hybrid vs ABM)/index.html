<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Corridor Multi-Level Architecture with Mathematics Model and Agent Based Model · GAMA-Platform</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="[//]: # (keyword|operator_at_location)"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Corridor Multi-Level Architecture with Mathematics Model and Agent Based Model · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gama-platform.org/"/><meta property="og:description" content="[//]: # (keyword|operator_at_location)"/><meta property="og:image" content="https://gama-platform.org//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gama-platform.org//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://gama-platform.org/blog/atom.xml" title="GAMA-Platform Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://gama-platform.org/blog/feed.xml" title="GAMA-Platform Blog RSS Feed"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/searchEngine.js"></script><script type="text/javascript" src="/js/dark.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/gama-logo.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/wiki/Home" target="_self">Documentation</a></li><li class=""><a href="/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="/faq" target="_self">FAQ</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Corridor Multi-Level Architecture with Mathematics Model and Agent Based Model</h1></header><article><div><span><p>_Author : _</p>
<p>This model shows how to use multi-level architecture. Two corridors are presented : one which can capture the pedestrians going through it and computing for them the time before releasing them at the end of the corridor, and an other doing nothing, letting the pedestrians moving by themselves in the corridor.</p>
<p>Code of the model :</p>
<pre><code class="hljs">
<span class="hljs-builtin">model</span> pedestrian_corridor_Hybrid_vs_ABM

global 
{
    
    <span class="hljs-comment">//Parameters of the environment</span>
    <span class="hljs-literal">int</span> environment_width &lt;- 200 <span class="hljs-symbol">const:</span> true;
    <span class="hljs-literal">int</span> environment_height &lt;- 200 <span class="hljs-symbol">const:</span> true;
    <span class="hljs-literal">geometry</span> shape &lt;- rectangle(environment_width, environment_height); 
    
    
    <span class="hljs-comment">//Parameters of the pedestrian agents</span>
    <span class="hljs-literal">rgb</span> pedestrian_green &lt;- #green;
    
    <span class="hljs-literal">float</span> pedestrian_size &lt;- 1.0;
    <span class="hljs-literal">geometry</span> pedestrian_shape &lt;- circle (pedestrian_size) ;
    <span class="hljs-literal">float</span> pedestrian_speed &lt;- 2.0;
 
    <span class="hljs-comment">//Parameters of the corridors</span>
    <span class="hljs-literal">rgb</span> corridor_color &lt;- <span class="hljs-literal">rgb</span> (<span class="hljs-string">'blue'</span>);
    <span class="hljs-literal">int</span> corridor_width &lt;- 160 <span class="hljs-symbol">depends_on:</span> [environment_width];
    <span class="hljs-literal">int</span> corridor_height &lt;- (<span class="hljs-literal">int</span>(environment_height * 0.05));

    <span class="hljs-literal">point</span> corridor_location_0 &lt;- {environment_width / 2, environment_height / 4};
    <span class="hljs-literal">geometry</span> corridor_shape_0 &lt;- ( (rectangle ({corridor_width, corridor_height})) at_location corridor_location_0) ;

    <span class="hljs-literal">point</span> corridor_location_1 &lt;- {environment_width / 2, environment_height * 0.75};
    <span class="hljs-literal">geometry</span> corridor_shape_1 &lt;- ( (rectangle ({corridor_width, corridor_height})) at_location corridor_location_1) ;

    <span class="hljs-comment">//Parameters of pedestrian generation</span>
    <span class="hljs-literal">int</span> new_pedestian_generate_frequency &lt;- 8;
    <span class="hljs-literal">point</span> pedestrian_source_0 &lt;- {0, corridor_location_0.y} ;
    <span class="hljs-literal">point</span> pedestrian_source_1 &lt;- {0, corridor_location_1.y} ;
     
     
     
    init 
    {
        <span class="hljs-keyword">create</span> corridor <span class="hljs-symbol">number:</span> 2 <span class="hljs-symbol">returns:</span> new_corridors;
        
        <span class="hljs-keyword">ask</span> (new_corridors at 0) 
        {
            <span class="hljs-keyword">do</span> init_corridor <span class="hljs-symbol">corridor_shape:</span> corridor_shape_0 <span class="hljs-symbol">is_hybrid:</span> false;
        }

        <span class="hljs-keyword">ask</span> (new_corridors at 1) 
        {
            <span class="hljs-keyword">do</span> init_corridor <span class="hljs-symbol">corridor_shape:</span> corridor_shape_1 <span class="hljs-symbol">is_hybrid:</span> true; 
        }
    }

    <span class="hljs-comment">//Generation of pedestrians according to the frequency of generation : one for each corridor</span>
    <span class="hljs-builtin">reflex</span> generate_pedestrians <span class="hljs-symbol">when:</span> ( (cycle mod new_pedestian_generate_frequency) = 0 ) 
    { 
        <span class="hljs-keyword">create</span> pedestrian <span class="hljs-symbol">number:</span> 2 <span class="hljs-symbol">returns:</span> new_pedestrians;
        
        <span class="hljs-keyword">ask</span> (new_pedestrians at 0) 
        {
            <span class="hljs-keyword">do</span> init_location <span class="hljs-symbol">loc:</span> pedestrian_source_0;
        }
        
        <span class="hljs-keyword">ask</span> (new_pedestrians at 1) 
        {
            <span class="hljs-keyword">do</span> init_location <span class="hljs-symbol">loc:</span> pedestrian_source_1;
        }
    }   
}


<span class="hljs-comment">//Species for the pedestrians which can move</span>
<span class="hljs-literal">species</span> pedestrian <span class="hljs-symbol">skills:</span> [<span class="hljs-builtin">moving</span>] {
    <span class="hljs-literal">geometry</span> shape &lt;- circle(pedestrian_size);
    <span class="hljs-literal">rgb</span> color;
    corridor last_corridor;
    <span class="hljs-literal">point</span> target_location;
    <span class="hljs-literal">float</span> speed &lt;- pedestrian_speed;
    
    <span class="hljs-comment">//Initialisation of the target location according to its generation location</span>
    <span class="hljs-keyword">action</span> init_location (<span class="hljs-literal">point</span> loc) {
        location &lt;- loc;
        target_location &lt;- {environment_width, location.y};
        heading &lt;- self towards (target_location);
    }

    <span class="hljs-comment">//Reflex to move the agent to its target location and make it die once it reached its target</span>
    <span class="hljs-builtin">reflex</span> move_left 
    {
        <span class="hljs-keyword">do</span> move <span class="hljs-symbol">heading:</span> (self) towards (target_location); 
        
        <span class="hljs-keyword">if</span> ( (target_location.x - location.x) &lt;= speed ) 
        {
            <span class="hljs-keyword">do</span> die;
        }
    }
     
    <span class="hljs-keyword">aspect</span> <span class="hljs-keyword">default</span> 
    {
        <span class="hljs-keyword">draw</span> shape <span class="hljs-symbol">color:</span> color;
    }
}

<span class="hljs-comment">//Species for the corridor which can capture pedestrians</span>
<span class="hljs-literal">species</span> corridor  {
    <span class="hljs-literal">bool</span> capture_pedestrians;
    
    
    <span class="hljs-keyword">action</span> init_corridor (<span class="hljs-literal">geometry</span> corridor_shape, <span class="hljs-literal">bool</span> is_hybrid) 
    {
        shape &lt;- corridor_shape;
        capture_pedestrians &lt;- is_hybrid;
    }

    <span class="hljs-literal">float</span> max_speed &lt;- pedestrian_speed;
    <span class="hljs-literal">float</span> macro_length <span class="hljs-symbol">min:</span> 0.0 &lt;- <span class="hljs-literal">float</span>(corridor_width); <span class="hljs-comment">// the length of macro_patch</span>
    
    <span class="hljs-comment">//Species to model the pedestrian captured by the corridor</span>
    <span class="hljs-literal">species</span> captured_pedestrian <span class="hljs-symbol">parent:</span> pedestrian <span class="hljs-symbol">schedules:</span> [] 
    {
        <span class="hljs-literal">float</span> released_time;  
        
        <span class="hljs-keyword">aspect</span> <span class="hljs-keyword">default</span> { }
    }
    
    init 
    { 
        <span class="hljs-keyword">create</span> corridor_info_drawer <span class="hljs-symbol">number:</span> 1 <span class="hljs-symbol">with:</span> [target :: self];
    }
    <span class="hljs-comment">//Reflex to capture the pedestrians overlapping the corridor ie entering the corridor </span>
    <span class="hljs-builtin">reflex</span> aggregate <span class="hljs-symbol">when:</span> capture_pedestrians 
    {
        <span class="hljs-literal">list</span>&lt;pedestrian&gt; tobe_captured_pedestrians &lt;- (pedestrian overlapping shape) where ( (each.last_corridor != self) and ((each.location).x &lt; (self.location).x) ) ; 
        
        <span class="hljs-keyword">if</span> !(empty (tobe_captured_pedestrians)) 
        {
            <span class="hljs-keyword">capture</span> tobe_captured_pedestrians <span class="hljs-symbol">as:</span> captured_pedestrian <span class="hljs-symbol">returns:</span> cps { 
                last_corridor &lt;- myself;
            }
            <span class="hljs-keyword">if</span> !(empty (cps)) 
            {
                    <span class="hljs-comment">//Computation of the time when the pedestrians captured will be released according to the speed</span>
                    <span class="hljs-comment">// and the time they should make to pass the corridor if they move by themselves</span>
                    <span class="hljs-literal">float</span> group_outgoing_time &lt;- time + (corridor_width / (pedestrian_speed) ); 
                    <span class="hljs-keyword">loop</span> cp <span class="hljs-symbol">over:</span> cps 
                    {
                            cp.released_time &lt;- group_outgoing_time;
                    }
            }
        
        }
    }
    
    <span class="hljs-comment">//Reflex to release the pedestrians when we consider they were enough time inside the corridor </span>
    <span class="hljs-builtin">reflex</span> disaggregate  
    {
        <span class="hljs-literal">list</span> tobe_released_pedestrians &lt;- members where (time &gt;= (captured_pedestrian (each)).released_time);
        
        <span class="hljs-keyword">if</span> !(empty (tobe_released_pedestrians)) 
        {
            
            <span class="hljs-keyword">release</span> tobe_released_pedestrians <span class="hljs-symbol">as:</span> pedestrian <span class="hljs-symbol">in:</span> world <span class="hljs-symbol">returns:</span> released_pedestrians;
            
            <span class="hljs-keyword">loop</span> rp <span class="hljs-symbol">over:</span> released_pedestrians 
            {
                rp.speed &lt;- pedestrian_speed;
                rp.location &lt;- {((environment_width / 2) + (corridor_width / 2)), ((corridor_shape_1).location).y};
            }
        }
    }
        
    <span class="hljs-keyword">aspect</span> <span class="hljs-keyword">default</span> 
    {
        <span class="hljs-keyword">draw</span> shape <span class="hljs-symbol">color:</span> corridor_color;
    }
}
 
<span class="hljs-literal">species</span> corridor_info_drawer 
{
    corridor target;
    
    <span class="hljs-keyword">aspect</span> base 
    {
        <span class="hljs-keyword">if</span> target.capture_pedestrians 
        {
            <span class="hljs-keyword">draw</span> <span class="hljs-string">'Hybrid model (coupling: ABM and Mathematical Model)'</span> <span class="hljs-symbol">color:</span> #blue <span class="hljs-symbol">size:</span> 7 <span class="hljs-symbol">at:</span> {(target.location).x - 90, (target.location).y - 10};
            <span class="hljs-keyword">draw</span>  <span class="hljs-string">'Aggregated agents: '</span> + <span class="hljs-literal">string</span>(length(target.members)) <span class="hljs-symbol">color:</span> #black <span class="hljs-symbol">size:</span> 7 <span class="hljs-symbol">at:</span> {(target.location).x - 30, (target.location).y + 2};
        } 
        <span class="hljs-keyword">else</span> 
        {
            <span class="hljs-keyword">draw</span> <span class="hljs-string">'Agent-Based Model (ABM)'</span> <span class="hljs-symbol">color:</span> #blue <span class="hljs-symbol">size:</span> 7 <span class="hljs-symbol">at:</span> {(target.location).x - 40, (target.location).y - 10};
        }
    }
}

<span class="hljs-builtin">experiment</span> default_experiment <span class="hljs-symbol">type:</span> gui 
{
    <span class="hljs-keyword">output</span> 
    {
        <span class="hljs-keyword">display</span> default_display 
        {
            <span class="hljs-literal">species</span> pedestrian;
            <span class="hljs-literal">species</span> corridor <span class="hljs-symbol">transparency:</span> 0.8;
            <span class="hljs-literal">species</span> corridor_info_drawer <span class="hljs-symbol">aspect:</span> base;
        }
    }
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap" style="margin-bottom:0"><a href="/" class="nav-home"><img src="/img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://github.com/gama-platform"><i class="fab fa-github"></i> GitHub</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://gama-platform.github.io/blog/feed" target="_blank"><i class="fa fa-rss"></i> Blog RSS</a></div><div style="flex-grow:2"><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div style="color:hsla(0,0%,100%,.4);flex-grow:3"><h5>License</h5><p>Copyright (C) - 2022 GAMA-Platform.</p><p>Permission is granted to copy, distribute and/or modify this document under the terms of the GNU Free Documentation License, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.</p><p>A copy of the license is included <a href="https://github.com/gama-platform/gama/wiki/LICENSE.md" style="display:initial">here</a>, in the repository of the wiki content.</p></div></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.fbAsyncInit = function() {FB.init({appId:'524881055001796',xfbml:true,version:'v2.7'});};(function(d, s, id){var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) {return;}js = d.createElement(s); js.id = id;js.src = '//connect.facebook.net/en_US/sdk.js';fjs.parentNode.insertBefore(js, fjs);}(document, 'script','facebook-jssdk'));
                </script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'undefined',
                indexName: 'undefined',
                inputSelector: '#search_input_react'
              });
            </script></body></html>