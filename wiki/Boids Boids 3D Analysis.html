<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Boids 3D Analysis · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="[//]: # (keyword|operator_sin)"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Boids 3D Analysis · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gama-platform.github.io/"/><meta property="og:description" content="[//]: # (keyword|operator_sin)"/><meta property="og:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gama-platform.github.io//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://gama-platform.github.io/blog/atom.xml" title="GAMA-Platform Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://gama-platform.github.io/blog/feed.xml" title="GAMA-Platform Blog RSS Feed"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/searchEngine.js"></script><script type="text/javascript" src="/js/dark.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/gama-logo_white.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/wiki/Home" target="_self">Documentation</a></li><li class=""><a href="/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Boids 3D Analysis</h1></header><article><div><span><p>_Author : _</p>
<p>This model shows the movement of boids following a goal, and creating without their own volonty, a flock . Four experiments are proposed : start is the 3D display of the boids like a real world, trajectory_analysis like the name means is about the analysis of the trajectory of the boids, Space Time Cube adds two display to see the movement of the boids using the time as the z-axis, and the last one represents the differents camera available in GAMA.</p>
<p>Code of the model :</p>
<pre><code class="hljs"><span class="hljs-builtin">model</span> boids 

global <span class="hljs-symbol">torus:</span> torus_environment{ 
    <span class="hljs-comment">//Number of boids to represent</span>
    <span class="hljs-literal">int</span> number_of_agents <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Number of agents'</span> &lt;- 10 <span class="hljs-symbol">min:</span> 1 <span class="hljs-symbol">max:</span> 1000000;
    <span class="hljs-comment">//Number of obstacles to represent</span>
    <span class="hljs-literal">int</span> number_of_obstacles <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Number of obstacles'</span> &lt;- 4 <span class="hljs-symbol">min:</span> 0;
    <span class="hljs-comment">//Size of the boids</span>
    <span class="hljs-literal">int</span> boids_size <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Boids size'</span> &lt;- 20 <span class="hljs-symbol">min:</span> 1;
    <span class="hljs-comment">//Maximal speed allowed for the boids</span>
    <span class="hljs-literal">float</span> maximal_speed <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Maximal speed'</span> &lt;- 15.0 <span class="hljs-symbol">min:</span> 0.1 <span class="hljs-symbol">max:</span> 15.0;
    <span class="hljs-comment">//Speed radius</span>
    <span class="hljs-literal">float</span>  radius_speed <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'radius speed'</span> &lt;- 0.5 <span class="hljs-symbol">min:</span> 0.1;
    <span class="hljs-comment">//Cohesion factor of the boid group  in the range of a boid agent</span>
    <span class="hljs-literal">int</span> cohesion_factor <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Cohesion Factor'</span> &lt;- 200;
    <span class="hljs-comment">//Alignment factor used for the boid group in the range of a boid agent</span>
    <span class="hljs-literal">int</span> alignment_factor <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Alignment Factor'</span> &lt;- 100; 
    <span class="hljs-comment">//Minimal distance to move</span>
    <span class="hljs-literal">float</span> minimal_distance <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Minimal Distance'</span> &lt;- 10.0; 
    <span class="hljs-comment">//Maximal turn done by the boids</span>
    <span class="hljs-literal">int</span> maximal_turn <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Maximal Turn'</span> &lt;- 90 <span class="hljs-symbol">min:</span> 0 <span class="hljs-symbol">max:</span> 359; 
    
    <span class="hljs-comment">//Parameters of the environment and the simulations</span>
    <span class="hljs-literal">int</span> width_and_height_of_environment <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Width/Height of the Environment'</span> &lt;- 800;  
    <span class="hljs-literal">bool</span> torus_environment <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Toroidal Environment ?'</span> &lt;- false; 
    <span class="hljs-literal">bool</span> apply_cohesion &lt;- true <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Apply Cohesion ?'</span>;
    <span class="hljs-literal">bool</span> apply_alignment &lt;- true <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Apply Alignment ?'</span>;   
    <span class="hljs-literal">bool</span> apply_separation &lt;- true <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Apply Separation ?'</span>;   
    <span class="hljs-literal">bool</span> apply_goal &lt;- true <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Follow Goal ?'</span>; 
    <span class="hljs-literal">bool</span> apply_avoid &lt;- true <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Apply Avoidance ?'</span>;   
    <span class="hljs-literal">bool</span> apply_wind &lt;- true <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Apply Wind ?'</span>;     
    <span class="hljs-literal">bool</span> moving_obstacles &lt;- false <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Moving Obstacles ?'</span>;    
    <span class="hljs-literal">int</span> bounds &lt;- <span class="hljs-literal">int</span>(width_and_height_of_environment / 20); 
    <span class="hljs-comment">//Wind vector </span>
    <span class="hljs-literal">point</span> wind_vector &lt;- {0,0} <span class="hljs-symbol">parameter:</span> <span class="hljs-string">'Direction of the wind'</span>;  
    <span class="hljs-literal">int</span> goal_duration &lt;- 30 <span class="hljs-symbol">update:</span> (goal_duration - 1); 
    <span class="hljs-comment">//Goal location</span>
    <span class="hljs-literal">point</span> goal &lt;- {rnd (width_and_height_of_environment - 2) + 1, rnd (width_and_height_of_environment -2) + 1 }; 
    <span class="hljs-literal">list</span> images <span class="hljs-symbol">of:</span> image_file &lt;- [<span class="hljs-literal">file</span>(<span class="hljs-string">'../images/bird1.png'</span>),<span class="hljs-literal">file</span>(<span class="hljs-string">'../images/bird2.png'</span>),<span class="hljs-literal">file</span>(<span class="hljs-string">'../images/bird3.png'</span>)]; 
    <span class="hljs-literal">string</span> file_path_to_ocean &lt;- <span class="hljs-string">'../images/ocean.jpg'</span>;
    <span class="hljs-literal">int</span> xmin &lt;- bounds;    
    <span class="hljs-literal">int</span> ymin &lt;- bounds;  
    <span class="hljs-literal">int</span> xmax &lt;- (width_and_height_of_environment - bounds);    
    <span class="hljs-literal">int</span> ymax &lt;- (width_and_height_of_environment - bounds);   
    <span class="hljs-literal">geometry</span> shape &lt;- square(width_and_height_of_environment);


    <span class="hljs-comment">// flock's parameter </span>
    <span class="hljs-literal">float</span> two_boids_distance <span class="hljs-symbol">const:</span> true <span class="hljs-symbol">init:</span> 30.0;  
    <span class="hljs-literal">int</span> merging_distance <span class="hljs-symbol">const:</span> true <span class="hljs-symbol">init:</span> 30;
    <span class="hljs-literal">bool</span> create_flock  <span class="hljs-symbol">init:</span> false;  
    
    init {
        <span class="hljs-comment">//Create the boids and place them randomlly</span>
        <span class="hljs-keyword">create</span> boids <span class="hljs-symbol">number:</span> number_of_agents { 
            location &lt;- {rnd (width_and_height_of_environment - 2) + 1, rnd (width_and_height_of_environment -2) + 1 };
        } 
         
         <span class="hljs-comment">//Create an obstacle and place it randomly</span>
        <span class="hljs-keyword">create</span> obstacle <span class="hljs-symbol">number:</span> number_of_obstacles {
            location &lt;- {rnd (width_and_height_of_environment - 2) + 1, rnd (width_and_height_of_environment -2) + 1 }; 
        }
        <span class="hljs-comment">//Create a goal and place it at the goal location</span>
        <span class="hljs-keyword">create</span>  boids_goal <span class="hljs-symbol">number:</span> 1 {
            location &lt;- goal;
        }
        
        <span class="hljs-keyword">create</span> aggregatedboids;
    }
    
    <span class="hljs-comment">//Reflex to create flock of boids considering the neighbors of each boids </span>
     <span class="hljs-builtin">reflex</span> create_flocks {
        <span class="hljs-keyword">if</span> create_flock {
            <span class="hljs-comment">//Create a map using a boid agent as a key and the list of all its neighbors as the value for the key</span>
            <span class="hljs-literal">map</span>&lt;boids, <span class="hljs-literal">list</span>&lt;boids&gt;&gt; potentialBoidsNeighborsMap;
            
            <span class="hljs-comment">//Search all the boids within the two boids distance from a boid agent and put them in the map</span>
            <span class="hljs-keyword">loop</span> one_boids <span class="hljs-symbol">over:</span> boids {
                <span class="hljs-literal">list</span>&lt;boids&gt; free_neighbors &lt;- boids overlapping (one_boids.shape + (two_boids_distance));
                <span class="hljs-keyword">remove</span> one_boids <span class="hljs-symbol">from:</span> free_neighbors;  

                <span class="hljs-keyword">if</span> !(empty (free_neighbors)) {
                    <span class="hljs-keyword">add</span> (one_boids::free_neighbors) <span class="hljs-symbol">to:</span> potentialBoidsNeighborsMap;
                } 
            }
            
            <span class="hljs-comment">//Sorting of all the boids considered as key in the map by the length of their neighbors</span>
            <span class="hljs-literal">list</span>&lt;boids&gt; sorted_free_boids &lt;- (potentialBoidsNeighborsMap.keys) sort_by (length (potentialBoidsNeighborsMap at each));
            <span class="hljs-comment">//Removing of all the boids which has been considered as a key of the map, but  which are already included in a bigger list of neighbors by one of them neighbors</span>
            <span class="hljs-keyword">loop</span> one_boids <span class="hljs-symbol">over:</span> sorted_free_boids {
                <span class="hljs-literal">list</span>&lt;boids&gt; one_boids_neighbors &lt;- potentialBoidsNeighborsMap at one_boids;
                
                <span class="hljs-keyword">if</span>  (one_boids_neighbors != nil) {
                    <span class="hljs-keyword">loop</span> one_neighbor <span class="hljs-symbol">over:</span> one_boids_neighbors {
                        <span class="hljs-keyword">remove</span> one_neighbor <span class="hljs-symbol">from:</span> potentialBoidsNeighborsMap; 
                    }
                }
            }
            <span class="hljs-comment">//Remove all the duplicates key of potentialBoidsNeighborsMap</span>
            <span class="hljs-literal">list</span>&lt;boids&gt; boids_neighbors &lt;- (potentialBoidsNeighborsMap.keys);
            <span class="hljs-keyword">loop</span> one_key <span class="hljs-symbol">over:</span> boids_neighbors {
                <span class="hljs-keyword">put</span> (remove_duplicates (( potentialBoidsNeighborsMap at (one_key)) + one_key)) <span class="hljs-symbol">at:</span> one_key <span class="hljs-symbol">in:</span> potentialBoidsNeighborsMap;
            }
            
            <span class="hljs-comment">//Create a flock of boids considering the key of potentialBoidsNeighborsMap</span>
            <span class="hljs-keyword">loop</span> one_key <span class="hljs-symbol">over:</span> (potentialBoidsNeighborsMap.keys) {
                <span class="hljs-literal">list</span>&lt;boids&gt; micro_agents &lt;- potentialBoidsNeighborsMap at one_key;
                    
                <span class="hljs-keyword">if</span> ( (length (micro_agents)) &gt; 1 ) {
                    <span class="hljs-keyword">create</span> flock <span class="hljs-symbol">number:</span> 1 <span class="hljs-symbol">with:</span> [ color::<span class="hljs-literal">rgb</span>([rnd (255), rnd (255), rnd (255)]) ] { 
                        <span class="hljs-keyword">capture</span> micro_agents <span class="hljs-symbol">as:</span> boids_delegation;
                    }
                }
            } 
        }
    }  
}
<span class="hljs-comment">//Species boids_goal which represents the goal followed by the boids agent, using the skill moving</span>
<span class="hljs-literal">species</span> boids_goal <span class="hljs-symbol">skills:</span> [<span class="hljs-builtin">moving</span>] {
    <span class="hljs-literal">float</span> range <span class="hljs-symbol">const:</span> true <span class="hljs-symbol">init:</span> 20.0;
    <span class="hljs-literal">int</span> radius &lt;-3;
    
    <span class="hljs-comment">//Reflex to make the goal move in circle</span>
    <span class="hljs-builtin">reflex</span> wander_in_circle{
        
        location &lt;- {world.shape.width/2 + world.shape.width/2 * cos (time*radius_speed), world.shape.width/2 + world.shape.width/2 * sin (time*radius_speed)};
        goal &lt;- location;
    }
    
    <span class="hljs-keyword">aspect</span> <span class="hljs-keyword">default</span> {
        <span class="hljs-keyword">draw</span> circle(10) <span class="hljs-symbol">color:</span> <span class="hljs-literal">rgb</span> (<span class="hljs-string">'red'</span>);
        <span class="hljs-keyword">draw</span> circle(40) <span class="hljs-symbol">color:</span> <span class="hljs-literal">rgb</span> (<span class="hljs-string">'orange'</span>) <span class="hljs-symbol">size:</span> 40 <span class="hljs-symbol">empty:</span> true;
    }
    
    <span class="hljs-keyword">aspect</span> sphere{
        <span class="hljs-keyword">draw</span> sphere(10) <span class="hljs-symbol">color:</span> <span class="hljs-literal">rgb</span>(<span class="hljs-string">'white'</span>);
    }
} 

<span class="hljs-comment">//Species flock which represents the flock of boids agents, managing the boids agents captured</span>
<span class="hljs-literal">species</span> flock  
{
    <span class="hljs-comment">//Represent the cohesion index of the flock</span>
    <span class="hljs-literal">float</span> cohesionIndex &lt;- two_boids_distance <span class="hljs-symbol">update:</span> (two_boids_distance + (length (members)));
    <span class="hljs-literal">rgb</span> color &lt;- <span class="hljs-literal">rgb</span> ([64, 64, 64]);
    <span class="hljs-literal">geometry</span> shape <span class="hljs-symbol">update:</span> !(empty (members)) ? ( (polygon (members collect (boids_delegation (each)).location )) + 2.0 ) : ( polygon ([ {rnd (width_and_height_of_environment), rnd (width_and_height_of_environment)} ]) );
     
    <span class="hljs-comment">//Species that will represent the boids agents captured or inside a flock</span>
    <span class="hljs-literal">species</span> boids_delegation <span class="hljs-symbol">parent:</span> boids <span class="hljs-symbol">topology:</span> <span class="hljs-literal">topology</span>(world.shape)  
    {
        <span class="hljs-literal">list</span>&lt;boids&gt; others -&gt; {( (boids_delegation overlapping (shape + range))) - self};
 
        <span class="hljs-comment">//Action to compute the mass center of the flock</span>
        <span class="hljs-keyword">action</span> compute_mass_center <span class="hljs-symbol">type:</span> <span class="hljs-literal">point</span> 
        {
            <span class="hljs-keyword">loop</span> o <span class="hljs-symbol">over:</span> others 
            {
                <span class="hljs-keyword">if</span>  dead(o) 
                {
                    <span class="hljs-keyword">do</span> <span class="hljs-keyword">write</span> <span class="hljs-symbol">message:</span> <span class="hljs-string">'in '</span> + name + <span class="hljs-string">' agent with others contains death agents'</span>; 
                } 
            }
         
            <span class="hljs-keyword">return</span> (length(others) &gt; 0) ? (mean (others collect (each.location)) ) : location;
        }

        <span class="hljs-builtin">reflex</span> separation <span class="hljs-symbol">when:</span> apply_separation {
        }
        
        <span class="hljs-builtin">reflex</span> alignment <span class="hljs-symbol">when:</span> apply_alignment {
        }
        <span class="hljs-comment">//Reflex to apply the cohesion on the boids agents</span>
        <span class="hljs-builtin">reflex</span> cohesion <span class="hljs-symbol">when:</span> apply_cohesion {
            <span class="hljs-literal">point</span> acc &lt;- (self compute_mass_center []) - location;
            acc &lt;- acc / cohesion_factor;
            velocity &lt;- velocity + acc;
        }
        
        <span class="hljs-builtin">reflex</span> avoid <span class="hljs-symbol">when:</span> apply_avoid {
        }       
    }
    <span class="hljs-comment">//Reflex to capture boids agents and release captured boids agents</span>
    <span class="hljs-builtin">reflex</span> capture_release_boids {
         <span class="hljs-literal">list</span>&lt;boids_delegation&gt; removed_components &lt;- boids_delegation where ((each distance_to location) &gt; cohesionIndex );
         <span class="hljs-keyword">if</span> !(empty (removed_components)) {
            <span class="hljs-keyword">release</span> removed_components;
         }
         
         <span class="hljs-literal">list</span>&lt;boids&gt; added_components &lt;- boids where ((each distance_to location) &lt; cohesionIndex );
         <span class="hljs-keyword">if</span> !(empty (added_components)) {
            <span class="hljs-keyword">capture</span> added_components <span class="hljs-symbol">as:</span> boids_delegation;
         }
    }
    <span class="hljs-comment">//Reflexe to kill the flock if the boids agents contained is lower than 2</span>
    <span class="hljs-builtin">reflex</span> dispose <span class="hljs-symbol">when:</span> ((length (members)) &lt; 2) {
         <span class="hljs-keyword">release</span> members;
         <span class="hljs-keyword">do</span> die;
    }
    <span class="hljs-comment">//Reflex to merge the flocks too close from each other</span>
    <span class="hljs-builtin">reflex</span> merge_nearby_flocks {
        <span class="hljs-literal">list</span>&lt;flock&gt; nearby_flocks&lt;- (flock overlapping (shape +  merging_distance));
        <span class="hljs-keyword">if</span> !(empty (nearby_flocks)) {
            nearby_flocks &lt;- nearby_flocks sort_by (length (each.members));
            flock largest_flock &lt;- nearby_flocks at ((length (nearby_flocks)) - 1);
             
            <span class="hljs-keyword">remove</span> largest_flock <span class="hljs-symbol">from:</span> nearby_flocks;
             
            <span class="hljs-literal">list</span>&lt;boids&gt; added_components ;
            <span class="hljs-keyword">loop</span> one_flock <span class="hljs-symbol">over:</span> nearby_flocks {
                <span class="hljs-keyword">release</span> one_flock.members <span class="hljs-symbol">returns:</span> released_boids; 
                
                <span class="hljs-keyword">loop</span> rb <span class="hljs-symbol">over:</span> released_boids {
                    <span class="hljs-keyword">add</span> boids(rb) <span class="hljs-symbol">to:</span> added_components;
                }
            }
            
            <span class="hljs-keyword">if</span> !(empty (added_components)) { 
                <span class="hljs-keyword">ask</span> largest_flock {
                    <span class="hljs-keyword">capture</span> added_components <span class="hljs-symbol">as:</span> boids_delegation;
                }
            } 
         }
    }
    
    <span class="hljs-keyword">aspect</span> <span class="hljs-keyword">default</span> {
        <span class="hljs-keyword">draw</span> shape <span class="hljs-symbol">color:</span> color;
    }
}
    
<span class="hljs-comment">//Species to represent the boids aggregated</span>
<span class="hljs-literal">species</span> aggregatedboids{
    <span class="hljs-builtin">reflex</span> updateLocation{
      location &lt;- mean (boids collect (each.location)); 
    }
    <span class="hljs-keyword">aspect</span> base{        
        <span class="hljs-keyword">draw</span> sphere(10) <span class="hljs-symbol">color:</span> <span class="hljs-literal">rgb</span>(<span class="hljs-string">'red'</span>);
    }
}
<span class="hljs-comment">//Species to represent the boids agent using the skill moving</span>
<span class="hljs-literal">species</span> boids <span class="hljs-symbol">skills:</span> [<span class="hljs-builtin">moving</span>] {
    <span class="hljs-comment">//Speed of the agent</span>
    <span class="hljs-literal">float</span> speed <span class="hljs-symbol">max:</span> maximal_speed &lt;- maximal_speed;
    <span class="hljs-comment">//Range of movement for the neighbors</span>
    <span class="hljs-literal">float</span> range &lt;- minimal_distance * 2;
    <span class="hljs-comment">//Velocity of the agent</span>
    <span class="hljs-literal">point</span> velocity &lt;- {0,0};
    <span class="hljs-literal">float</span> hue &lt;- rnd(360) / 360;
    
    <span class="hljs-comment">//List of the neighbors boids</span>
    <span class="hljs-literal">list</span>&lt;boids&gt; others <span class="hljs-symbol">update:</span> ((boids overlapping (circle (range)))  - self);
    
    <span class="hljs-comment">//Point of the mass center of the "flock" considered as the neighbors agents</span>
    <span class="hljs-literal">point</span> mass_center <span class="hljs-symbol">update:</span>  (length(others) &gt; 0) ? (mean (others collect (each.location)) )  : location;
    
    <span class="hljs-comment">//Reflex to do the separation of the agents with the other boids in the minimal distance</span>
    <span class="hljs-builtin">reflex</span> separation <span class="hljs-symbol">when:</span> apply_separation {
        <span class="hljs-literal">point</span> acc &lt;- {0,0}; 
        <span class="hljs-keyword">loop</span> boid <span class="hljs-symbol">over:</span> (boids overlapping (circle(minimal_distance)))  {
            acc &lt;- acc - ((location of boid) - location);
        }  
        velocity &lt;- velocity + acc;
    }
    
    <span class="hljs-comment">//Reflex to do the alignement of the boids</span>
    <span class="hljs-builtin">reflex</span> alignment <span class="hljs-symbol">when:</span> apply_alignment {
        <span class="hljs-literal">point</span> acc &lt;- mean (others collect (each.velocity)) - velocity;
        velocity &lt;- velocity + (acc / alignment_factor);
    }
     
    <span class="hljs-comment">//Reflex to apply the cohesion using the mass center of the "flock"</span>
    <span class="hljs-builtin">reflex</span> cohesion <span class="hljs-symbol">when:</span> apply_cohesion {
        <span class="hljs-literal">point</span> acc &lt;- mass_center - location;
        acc &lt;- acc / cohesion_factor;
        velocity &lt;- velocity + acc; 
    }
    <span class="hljs-comment">//Reflex to avoid the obstacles</span>
    <span class="hljs-builtin">reflex</span> avoid <span class="hljs-symbol">when:</span> apply_avoid {
        <span class="hljs-literal">point</span> acc &lt;- {0,0};
        <span class="hljs-literal">list</span>&lt;obstacle&gt; nearby_obstacles &lt;- (obstacle overlapping (circle (range)) );
        <span class="hljs-keyword">loop</span> obs <span class="hljs-symbol">over:</span> nearby_obstacles {
            acc &lt;- acc - ((location of obs) - my (location));
        }
        velocity &lt;- velocity + acc; 
    }
    <span class="hljs-comment">//action to represent the bounding of the movement of the boids</span>
    <span class="hljs-keyword">action</span> bounding {
        <span class="hljs-keyword">if</span>  !(torus_environment) {
            <span class="hljs-keyword">if</span>  (location.x) &lt; xmin {
                velocity &lt;- velocity + {bounds,0};
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (location.x) &gt; xmax {
                velocity &lt;- velocity - {bounds,0};
            }
            
            <span class="hljs-keyword">if</span> (location.y) &lt; ymin {
                velocity &lt;- velocity + {0,bounds};
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (location.y) &gt; ymax {
                velocity &lt;- velocity - {0,bounds};
            }
            
        }
    }
    <span class="hljs-comment">//Reflex to follow the goal </span>
    <span class="hljs-builtin">reflex</span> follow_goal <span class="hljs-symbol">when:</span> apply_goal {
        velocity &lt;- velocity + ((goal - location) / cohesion_factor);
    }
    <span class="hljs-comment">//Reflex to apply the wind vector</span>
    <span class="hljs-builtin">reflex</span> wind <span class="hljs-symbol">when:</span> apply_wind {
        velocity &lt;- velocity + wind_vector;
    }
    <span class="hljs-comment">//action to move  </span>
    <span class="hljs-keyword">action</span> do_move {  
        <span class="hljs-keyword">if</span> (((velocity.x) as <span class="hljs-literal">int</span>) = 0) and (((velocity.y) as <span class="hljs-literal">int</span>) = 0) {
            velocity &lt;- {(rnd(4)) -2, (rnd(4)) - 2}; 
        }
        <span class="hljs-literal">point</span> old_location &lt;- location; 
        <span class="hljs-keyword">do</span> goto <span class="hljs-symbol">target:</span> location + velocity;
        velocity &lt;- location - old_location; 
    }
    
    <span class="hljs-comment">//Reflex to do the movement, calling both bounding and do_move actions</span>
    <span class="hljs-builtin">reflex</span> movement {
        <span class="hljs-keyword">do</span> bounding;
        <span class="hljs-keyword">do</span> do_move;
    }
    
    <span class="hljs-keyword">aspect</span> basic{
        <span class="hljs-keyword">draw</span> triangle(boids_size) <span class="hljs-symbol">color:</span><span class="hljs-literal">rgb</span>(<span class="hljs-string">'black'</span>);
    }
    <span class="hljs-keyword">aspect</span> <span class="hljs-keyword">image</span> {
        <span class="hljs-keyword">draw</span> (images at (rnd(2))) <span class="hljs-symbol">size:</span> boids_size <span class="hljs-symbol">rotate:</span> heading <span class="hljs-symbol">color:</span> <span class="hljs-literal">rgb</span>(<span class="hljs-string">'black'</span>) ;                
    }
            
    <span class="hljs-keyword">aspect</span> dynamicColor{
        <span class="hljs-literal">rgb</span> cc &lt;- hsb (<span class="hljs-literal">float</span>(heading)/360.0,1.0,1.0);
        <span class="hljs-keyword">draw</span> triangle(20) <span class="hljs-symbol">size:</span> 15 <span class="hljs-symbol">rotate:</span> 90 + heading <span class="hljs-symbol">color:</span> cc <span class="hljs-symbol">border:</span>cc <span class="hljs-symbol">depth:</span>5;
        <span class="hljs-keyword">draw</span> name;
    }
} 

<span class="hljs-comment">//Species which represents the obstacles using the skill moving</span>
<span class="hljs-literal">species</span> obstacle <span class="hljs-symbol">skills:</span> [<span class="hljs-builtin">moving</span>] {
    <span class="hljs-literal">float</span> speed &lt;- 0.1;  
    <span class="hljs-keyword">aspect</span> <span class="hljs-keyword">default</span> {
        <span class="hljs-keyword">draw</span> triangle(20) <span class="hljs-symbol">color:</span> <span class="hljs-literal">rgb</span>(<span class="hljs-string">'yellow'</span>) <span class="hljs-symbol">depth:</span>5;
    }
}



<span class="hljs-builtin">experiment</span> start <span class="hljs-symbol">type:</span> gui {
    <span class="hljs-keyword">output</span> {
        <span class="hljs-keyword">display</span> RealBoids  <span class="hljs-symbol">type:</span>opengl <span class="hljs-symbol">z_fighting:</span>false {
            <span class="hljs-keyword">image</span> <span class="hljs-string">'background'</span> <span class="hljs-symbol">file:</span>file_path_to_ocean;
            <span class="hljs-literal">species</span> boids <span class="hljs-symbol">aspect:</span> dynamicColor  <span class="hljs-symbol">position:</span>{0,0,0.1} <span class="hljs-symbol">trace:</span> 30;
            <span class="hljs-literal">species</span> boids_goal <span class="hljs-symbol">transparency:</span>0.2 <span class="hljs-symbol">position:</span>{0,0,0.1};
            <span class="hljs-literal">species</span> obstacle <span class="hljs-symbol">position:</span>{0,0,0.1};        
        }
    }
}

<span class="hljs-builtin">experiment</span> trajectory_analysis <span class="hljs-symbol">type:</span> gui {
    <span class="hljs-keyword">output</span> {
        
        <span class="hljs-keyword">display</span> RealBoids  <span class="hljs-symbol">type:</span>opengl {
            <span class="hljs-keyword">image</span> <span class="hljs-string">'background'</span> <span class="hljs-symbol">file:</span>file_path_to_ocean;
            <span class="hljs-literal">species</span> boids <span class="hljs-symbol">aspect:</span> dynamicColor <span class="hljs-symbol">transparency:</span>0.5 <span class="hljs-symbol">position:</span>{0,0,0.1};
            <span class="hljs-literal">species</span> boids <span class="hljs-symbol">aspect:</span> <span class="hljs-keyword">image</span> <span class="hljs-symbol">transparency:</span>0.5 <span class="hljs-symbol">position:</span>{0,0,0.11};
            <span class="hljs-literal">species</span> boids_goal <span class="hljs-symbol">transparency:</span>0.2 <span class="hljs-symbol">position:</span>{0,0,0.1};
            <span class="hljs-literal">species</span> obstacle <span class="hljs-symbol">position:</span>{0,0,0.1};        
        }
                
        <span class="hljs-keyword">display</span> AggregatedBoidsTrajectory  <span class="hljs-symbol">type:</span>opengl  {
            <span class="hljs-keyword">image</span> <span class="hljs-string">'background'</span> <span class="hljs-symbol">file:</span>file_path_to_ocean;
            <span class="hljs-literal">species</span> aggregatedboids  <span class="hljs-symbol">aspect:</span> base <span class="hljs-symbol">trace:</span>100 <span class="hljs-symbol">fading:</span> true ;
            <span class="hljs-literal">species</span> boids_goal <span class="hljs-symbol">aspect:</span>sphere;       
        }
    } 
}

<span class="hljs-builtin">experiment</span> SpaceTimeCube <span class="hljs-symbol">type:</span> gui {
    <span class="hljs-keyword">output</span> {
        <span class="hljs-keyword">display</span> RealBoids  <span class="hljs-symbol">type:</span>opengl {
            <span class="hljs-keyword">image</span> <span class="hljs-string">'background'</span> <span class="hljs-symbol">file:</span>file_path_to_ocean;
            <span class="hljs-literal">species</span> boids <span class="hljs-symbol">aspect:</span> dynamicColor <span class="hljs-symbol">transparency:</span>0.5 <span class="hljs-symbol">position:</span>{0,0,0.1};
            <span class="hljs-literal">species</span> boids <span class="hljs-symbol">aspect:</span> <span class="hljs-keyword">image</span> <span class="hljs-symbol">transparency:</span>0.5 <span class="hljs-symbol">position:</span>{0,0,0.11};
            <span class="hljs-literal">species</span> boids_goal <span class="hljs-symbol">transparency:</span>0.2 <span class="hljs-symbol">position:</span>{0,0,0.1};
            <span class="hljs-literal">species</span> obstacle <span class="hljs-symbol">position:</span>{0,0,0.1};        
        }
        
        <span class="hljs-keyword">display</span> SpaceTimeCubeAll  <span class="hljs-symbol">type:</span>opengl {
            <span class="hljs-keyword">image</span> <span class="hljs-string">'background'</span> <span class="hljs-symbol">file:</span>file_path_to_ocean;
            <span class="hljs-literal">species</span> boids <span class="hljs-symbol">trace:</span>true{
                <span class="hljs-keyword">draw</span> triangle(20) <span class="hljs-symbol">size:</span> 15 <span class="hljs-symbol">rotate:</span> 90 + heading <span class="hljs-symbol">color:</span> hsb (<span class="hljs-literal">float</span>(heading)/360.0,1.0,1.0) <span class="hljs-symbol">border:</span>hsb (<span class="hljs-literal">float</span>(heading)/360.0,1.0,1.0) <span class="hljs-symbol">depth:</span>5 <span class="hljs-symbol">at:</span> {location.x ,location.y,location.z+time};   
            }
            <span class="hljs-literal">species</span> boids_goal <span class="hljs-symbol">trace:</span>true{
                <span class="hljs-keyword">draw</span> sphere(10) <span class="hljs-symbol">color:</span> <span class="hljs-literal">rgb</span>(<span class="hljs-string">'yellow'</span>) <span class="hljs-symbol">at:</span> {location.x ,location.y,location.z+time};
            }   
        }
                
        <span class="hljs-keyword">display</span> SpaceTimeCubeAggregated  <span class="hljs-symbol">type:</span>opengl {
            <span class="hljs-keyword">image</span> <span class="hljs-string">'background'</span> <span class="hljs-symbol">file:</span>file_path_to_ocean;
            <span class="hljs-literal">species</span> aggregatedboids <span class="hljs-symbol">trace:</span>true{
                <span class="hljs-keyword">draw</span> sphere(10) <span class="hljs-symbol">color:</span> <span class="hljs-literal">rgb</span>(<span class="hljs-string">'red'</span>) <span class="hljs-symbol">at:</span> {location.x ,location.y,location.z+time}; 
            }
            <span class="hljs-literal">species</span> boids_goal <span class="hljs-symbol">trace:</span>true{
                <span class="hljs-keyword">draw</span> sphere(10) <span class="hljs-symbol">color:</span> <span class="hljs-literal">rgb</span>(<span class="hljs-string">'yellow'</span>) <span class="hljs-symbol">at:</span> {location.x ,location.y,location.z+time};
            }   
        }
    }
}

<span class="hljs-builtin">experiment</span> MultipleView <span class="hljs-symbol">type:</span> gui {
    <span class="hljs-keyword">output</span> {


        <span class="hljs-keyword">display</span> RealBoids   <span class="hljs-symbol">type:</span>opengl {
            <span class="hljs-keyword">image</span> <span class="hljs-string">'background'</span> <span class="hljs-symbol">file:</span>file_path_to_ocean;
            <span class="hljs-literal">species</span> boids <span class="hljs-symbol">aspect:</span> <span class="hljs-keyword">image</span>  <span class="hljs-symbol">transparency:</span>0.5 <span class="hljs-symbol">position:</span>{0,0,0.25};
            <span class="hljs-literal">species</span> boids_goal <span class="hljs-symbol">transparency:</span>0.2 <span class="hljs-symbol">position:</span>{0,0,0.25};
            <span class="hljs-literal">species</span> obstacle ;
            <span class="hljs-literal">species</span> boids  <span class="hljs-symbol">aspect:</span> dynamicColor <span class="hljs-symbol">transparency:</span>0.2 <span class="hljs-symbol">position:</span>{0,0,0.24};       
        }
        
        <span class="hljs-keyword">display</span> ThirdPersonn  <span class="hljs-symbol">type:</span>opengl <span class="hljs-symbol">camera_interaction:</span>false <span class="hljs-symbol">camera_pos:</span>{<span class="hljs-literal">int</span>(first(boids).location.x),<span class="hljs-literal">int</span>(first(boids).location.y),250} 
        <span class="hljs-symbol">camera_look_pos:</span>{<span class="hljs-literal">int</span>(first(boids).location.x),first(boids).location.y,0} 
        <span class="hljs-symbol">camera_up_vector:</span>{0.0,-1.0,0.0} {
        
            <span class="hljs-keyword">image</span> <span class="hljs-string">'background'</span> <span class="hljs-symbol">file:</span>file_path_to_ocean;
            <span class="hljs-literal">species</span> obstacle;
            <span class="hljs-literal">species</span> boids  <span class="hljs-symbol">aspect:</span> dynamicColor <span class="hljs-symbol">transparency:</span>0.2 ;
            <span class="hljs-literal">species</span> boids_goal  <span class="hljs-symbol">transparency:</span>0.2;       
        }
        
            
        <span class="hljs-keyword">display</span> FirstPerson  <span class="hljs-symbol">type:</span>opengl <span class="hljs-symbol">camera_interaction:</span>false <span class="hljs-symbol">camera_pos:</span>{<span class="hljs-literal">int</span>(first(boids).location.x),<span class="hljs-literal">int</span>(first(boids).location.y),10} 
            <span class="hljs-symbol">camera_look_pos:</span>{cos(first(boids).heading)*first(boids).speed+<span class="hljs-literal">int</span>(first(boids).location.x),
            sin(first(boids).heading)*first(boids).speed+<span class="hljs-literal">int</span>(first(boids).location.y),10} 
            <span class="hljs-symbol">camera_up_vector:</span>{0.0,0.0,1.0} {    
            <span class="hljs-keyword">image</span> <span class="hljs-string">'background'</span> <span class="hljs-symbol">file:</span>file_path_to_ocean;
            <span class="hljs-literal">species</span> obstacle ;
            <span class="hljs-literal">species</span> boids  <span class="hljs-symbol">aspect:</span> dynamicColor <span class="hljs-symbol">transparency:</span>0.2 ;
            <span class="hljs-literal">species</span> boids_goal  <span class="hljs-symbol">transparency:</span>0.2;       
        }
    }
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap" style="margin-bottom:0"><a href="/" class="nav-home"><img src="/img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://github.com/gama-platform"><i class="fab fa-github"></i> GitHub</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://gama-platform.github.io/blog/feed" target="_blank"><i class="fa fa-rss"></i> Blog RSS</a></div><div><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div style="color:hsla(0,0%,100%,.4)"><h5>License</h5><p>Copyright (C) - 2019 GAMA-Platform.</p><p>Permission is granted to copy, distribute and/or modify this document under the terms of the GNU Free Documentation License, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.</p><p>A copy of the license is included <a href="https://github.com/gama-platform/gama/wiki/LICENSE.md" style="display:initial">here</a>, in the repository of the wiki content.</p></div></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.fbAsyncInit = function() {FB.init({appId:'238065426321929',xfbml:true,version:'v2.7'});};(function(d, s, id){var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) {return;}js = d.createElement(s); js.id = id;js.src = '//connect.facebook.net/en_US/sdk.js';fjs.parentNode.insertBefore(js, fjs);}(document, 'script','facebook-jssdk'));
                </script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'undefined',
                indexName: 'undefined',
                inputSelector: '#search_input_react'
              });
            </script></body></html>