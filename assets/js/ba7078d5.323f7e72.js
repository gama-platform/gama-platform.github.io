"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[23024],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},f=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=s(n),f=i,u=c["".concat(p,".").concat(f)]||c[f]||h[f]||r;return n?a.createElement(u,o(o({ref:t},d),{},{components:n})):a.createElement(u,o({ref:t},d))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=f;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[c]="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},39160:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>p,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var a=n(87462),i=n(63366),r=(n(67294),n(3905)),o=["components"],l={title:"5. Visualizing in 3D"},p=void 0,s={unversionedId:"IncrementalModel_step5",id:"version-1.8.1/IncrementalModel_step5",title:"5. Visualizing in 3D",description:"This step Illustrates how to define a 3D display.",source:"@site/versioned_docs/version-1.8.1/IncrementalModel_step5.md",sourceDirName:".",slug:"/IncrementalModel_step5",permalink:"/wiki/1.8.1/IncrementalModel_step5",draft:!1,editUrl:"https://github.com/gama-platform/gama/wiki/IncrementalModel_step5/_edit",tags:[],version:"1.8.1",frontMatter:{title:"5. Visualizing in 3D"},sidebar:"tuto",previous:{title:"4. Movement on Graph",permalink:"/wiki/1.8.1/IncrementalModel_step4"},next:{title:"6. Multi-Level",permalink:"/wiki/1.8.1/IncrementalModel_step6"}},d={},c=[{value:"Formulation",id:"formulation",level:2},{value:"Model Definition",id:"model-definition",level:2},{value:"building",id:"building",level:3},{value:"road",id:"road",level:3},{value:"global variable",id:"global-variable",level:3},{value:"people",id:"people",level:3},{value:"display",id:"display",level:3},{value:"Complete Model",id:"complete-model",level:2}],h={toc:c},f="wrapper";function u(e){var t=e.components,l=(0,i.Z)(e,o);return(0,r.kt)(f,(0,a.Z)({},h,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This step Illustrates how to define a 3D display."),(0,r.kt)("h2",{id:"formulation"},"Formulation"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add a variable (height: int from 10m to 20m) and modify the aspect of buildings to display them in 3D."),(0,r.kt)("li",{parentName:"ul"},"Add a variable (display","_","shape: geometry; shape with a buffer of 2m) and modify the aspect of the roads to display them with this new shape."),(0,r.kt)("li",{parentName:"ul"},"Add a new global variable that indicate if it is night or not (bool: night before 7h and after 20h)."),(0,r.kt)("li",{parentName:"ul"},"Define a new aspect (sphere3D) for people to display them as sphere."),(0,r.kt)("li",{parentName:"ul"},"Modify the display to use this new aspect.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Incremental model 5: add a 3D display to the model.",src:n(30748).Z,width:"1612",height:"831"})),(0,r.kt)("h2",{id:"model-definition"},"Model Definition"),(0,r.kt)("h3",{id:"building"},"building"),(0,r.kt)("p",null,"First, we add a new variable for buildings (",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"height")),") of type float from 10m to 20m. Then we modify the aspect in order to specify a depth for the geometry (using the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"depth"))," facet)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"species building {\n    float height <- rnd(10#m, 20#m) ;\n    aspect default {\n    draw shape color: #gray border: #black depth: height;\n    }\n}\n")),(0,r.kt)("h3",{id:"road"},"road"),(0,r.kt)("p",null,"Concerning the road,  we add a new variable (",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"display_shape")),') of type geometry that corresponds to the shape of the road with a buffer of 2 meters. Then we modify the aspect in order to display this geometry instead of the shape of the agent. In order to avoid "z-fighting" problems, we add depth to the geometry (of 3 meters).'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"species road {\n    geometry display_shape <- shape + 2.0;\n    aspect default {\n    draw display_shape color: #black depth: 3.0;\n    }\n}\n")),(0,r.kt)("h3",{id:"global-variable"},"global variable"),(0,r.kt)("p",null,"We define a new global variable called ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"is_night"))," of type ",(0,r.kt)("inlineCode",{parentName:"p"},"bool")," to indicate if it is night or not. This variable will be updated at each simulation step and will be ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," if the current hour is lower than 7h or higher than 20h. It will be used in the display to change the light of the scene (to set it darker in the night)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"global{\n    ...\n    bool is_night <- true update: current_date.hour < 7 or current_date.hour > 20;\n    ...\n}\n")),(0,r.kt)("h3",{id:"people"},"people"),(0,r.kt)("p",null,"We define a new aspect for the people agent called ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"sphere3D")),". This aspect draws people agent as a 3m sphere. In order to avoid to cut the sphere in half, we translate the centroid of the drawn sphere to 3m along the z-axis."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"species people skills:[moving]{     \n    ...\n    aspect sphere3D{\n    draw sphere(3) at: {location.x,location.y,location.z + 3} color:is_infected ? #red : #green;\n    }\n}\n")),(0,r.kt)("h3",{id:"display"},"display"),(0,r.kt)("p",null,"The element that we have to modify is the display. We change its name to ",(0,r.kt)("strong",{parentName:"p"},"map","_","3D")," to better reflect its visual aspect."),(0,r.kt)("p",null,"In order to get a 3D aspect, we specify that this display will be an OpenGL one. For that, we just have to add the facet ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"type: opengl")),". In addition, to get a different light between night and day, we add a ",(0,r.kt)("inlineCode",{parentName:"p"},"light")," statement inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"display"),'. We can change up to 7 lights, called through the facet "id". The default light is white light, directional, with the id=1. You can set the intensity of the light through the facet ',(0,r.kt)("inlineCode",{parentName:"p"},"color")," (you can pass a color or an integer between 0 and 255). To have a nice effect night/day, we will set the intensity of the light to 50 during the night, and 255 for the day. To learn more about light, please read this ",(0,r.kt)("a",{parentName:"p",href:"ManipulateLight"},"page"),"."),(0,r.kt)("p",null,"Then, we add a new layer that consists of an image (soil.jpg) by using the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"image"))," statement."),(0,r.kt)("p",null,"In order to see the people inside the building, we add transparency to the building (0.5). The transparency of a layer is a float value between 0 (solid) and 1 (totally transparent). In order to be able to manage this transparency aspect, OpenGL has to draw the people agents before the building, thus we modify the order of drawing of the different layers (people agents before building agents). At last, we modify the displayed aspect of the people agents by the new one: ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"sphere3D")),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'experiment main_experiment type:gui{\n    ...\n    output {\n    ...\n    display map_3D type: opengl {\n        light 1 color:(is_night ? 50 : 255);\n        image "../includes/soil.jpg";\n        species road;\n        species people aspect: sphere3D;            \n        species building transparency: 0.5;\n    }\n    ...\n    }\n}\n')),(0,r.kt)("h2",{id:"complete-model"},"Complete Model"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'model model5 \n \nglobal {\n    int nb_people <- 500;\n    float agent_speed <- 5.0 #km/#h;            \n    float step <- 1 #minutes;\n    float infection_distance <- 2.0 #m;\n    float proba_infection <- 0.05;\n    int nb_infected_init <- 5;\n    file roads_shapefile <- file("../includes/road.shp");\n    file buildings_shapefile <- file("../includes/building.shp");\n    geometry shape <- envelope(roads_shapefile);\n    graph road_network;\n    float staying_coeff update: 10.0 ^ (1 + min([abs(current_date.hour - 9), abs(current_date.hour - 12), abs(current_date.hour - 18)]));\n    int nb_people_infected <- nb_infected_init update: people count (each.is_infected);\n    int nb_people_not_infected <- nb_people - nb_infected_init update: nb_people - nb_people_infected;\n    bool is_night <- true update: current_date.hour < 7 or current_date.hour > 20;  \n    float infected_rate update: nb_people_infected / nb_people;\n\n    init {\n    create road from: roads_shapefile;\n    road_network <- as_edge_graph(road);\n    create building from: buildings_shapefile;\n    create people number:nb_people {\n        speed <- agent_speed;\n        location <- any_location_in(one_of(building));\n    }\n    ask nb_infected_init among people {\n        is_infected <- true;\n    }\n    }\n    reflex end_simulation when: infected_rate = 1.0 {\n    do pause;\n    }\n}\n\nspecies people skills:[moving]{     \n    bool is_infected <- false;\n    point target;\n    int staying_counter;\n\n    reflex stay when: target = nil {\n    staying_counter <- staying_counter + 1;\n    if flip(staying_counter / staying_coeff) {\n        target <- any_location_in (one_of(building));\n    }\n    }\n        \n    reflex move when: target != nil{\n    do goto target:target on: road_network;\n    if (location = target) {\n        target <- nil;\n        staying_counter <- 0;\n    } \n    }\n    reflex infect when: is_infected{\n    ask people at_distance infection_distance {\n        if flip(proba_infection) {\n        is_infected <- true;\n        }\n    }\n    }\n    aspect default{\n    draw circle(5) color:is_infected ? #red : #green;\n    }\n    aspect sphere3D{\n    draw sphere(3) at: {location.x,location.y,location.z + 3} color: is_infected ? #red : #green;\n    }\n}\n\nspecies road {\n    geometry display_shape <- shape + 2.0;\n    aspect default {\n    draw display_shape color: #black depth: 3.0;\n    }\n}\n\nspecies building {\n    float height <- rnd(10#m, 20#m) ;\n    \n    aspect default {\n    draw shape color: #gray border: #black depth: height;\n    }\n}\n\nexperiment main_experiment type:gui{\n    parameter "Infection distance" var: infection_distance;\n    parameter "Proba infection" var: proba_infection min: 0.0 max: 1.0;\n    parameter "Nb people infected at init" var: nb_infected_init ;\n\n    output {\n    monitor "Current hour" value: current_date.hour;\n    monitor "Infected people rate" value: infected_rate;\n    display map_3D type: opengl {\n        light 1 color:(is_night ? 50 : 255);\n        image "../includes/soil.jpg";\n        species road ;\n        species people aspect:sphere3D;         \n        species building  transparency: 0.5;\n    }\n    display chart refresh: every(10#cycles) {\n        chart "Disease spreading" type: series style: spline {\n        data "susceptible" value: nb_people_not_infected color: #green marker: false;\n        data "infected" value: nb_people_infected color: #red marker: false;\n        }\n    }\n    }\n}\n')))}u.isMDXComponent=!0},30748:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Incremental_model5-640acca56cb1eefdfe1fa0a6980f3f44.jpg"}}]);